stream=threat where sourcename="SENTINELONE" |checkif deviceaddress not in SentinelOne_Device_IP.SentinelOne_Dev_IP|  duration 2h

stream=signals | duration 1h

stream=signals | duration 10m

stream=firewall where severitylevel='High' and act='allow' and threattype='Malicious'|duration 3d

stream=* where sourcename="SENTINELONE" | groupby devsrcip, system | duration 2h

stream=threat where sourcename='FORCEPOINT-DLP' and threat='Suspected data theft'| duration 3d

stream=* where sourcename="SENTINELONE" |checkif deviceaddress not in SentinelOne_Device_IP.SentinelOne_Dev_IP|  duration 2h

stream=threat where devsrcip='Abnormal' and attacktype like("%Phishing%") and isautoremediated='False' and ispostremediated='False' | checkif url in tcstipdomain.url |duration 7d

stream=authentication where action='LOGIN' and sourcename='MS-O365' and status='FAILED' and srctype='PUBLIC' and user!='Not Available' and reason!='IdsLocked' | 
select user, srcip, reason, count(status) as failed_count | 
groupby user, srcip, reason | 
having failed_count>=10 | 
duration 24h

stream=threat where sourcename='FIREWALL' and action!='THREAT_BLOCKED'| duration 6h

stream=threat where sourcename='MS-O365' and threat not in ('New users forwarding emails','New domains being forwarded emails','Domains in mail loop') | duration 6h

stream=* where devsrcip='10.10.10.10'| select count(*), cnamtime |groupby cnamtime | duration 1d

stream=iam | select targetdomain, count_if(eid='4740') as eid_count |  groupby targetdomain | having eid_count >= 10 | duration 3h

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' | select user, count(status) as fail_count | 
groupby user | having fail_count>=8 | duration 1d

stream=* | timeslice 1m | duration 6h 

stream=threat where sourcename='COMM-VAULT' | duration 6h

stream=firewall where threattype='Malicious' and act not in ('deny','block') | groupby srcip, dstip, act

stream=threat where sourcename='FORCEPOINT-DLP' and logevent like ("%act=Permitted%") or logevent like ("%act=Continued%") | duration 6h

stream=threat where sourcename='FORTIGATE' and action!='THREAT_BLOCKED'| duration 6h

stream=threat where sourcename='FORTIGATE' and action!='THREAT_BLOCKED' and act!='dropped'| duration 6h

stream=FIREWALL where action='PACKET_ALLOWED' and dstport='3389' and srctype='PUBLIC' | groupby srcip, dstip

stream=FIREWALL where action='PACKET_ALLOWED' and dstport='3389' and srctype='PUBLIC' and dstip='{TargetHost}' and srcip='{SuspectHost}' | duration 6m

stream=firewall | checkif srcip not in DCIPs.DeviceIP | groupby srcip | duration 24h | limit 20

stream=iam | select targetuser, count_if(eid='4740') as eid_count |  groupby targetuser | checkif targetuser in AdminVIPList.VIPUser | having eid_count >= 3 | duration 1h

stream=iam where targetuser='{targetuser}'

stream=signals | duration 1h

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' | select user, count(status) as fail_count | 
groupby user | having fail_count>=8 | duration 1h

stream=* | checkif devsrcip in CriticalDevices.Critical_Servers | groupby devsrcip | limit 500 | duration 2h

stream=signals | duration 1h

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' | select user, count(status) as fail_count | 
groupby user | having fail_count>=8 | duration 1h

stream=iam | select targetdomain, count_if(eid='4740') as eid_count |  groupby targetdomain | having eid_count >= 10 | duration 3h

stream=* where devsrcip='10.10.10.10'| select count(*), cnamtime |groupby cnamtime | duration 1d

stream=signals | limit 10

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' | select user, count(status) as fail_count | 
groupby user | having fail_count>=8 | duration 1h

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' AND targetuser='{TargetUser}'

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' | select targetuser, count(distinct(action)) as act | groupby targetuser |having act>=2| duration 1h

stream=win-audit and subjectuser='{SuspectUser}'

stream=win-audit where processname like '%lsass.exe%'
 or processname like '%Mimikatz%'
 or processname like '%Gsecdump%'
 or processname like '%ProcDump%'
 or processname like '%comsvcs.dll%'
 or processname like '%Nishang%' 
 or processname like '%NTDSUtil%' 
 or processname like '%memorydump.py%'
 or processname like '%metasploit%'
| groupby subjectuser, processname | duration 1h

stream=firewall where dstport NOT in (21,22,23,69,115,990,989) and proto in ('FTP', 'SSH', 'SFTP', 'TFTP', 'TELNET', 'FTPS') and srcip='{SuspectHost}'

stream=firewall where dstport NOT in (21,22,23,69,115,990,989) and proto in ('FTP', 'SSH', 'SFTP', 'TFTP', 'TELNET', 'FTPS')
| groupby srcip | duration 1h

stream=authentication where action='LOGIN' and sourcename='MS-O365' and status='FAILED' and srctype='PUBLIC' and user!='Not Available' and reason!='IdsLocked' | 
select user, srcip, reason, count(status) as failed_count | 
groupby user, srcip, reason | 
having failed_count>=10 | 
duration 24h

stream=* | checkif devsrcip in CriticalDevices.Critical_Servers | groupby devsrcip | limit 500 | duration 2h

stream=authentication where sourcename='WINDOWS' and eid=4740 and srcip ='SuspectUser'

stream=authentication where sourcename='WINDOWS' and eid=4740 
| select count(eid) as eid_count, user, srcip| groupby user, srcip| having  eid_count >1 | duration 10d

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' AND targetuser='{TargetUser}'

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' | select targetuser, count(distinct(action)) as act | groupby targetuser |having act>=2| duration 1h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST'
|select count(distinct(hostname)) as host_count, hash | having host_count<=1 | groupby hash | duration 1h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hash='{SuspectHash}'

stream=iam | select targetuser, count_if(eid='4740') as eid_count |  groupby targetuser | checkif targetuser in AdminVIPList.VIPUser | having eid_count >= 3 | duration 1h

stream=iam where targetuser='{targetuser}'

stream=webfilter where srcip not like ('192.168.15%') and catdesc in ('Abortion', 'Dating', 'Gambling', 'Marijuana', 'Nudity and Risque', 
'Other Adult Materials', 'Pornography', 'URL Shortening', 'Advertising', 'Games', 'Meaningless Content', 
'Child Sexual Abuse', 'Crypto Mining', 'Discrimination', 'Drug Abuse', 'Explicit Violence', 'Extremist Groups', 
'Hacking', 'Illegal or Unethical', 'Plagiarism', 'Potentially Unwanted Program', 'Proxy Avoidance', 'Terrorism', 'Dynamic DNS', 
'Malicious Websites', 'Newly Observed Domain', 'Newly Registered Domain', 'Phishing', 'Spam URLs', 'Not Rated') 
| select srcip, count(proxyaction) as pcount | groupby srcip |having pcount>1000 
| duration 1h

stream=webfilter and srcip='{SuspectHost}' and pcount='{TargetResource}'

stream=iam where targetuser='{targetuser}'

stream=iam | select targetuser, count_if(eid='4740') as eid_count |  groupby targetuser | checkif targetuser in AdminVIPList.AdminUser | having eid_count >= 1 | duration 1d

stream=win-audit where processname like '%lsass.exe%'
 or processname like '%Mimikatz%'
 or processname like '%Gsecdump%'
 or processname like '%ProcDump%'
 or processname like '%comsvcs.dll%'
 or processname like '%Nishang%' 
 or processname like '%NTDSUtil%' 
 or processname like '%memorydump.py%'
 or processname like '%metasploit%' or processname like "%vds%"
| groupby subjectuser, processname | duration 1h

stream=win-audit and subjectuser='{SuspectUser}'

stream=EP-Process where processname like '%mimitkatz%' or processname like '%sekurlsa%' and system='{TargetUser}'

stream=win-audit where processname like '%mimitkatz%' or processname like '%sekurlsa%' | duration 1h

stream=iam | select targetuser, count_if(eid='4740') as eid_count |  groupby targetuser | checkif targetuser in AdminVIPList.AdminUser | having eid_count >= 3 | duration 1h

stream=iam where targetuser='{targetuser}'

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON'
| checkif workstation not in DCandADFS.Hostname
| select user, count(distinct(workstation)) as unique_system 
| groupby user| having unique_system>3 | duration 30m

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON' and user='{SuspectUser}' and unique_system='{TargetHost}'

stream=threat or stream=firewall where threattype='Malicious' and direction='outgoing' | groupby srcip|duration 1d |limit 10

stream=iam where action='USER_ACCOUNT_CREATED' or action='USER_ACCOUNT_DELETED'
| select user, count(distinct(action)) | groupby user |having action=2| duration 1d

stream=iam where sourcename='WINDOWS' and eid=4740 
| select count(eid) as eid_count, targetuser| groupby targetuser| having  eid_count >=10 | duration 1d

stream=authentication where sourcename='WINDOWS' and eid=4740 and srcip ='SuspectUser'

stream=iam where sourcename='WINDOWS' and eid=4740 
| select count(eid) as eid_count, targetuser| groupby targetuser| having  eid_count >=10 | duration 1d

stream=authentication where sourcename='WINDOWS' and eid=4740 and srcip ='SuspectUser'

stream=iam where sourcename='WINDOWS' and eid=4740 
| select count(eid) as eid_count, targetuser| groupby targetuser| having  eid_count >=10 | duration 1d

stream=authentication where sourcename='WINDOWS' and eid=4740 and user ='targettuser'

stream=iam | select targetuser, count_if(eid='4740') as eid_count |  groupby targetuser | checkif targetuser in AdminVIPList.VIPUser | having eid_count >= 3 | duration 1h

stream=iam where targetuser='{targetuser}'

stream=firewall where srctype='PUBLIC' and srcisp!='Schreiber Foods, Inc.' | groupby srcip, srcisp | duration 24h

stream=* where sourcename="SENTINELONE" | checkif system in SentinelOne.Hostname | groupby system | duration 2h

stream=win-audit and subjectuser='{SuspectUser}'

stream=win-audit where processname like '%lsass.exe%'
 or processname like '%Mimikatz%'
 or processname like '%Gsecdump%'
 or processname like '%ProcDump%'
 or processname like '%comsvcs.dll%'
 or processname like '%Nishang%' 
 or processname like '%NTDSUtil%' 
 or processname like '%memorydump.py%'
 or processname like '%metasploit%'
| groupby subjectuser, processname | duration 1h

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' | select targetuser, count(distinct(action)) as act | groupby targetuser |having act>=2| duration 1h

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' AND targetuser='{TargetUser}'

stream=win-audit and subjectuser='{SuspectUser}'

stream=win-audit where processname like '%lsass.exe%'
 or processname like '%Mimikatz%'
 or processname like '%Gsecdump%'
 or processname like '%ProcDump%'
 or processname like '%comsvcs.dll%'
 or processname like '%Nishang%' 
 or processname like '%NTDSUtil%' 
 or processname like '%memorydump.py%'
 or processname like '%metasploit%'
| groupby subjectuser, processname | duration 1h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hostname='{suspectHost}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
|select hostname, count(distinct(hash)) as unique_hash_count |groupby hostname|having unique_hash_count>=2| duration 48h

stream=firewall where srctype="PRIVATE" and dsttype="PRIVATE" and dstport is not NULL
| select  srcip, dstport, count(distinct(dstip)) as Dest_IP, count_if(act='accept') as allowed_traffic,
count_if(act='deny') as denied_traffic
| groupby srcip, dstport | having Dest_IP>=20 and denied_traffic>=20 and allowed_traffic>=1 | duration 1h

stream=firewall where srctype="PRIVATE" and dsttype="PRIVATE" and dstport is not NULL and dstport='{targetport}' and srcip='{suspecthost}'

stream=firewall where dstport=53 and user='{SuspectUser}'

stream=firewall where dstport=53 | checkif srcip not in DCIPs.DeviceIP | select srcip, count(dstport) as dns_count | groupby srcip | having dns_count>=10000

stream=iam where eid='4724' or eid='4723'| select subjectuser, count(eid) as act | groupby subjectuser |having act>=1| duration 1h

stream=iam where eid='4724' or eid='4723' and user='{SuspectUser}'

stream=signals | duration 10m

stream=firewall where srctype!="PRIVATE" and dstip='{targethost}' and srcip='{SuspectHost}'

stream=firewall where srctype!="PRIVATE"| select  srcip, dstip, count(distinct(dstport)) as PortCount, count_if(act='accept' or act='start') as allowed_traffic, count_if(act='deny') as denied_traffic
| groupby srcip, dstip | having PortCount>=20 and denied_traffic>=1 and allowed_traffic>=1 | duration 1h

stream=ep-process where commandline like 
"%.micro" or commandline like 

"%.zepto" or commandline like 

"%.cerber" or commandline like 

"%.locky" or commandline like 

"%.cerber3" or commandline like 

"%.cryp1" or commandline like 

"%.mole" or commandline like 

"%.onion" or commandline like 

"%.axx" or commandline like 

"%.osiris" or commandline like 

"%.crypz" or commandline like 

"%.crypt" or commandline like 

"%.locked" or commandline like 

"%.odin" or commandline like 

"%.ccc" or commandline like 

"%.cerber2" or commandline like 

"%.sage" or commandline like 

"%.globe" or commandline like 

"%.exx" or commandline like 

"%.good" or commandline like 

"%.wallet" or commandline like 

"%.1txt" or commandline like 

"%.decrypt2017" or commandline like 

"%.encrypt" or commandline like 

"%.ezz" or commandline like 

"%.zzzzz" or commandline like 

"%.MERRY" or commandline like 

"%.enciphered" or commandline like 

"%.r5a" or commandline like 

"%.aesir" or commandline like 

"%.ecc" or commandline like 

"%.enigma" or commandline like 

"%.cryptowall" or commandline like 

"%.encrypted" or commandline like 

"%.loli" or commandline like 

"%.breaking_bad" or commandline like 

"%.coded" or commandline like 

"%.ha3" or commandline like 

"%.damage" or commandline like 

"%.wcry" or commandline like 

"%.lol!" or commandline like 

"%.cryptolocker" or commandline like 

"%.dharma" or commandline like 

"%.MRCR1" or commandline like 

"%.sexy" or commandline like 

"%.crjoker" or commandline like 

"%.fantom" or commandline like 

"%.keybtc@inbox_com" or commandline like 

"%.rrk" or commandline like 

"%.legion" or commandline like 

"%.kratos" or commandline like 

"%.LeChiffre" or commandline like 

"%.kraken" or commandline like 

"%.zcrypt" or commandline like 

"%.maya" or commandline like 

"%.enc" or commandline like 

"%.file0locked" or commandline like 

"%.crinf" or commandline like 

"%.serp" or commandline like 

"%.potato" or commandline like 

"%.ytbl" or commandline like 

"%.surprise" or commandline like 

"%.angelamerkel" or commandline like 

"%.windows10" or commandline like 

"%.lesli" or commandline like 

"%.serpent" or commandline like 

"%.PEGS1" or commandline like 

"%.dale" or commandline like 

"%.pdcr" or commandline like 

"%.zzz" or commandline like 

"%.xyz" or commandline like 

"%.1cbu1" or commandline like 

"%.venusf" or commandline like 

"%.coverton" or commandline like 

"%.thor" or commandline like 

"%.rnsmwr" or commandline like 

"%.evillock" or commandline like 

"%.R16m01d05" or commandline like 

"%.wflx" or commandline like 

"%.nuclear55" or commandline like 

"%.darkness" or commandline like 

"%.encr" or commandline like 

"%.rekt" or commandline like 

"%.kernel_time" or commandline like 

"%.zyklon" or commandline like 

"%.Dexter" or commandline like 

"%.locklock" or commandline like 

"%.cry" or commandline like 

"%.VforVendetta" or commandline like 

"%.btc" or commandline like 

"%.raid10" or commandline like 

"%.dCrypt" or commandline like 

"%.zorro" or commandline like 

"%.AngleWare" or commandline like 

"%.EnCiPhErEd" or commandline like 

"%.purge" or commandline like 

"%.realfs0ciety@sigaint.org.fs0ciety" or commandline like 

"%.shit" or commandline like 

"%.atlas" or commandline like 

"%.exotic" or commandline like 

"%.crypted" or commandline like 

"%.padcrypt" or commandline like 

"%.xxx" or commandline like 

"%.hush" or commandline like 

"%.bin" or commandline like 

"%.vbransom" or commandline like 

"%.RMCM1" or commandline like 

"%.cryeye" or commandline like 

"%.unavailable" or commandline like 

"%.braincrypt" or commandline like 

"%.fucked" or commandline like 

"%.crypte" or commandline like 

"%._AiraCropEncrypted" or commandline like 

"%.stn" or commandline like 

"%.paym" or commandline like 

"%.spora" or commandline like 

"%.dll" or commandline like 

"%.RARE1" or commandline like 

"%.alcatraz" or commandline like 

"%.pzdc" or commandline like 

"%.aaa" or commandline like 

"%.encrypted" or commandline like 

"%.ttt" or commandline like 

"%.odcodc" or commandline like 

"%.vvv" or commandline like 

"%.ruby" or commandline like 

"%.pays" or commandline like 

"%.comrade" or commandline like 

"%.enc" or commandline like 

"%.abc" or commandline like 

"%.xxx" or commandline like 

"%.antihacker2017" or commandline like 

"%.herbst" or commandline like 

"%.szf" or commandline like 

"%.rekt" or commandline like 

"%.bript" or commandline like 

"%.crptrgr" or commandline like 

"%.kkk" or commandline like 

"%.rdm" or commandline like 

"%.BarRax" or commandline like 

"%.vindows" or commandline like 

"%.helpmeencedfiles" or commandline like 

"%.hnumkhotep" or commandline like 

"%.CCCRRRPPP" or commandline like 

"%.kyra" or commandline like 

"%.fun" or commandline like 

"%.rip" or commandline like 

"%.73i87A" or commandline like 

"%.bitstak" or commandline like 

"%.kernel_complete" or commandline like 

"%.payrms" or commandline like 

"%.a5zfn" or commandline like 

"%.perl" or commandline like 

"%.noproblemwedecfiles " or commandline like 

"%.lcked" or commandline like 

"%.p5tkjw" or commandline like 

"%.paymst"

stream=ep-process AND system='{TargetHost}'

stream=firewall where srctype!="PRIVATE" and dstip='{targethost}' and srcip='{SuspectHost}'

stream=firewall where srctype!="PRIVATE"| select  srcip, dstip, count(distinct(dstport)) as PortCount, count_if(act='accept') as allowed_traffic, count_if(act='deny') as denied_traffic
| groupby srcip, dstip | having PortCount>=20 and denied_traffic>=1 and allowed_traffic>=1 | duration 1h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!="" and hash='{suspecthash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!=""
|select count(distinct(hostname)) as host_count, hash | groupby hash | having host_count>=2 | duration 48h

stream=EP-Process where processname like '%mimitkatz%' or processname like '%sekurlsa%' and system='{TargetUser}'

stream=win-audit where processname like '%mimitkatz%' or processname like '%sekurlsa%' | duration 1h

stream=firewall where threattype='Malicious' and direction='outgoing' | groupby srcip, dstip, act | duration 24h

stream=firewall where srctype!="PRIVATE" and dstip='{targethost}' and srcip='{SuspectHost}'

stream=firewall where srctype!="PRIVATE"| select  srcip, dstip, count(distinct(dstport)) as PortCount, count_if(act='accept') as allowed_traffic, count_if(act='deny') as denied_traffic
| groupby srcip, dstip | having PortCount>=20 and denied_traffic>=1 and allowed_traffic>=1 | duration 1h

stream=iam where eid='4724' or eid='4723' and user='{SuspectUser}'

stream=iam where eid='4724' or eid='4723'| select subjectuser, count(eid) as act | groupby subjectuser |having act>=3| duration 1h

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED" AND devsrcip='{targethost}' and user='{suspectuser}'

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED" | select devsrcip,system,logevent, user | groupby devsrcip,system,logevent, user |  duration 1h

stream=authentication where sourcename="WINDOWS" AND action="LOGIN" AND status="FAILED" and user not like ('%$') and not rlike(user,"([a-zA-Z0-9]*)_.*") | select user, srcip, count(status) AS FailCount | groupby srcip,user | having FailCount>=50

stream=authentication where sourcename='WINDOWS' and rlike(user,"([a-zA-Z0-9]*)_.*") and logontype in ('2', '10', '11') | groupby user | duration 1h

stream=signals | duration 1d | limit 1

stream=iam where eid='4724' or eid='4723' and user='{SuspectUser}'

stream=iam where eid='4724' or eid='4723'| select subjectuser, count(eid) as act | groupby subjectuser |having act>=3| duration 1h

stream=EP-Process where processname like '%mimitkatz%' or processname like '%sekurlsa%' and system='{TargetUser}'

stream=win-audit where processname like '%mimitkatz%' or processname like '%sekurlsa%' | duration 1h

stream=authentication where action='LOGIN' and srcip !="-" and status="FAILED" and user!="Not Available" and 
reason!="AuthenticationFailedSasError" and user not like ('%$') | select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>25 and usercount >1 | duration 1h

stream=* where devsrcip!='10.70.18.249' | select distinct(devsrcip) as devsrcip, count(*) as event_count |groupby devsrcip | having event_count >1000000 | duration 1h

stream=iam | select targetdomain, count_if(eid='4740') as eid_count | checkif targetdomain not in DomainControllers.Hostname | groupby targetdomain | having eid_count >= 10 | duration 3h

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and dstip not in ('8.8.8.8','8.8.4.4') | groupby srcip, dstip | duration 24h | limit 20

stream=threat or stream=firewall where threattype='Malicious' and direction='outgoing' | groupby srcip|duration 1d |limit 10

stream=EP-Process where processname like '%mimitkatz%' or processname like '%sekurlsa%' and system='{TargetUser}'

stream=win-audit where processname like '%mimitkatz%' or processname like '%sekurlsa%' or processname like '%vds%' | duration 1h

stream=* | checkif devsrcip in CriticalDevices.Critical_Servers | groupby devsrcip | limit 500 | duration 2h

stream=signals | limit 10

stream=firewall where srctype="PRIVATE" | checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, dstport, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby srcip, dstport | having denied_count>=500 | duration 5m

stream=authentication where sourcename='CITRIX-ADC' and action='COMMAND_EXECUTED' and command like ("login%") and status = 'FAILED' | select srcip, user, count(status) as Fail_count | 
groupby srcip, user | duration 5m

stream=authentication where sourcename='CITRIX-ADC' and action='COMMAND_EXECUTED' and command like ("login%") and status = 'FAILED' and user='{targetuser}' and srcip='{suspecthost}'

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' | select user, system, distinct_count(srcip) as CntSrcIP | groupby user, system | having CntSrcIP > 3

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' and system='{TargetHost}' and user='{TargetUser}' | duration 6m

stream=firewall where srctype="PRIVATE" and dsttype="PRIVATE" and dstport is not NULL
| select  srcip, dstport, count(distinct(dstip)) as Dest_IP, count_if(act='accept') as allowed_traffic,
count_if(act='deny') as denied_traffic
| groupby srcip, dstport | having Dest_IP>=20 and denied_traffic>=20 and allowed_traffic>=1 | duration 1h

stream=firewall where srctype="PRIVATE" and dsttype="PRIVATE" and dstport is not NULL and dstport='{targetport}' and srcip='{suspecthost}'

stream=EP-FILE where action='FILE_CREATED' AND TargetFilename='where_my_files.txt' OR 
TargetFilename='how_to_recover_data.txt' OR TargetFilename='how_to_decrypt.txt' OR 
TargetFilename='contact_here_to_recover_your_files' OR 
$TargetFilename LIKE "%decrypt-files%readme%txt%" OR $TargetFilename 
LIKE "%decrypt-files%readme_for_decrypt%txt%"OR $TargetFilename LIKE "%decrypt%txt%" 
OR $TargetFilename LIKE "%decrypt%html%"

stream=authentication where sourcename='WINDOWS' and action='LOGIN' and status='FAILED' and reason='USER_DISABLED' and user not like '%$' 

stream=authentication where sourcename='WINDOWS' and action='LOGIN' and status='FAILED' and user not like '%$' 
|select user, count(action) as act| groupby user| having act>=10 | duration 1h

stream=authentication where eid='4825' and sourcename='WINDOWS' | select srcip, user, count(eid) as num | groupby srcip, user | having num>=3 |  duration 1h

stream=authentication where eid='4825' and sourcename='WINDOWS' AND srcip='{SuspectHost}'

stream=EP-FILE where action='FILE_CREATED' AND TargetFilename='where_my_files.txt' OR 
TargetFilename='how_to_recover_data.txt' OR TargetFilename='how_to_decrypt.txt' OR 
TargetFilename='contact_here_to_recover_your_files' OR 
$TargetFilename LIKE "%decrypt-files%readme%txt%" OR $TargetFilename 
LIKE "%decrypt-files%readme_for_decrypt%txt%"OR $TargetFilename LIKE "%decrypt%txt%" 
OR $TargetFilename LIKE "%decrypt%html%"

stream=firewall where dstport NOT in (21,22,23,69,115,990,989) and proto in ('FTP', 'SSH', 'SFTP', 'TFTP', 'TELNET', 'FTPS') and srcip='{SuspectHost}'

stream=firewall where dstport NOT in (21,22,23,69,115,990,989) and proto in ('FTP', 'SSH', 'SFTP', 'TFTP', 'TELNET', 'FTPS')
| groupby srcip | duration 1h

stream=firewall where srctype="PRIVATE" | checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, dstport, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby srcip, dstport | having denied_count>=500 | duration 5m

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and act='deny' and dstport in (445, 3389, 22)
|select count(action) as act_count, srcip| having act_count>=100| groupby srcip| duration 5m

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and act='deny' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=threat where sourcename='FORCEPOINT-DLP' and action='THREAT_DETECTED' and threat = "Block SOF Web Uploads" | select user, count(action) as blocked_count | groupby user | having blocked_count>=50 | duration 1h

stream=threat where sourcename='FORCEPOINT-DLP' and action='THREAT_DETECTED' and threat = "Block SOF Web Uploads" and user='{suspectuser}'

stream=iam where sourcename='WINDOWS' and eid=4740 
| select count(eid) as eid_count, targetuser| groupby targetuser| having  eid_count >=10 | duration 1d

stream=authentication where sourcename='WINDOWS' and eid=4740 and user ='targettuser'

stream=* | groupby devsrcip | duration from 2023-09-01T10:30:00 to 2023-09-02T09:29:59

stream=authentication where sourcename='WINDOWS' and eid=4740 and user ='targettuser'

stream=iam where sourcename='WINDOWS' and eid=4740 | select count(eid) as eid_count, targetuser | groupby targetuser | having  eid_count >=10 | duration 6h

stream=authentication where sourcetype="FIREWALL" AND action="LOGIN" AND status="FAILED"| select srcip, devsrcip, count(status) AS FailCount | groupby srcip,devsrcip | having FailCount>=10 | duration 5m

stream=authentication where sourcetype="FIREWALL" AND action="LOGIN" AND status="FAILED" ANd srcip='{suspecthost}' and devsrcip='{targethost}'

stream=signals | limit 10

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and attackedparty!='VIP'|duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False'

stream=iam where targetdomain not like '%MS1' | select targetdomain, count_if(eid='4740') as eid_count | checkif targetdomain not in DomainControllers.Hostname | groupby targetdomain | having eid_count >= 10 | duration 3h

stream=iam where (eid='4724' or eid='4723') and subjectuser!='iiq_ad_admin_prod' | checkif subjectuser not in AdminVIPList.AdminUser |  select subjectuser, count(eid) as act | groupby subjectuser | having act>=3 | duration 30m

stream=iam where eid='4724' or eid='4723' and user='{SuspectUser}'

stream=firewall where srctype="PUBLIC" 
| select  srcip, dstport, count(distinct(dstip)) as dst_ip, count_if(act='accept') as allowed_traffic, 
count_if(act='deny') as denied_traffic
| groupby srcip, dstport | having dst_ip>=20 and denied_traffic>=20 and allowed_traffic>=1 | duration 10m

stream=firewall where srctype='PUBLIC' AND dstport='{TargetPort}' AND srcip='{SuspectHost}'

stream=authentication where sourcename="NIX" AND action="LOGIN" AND status="FAILED" | select srcip, count(status) AS FailCount
 | groupby srcip | having FailCount>=50

stream=authentication where sourcename="NIX" AND action="LOGIN" AND status="FAILED" AND srcip='{SuspectHost}'

stream=authentication where eid='4825' and sourcename='WINDOWS' | select srcip, user, count(eid) as num | groupby srcip, user | having num>=3 |  duration 1h

stream=authentication where eid='4825' and sourcename='WINDOWS' AND srcip='{SuspectHost}'

stream=authentication where sourcename="WINDOWS" and action="LOGIN" and status="FAILED" and user not like "%$" | select user, count(status) as FailCount |  groupby user | having FailCount>5 | duration 3m

stream=authentication where sourcename="WINDOWS" and action="LOGIN" and status="FAILED" and user='{targetuser}'

stream=authentication where action='LOGIN' and status='FAILED' and user='{targetuser}' and srcip='{suspecthost}'

stream=authentication where action='LOGIN' and status='FAILED' | checkif user in AdminVIPList.AdminUser |
 select user, srcip,count(status) as act | groupby user, srcip | having act>=5 | duration 10m

stream=authentication where action='LOGIN' and status='FAILED' | checkif user in AdminVIPList.VIPUser |
 select user, srcip,count(status) as act | groupby user, srcip | having act>=1 | duration 10d

stream=authentication where action='LOGIN' and status='FAILED' and user='{targetuser}' and srcip='{suspecthost}'

stream=signals | limit 10

stream=firewall where srctype='PUBLIC' AND dstport='{TargetPort}' AND srcip='{SuspectHost}'

stream=firewall where srctype="PUBLIC" 
| select  srcip, dstport, count(distinct(dstip)) as dst_ip, count_if(act='accept') as allowed_traffic, 
count_if(act='deny') as denied_traffic
| groupby srcip, dstport | having dst_ip>=20 and denied_traffic>=20 and allowed_traffic>=1 | duration 10m

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
|select user, count(distinct(srccn)) as country_count| having country_count>=2| groupby user| duration 30m

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
and host='{suspectsrcip}' and user='{targetuser}'

stream=configuration where sourcename='WINDOWS' and eid=6416 | duration 1h

stream=authentication where action='LOGIN' and status='FAILED' | checkif user in AdminVIPList.VIPUser |
 select user, srcip,count(status) as act | groupby user, srcip | having act>=1 | duration 10m

stream=authentication where action='LOGIN' and status='FAILED' and user='{targetuser}' and srcip='{suspecthost}'

stream=firewall where srctype='PUBLIC' AND dstport='{TargetPort}' AND srcip='{SuspectHost}'

stream=firewall where srctype="PUBLIC" 
| select  srcip, dstport, count(distinct(dstip)) as dst_ip, count_if(act='accept') as allowed_traffic, 
count_if(act='deny') as denied_traffic
| groupby srcip, dstport | having dst_ip>=20 and denied_traffic>=20 and allowed_traffic>=1 | duration 10m

stream=authentication where action='LOGIN' and host='{suspectsrcip}' and user='{targetuser}'

stream=authentication where action='LOGIN'|select count(distinct(srccn)) as country_count, srccn, user, srcip| having country_count>=1| groupby srccn, user, srcip| duration 1d

stream=authentication where action='LOGIN' and sourcename='MS-O365' and status="FAILED" and user!="Not Available"
| select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 1h

stream=authentication where sourcetype="FIREWALL" AND action="LOGIN" AND status="FAILED"| select srcip, devsrcip, count(status) AS FailCount | groupby srcip,devsrcip | having FailCount>=10 | duration 1h

stream=authentication where sourcetype="FIREWALL" AND action="LOGIN" AND status="FAILED" ANd srcip='{suspecthost}' and devsrcip='{targethost}'

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED" AND devsrcip='{targethost}' and user='{suspectuser}'

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED" | select devsrcip,system,logevent, user | groupby devsrcip,system,logevent, user |  duration 1h

stream=firewall where threattype='Malicious' and act not in ('deny','block') | groupby srcip, dstip, act, threattype |  duration 1d

stream=authentication where action='LOGIN'|select count(distinct(srccn)) as country_count, srccn, user, srcip| having country_count>=2| groupby srccn, user, srcip| duration 1d

stream=authentication where action='LOGIN' and host='{suspectsrcip}' and user='{targetuser}'

stream=firewall where srctype='PUBLIC' and act ='accept' and dstport in ('22','139','445') and (srcip not like ('198.185.9.%') and srcip not like ('198.185.11.%')) and policyname!='SSH & FTP Whitelist to MFT' and policyname!='SSH to Prod SFTP Server' 
| groupby srcip, dstip | duration 1h

stream=iam where eid=4720 and subjectuser!='iiq_ad_admin_prod' and subjectuser not like ('%$')|checkif subjectuser not in AdminVIPList.AdminUser |groupby subjectuser, targetuser| duration 1h

stream=webfilter | checkif @domain in tcstipdomain.domain | groupby srcip, dstip  | duration 1h

stream=webfilter | checkif @domain in tcstipdomain.domain | groupby srcip, dstip | duration 1h

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and not rlike(user,"([a-zA-Z0-9]*)_.*") and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON'
| checkif workstation not in DCandADFS.Hostname
| select user, logontype, count(distinct(workstation)) as unique_system 
| groupby user, logontype| having unique_system>=3 | duration 30m

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON' and user='{SuspectUser}' and unique_system='{TargetHost}'

stream=authentication where sourcename='WINDOWS' and action='LOGIN' and status='FAILED' and reason='USER_DISABLED' and user not like '%$' 

stream=authentication where sourcename='WINDOWS' and action='LOGIN' and status='FAILED' and reason='USER_DISABLED' user not like '%$' 
|select user, count(action) as act| groupby user| having act>=10 | duration 1h

stream=authentication where sourcetype="FIREWALL" AND action="LOGIN" AND status="FAILED"| select srcip, devsrcip, count(status) AS FailCount | groupby srcip,devsrcip | having FailCount>=10 | duration 1h

stream=authentication where sourcetype="FIREWALL" AND action="LOGIN" AND status="FAILED" ANd srcip='{suspecthost}' and devsrcip='{targethost}'

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
and host='{suspectsrcip}' and user='{targetuser}'

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
|select user, count(distinct(srccn)) as country_count| having country_count>=1| groupby user| duration 30m

stream=iam where eid=4720  and subjectuser not like ('%$')|checkif subjectuser not in AdminVIPList.AdminUser |groupby subjectuser, targetuser| duration 1h

stream=ep-process where commandline like 
"%.micro" or commandline like 

"%.zepto" or commandline like 

"%.cerber" or commandline like 

"%.locky" or commandline like 

"%.cerber3" or commandline like 

"%.cryp1" or commandline like 

"%.mole" or commandline like 

"%.onion" or commandline like 

"%.axx" or commandline like 

"%.osiris" or commandline like 

"%.crypz" or commandline like 

"%.crypt" or commandline like 

"%.locked" or commandline like 

"%.odin" or commandline like 

"%.ccc" or commandline like 

"%.cerber2" or commandline like 

"%.sage" or commandline like 

"%.globe" or commandline like 

"%.exx" or commandline like 

"%.good" or commandline like 

"%.wallet" or commandline like 

"%.1txt" or commandline like 

"%.decrypt2017" or commandline like 

"%.encrypt" or commandline like 

"%.ezz" or commandline like 

"%.zzzzz" or commandline like 

"%.MERRY" or commandline like 

"%.enciphered" or commandline like 

"%.r5a" or commandline like 

"%.aesir" or commandline like 

"%.ecc" or commandline like 

"%.enigma" or commandline like 

"%.cryptowall" or commandline like 

"%.encrypted" or commandline like 

"%.loli" or commandline like 

"%.breaking_bad" or commandline like 

"%.coded" or commandline like 

"%.ha3" or commandline like 

"%.damage" or commandline like 

"%.wcry" or commandline like 

"%.lol!" or commandline like 

"%.cryptolocker" or commandline like 

"%.dharma" or commandline like 

"%.MRCR1" or commandline like 

"%.sexy" or commandline like 

"%.crjoker" or commandline like 

"%.fantom" or commandline like 

"%.keybtc@inbox_com" or commandline like 

"%.rrk" or commandline like 

"%.legion" or commandline like 

"%.kratos" or commandline like 

"%.LeChiffre" or commandline like 

"%.kraken" or commandline like 

"%.zcrypt" or commandline like 

"%.maya" or commandline like 

"%.enc" or commandline like 

"%.file0locked" or commandline like 

"%.crinf" or commandline like 

"%.serp" or commandline like 

"%.potato" or commandline like 

"%.ytbl" or commandline like 

"%.surprise" or commandline like 

"%.angelamerkel" or commandline like 

"%.windows10" or commandline like 

"%.lesli" or commandline like 

"%.serpent" or commandline like 

"%.PEGS1" or commandline like 

"%.dale" or commandline like 

"%.pdcr" or commandline like 

"%.zzz" or commandline like 

"%.xyz" or commandline like 

"%.1cbu1" or commandline like 

"%.venusf" or commandline like 

"%.coverton" or commandline like 

"%.thor" or commandline like 

"%.rnsmwr" or commandline like 

"%.evillock" or commandline like 

"%.R16m01d05" or commandline like 

"%.wflx" or commandline like 

"%.nuclear55" or commandline like 

"%.darkness" or commandline like 

"%.encr" or commandline like 

"%.rekt" or commandline like 

"%.kernel_time" or commandline like 

"%.zyklon" or commandline like 

"%.Dexter" or commandline like 

"%.locklock" or commandline like 

"%.cry" or commandline like 

"%.VforVendetta" or commandline like 

"%.btc" or commandline like 

"%.raid10" or commandline like 

"%.dCrypt" or commandline like 

"%.zorro" or commandline like 

"%.AngleWare" or commandline like 

"%.EnCiPhErEd" or commandline like 

"%.purge" or commandline like 

"%.realfs0ciety@sigaint.org.fs0ciety" or commandline like 

"%.shit" or commandline like 

"%.atlas" or commandline like 

"%.exotic" or commandline like 

"%.crypted" or commandline like 

"%.padcrypt" or commandline like 

"%.xxx" or commandline like 

"%.hush" or commandline like 

"%.bin" or commandline like 

"%.vbransom" or commandline like 

"%.RMCM1" or commandline like 

"%.cryeye" or commandline like 

"%.unavailable" or commandline like 

"%.braincrypt" or commandline like 

"%.fucked" or commandline like 

"%.crypte" or commandline like 

"%._AiraCropEncrypted" or commandline like 

"%.stn" or commandline like 

"%.paym" or commandline like 

"%.spora" or commandline like 

"%.dll" or commandline like 

"%.RARE1" or commandline like 

"%.alcatraz" or commandline like 

"%.pzdc" or commandline like 

"%.aaa" or commandline like 

"%.encrypted" or commandline like 

"%.ttt" or commandline like 

"%.odcodc" or commandline like 

"%.vvv" or commandline like 

"%.ruby" or commandline like 

"%.pays" or commandline like 

"%.comrade" or commandline like 

"%.enc" or commandline like 

"%.abc" or commandline like 

"%.xxx" or commandline like 

"%.antihacker2017" or commandline like 

"%.herbst" or commandline like 

"%.szf" or commandline like 

"%.rekt" or commandline like 

"%.bript" or commandline like 

"%.crptrgr" or commandline like 

"%.kkk" or commandline like 

"%.rdm" or commandline like 

"%.BarRax" or commandline like 

"%.vindows" or commandline like 

"%.helpmeencedfiles" or commandline like 

"%.hnumkhotep" or commandline like 

"%.CCCRRRPPP" or commandline like 

"%.kyra" or commandline like 

"%.fun" or commandline like 

"%.rip" or commandline like 

"%.73i87A" or commandline like 

"%.bitstak" or commandline like 

"%.kernel_complete" or commandline like 

"%.payrms" or commandline like 

"%.a5zfn" or commandline like 

"%.perl" or commandline like 

"%.noproblemwedecfiles " or commandline like 

"%.lcked" or commandline like 

"%.p5tkjw" or commandline like 

"%.paymst"|  duration 30d

stream=ep-process and system='{SuspectHost}'

stream=EP-FILE where action='FILE_CREATED' AND TargetFilename='where_my_files.txt' OR 
TargetFilename='how_to_recover_data.txt' OR TargetFilename='how_to_decrypt.txt' OR 
TargetFilename='contact_here_to_recover_your_files' OR 
$TargetFilename LIKE "%decrypt-files%readme%txt%" OR $TargetFilename 
LIKE "%decrypt-files%readme_for_decrypt%txt%"OR $TargetFilename LIKE "%decrypt%txt%" 
OR $TargetFilename LIKE "%decrypt%html%"

stream=firewall where srctype="PRIVATE" and dsttype="PRIVATE"
| select  srcip, dstip, count(distinct(dstport)) as Port_Count, count_if(act='accept') as allowed_traffic, 
count_if(act='deny') as denied_traffic
| groupby srcip, dstip | having Port_Count>=20 and  denied_traffic>=20 and  allowed_traffic>=1 | duration 1h

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED" | select devsrcip,system,logevent, user | groupby devsrcip,system,logevent, user |  duration 1d

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED" AND devsrcip='{targethost}' and user='{suspectuser}'

stream=other | limit 1

stream=authentication where action='LOGIN' and status='FAILED' and srcip!='NULL'|select srcip, count(distinct(user)) as count_users|groupby srcip|having count_users>=3

stream=authentication where action='LOGIN' and status='FAILED' and srcip='{SuspectHost}'

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
|select user, count(distinct(srccn)) as country_count| having country_count>=2| groupby user| duration 30m

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
and host='{suspectsrcip}' and user='{targetuser}'

stream=FIREWALL where action='PACKET_ALLOWED' and dstport='3389' and srctype='PUBLIC' | groupby srcip, dstip

stream=FIREWALL where action='PACKET_ALLOWED' and dstport='3389' and srctype='PUBLIC' and dstip='{TargetHost}' and srcip='{SuspectHost}' | duration 6m

stream=other | limit 1

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
|select user, count(distinct(srccn)) as country_count| having country_count>=2| groupby user| duration 30m

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
and host='{suspectsrcip}' and user='{targetuser}'

stream=firewall where srctype="PRIVATE" and dsttype="PRIVATE"
| select  srcip, dstip, count(distinct(dstport)) as Port_Count, count_if(act='accept') as allowed_traffic, 
count_if(act='deny') as denied_traffic
| groupby srcip, dstip | having Port_Count>=20 and  denied_traffic>=20 and  allowed_traffic>=1 | duration 1h

stream=configuration where sourcename='WINDOWS' and eid=6416 | duration 1h

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED" AND devsrcip='{targethost}' and user='{suspectuser}'

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED" | select devsrcip,system,logevent, user | groupby devsrcip,system,logevent, user |  duration 1d

stream=iam where eid=4720 and subjectuser!='iiq_ad_admin_prod' and subjectuser not like ('%$')|checkif subjectuser not in AdminVIPList.AdminUser 
|groupby subjectuser, targetuser| duration 1h

stream=webfilter | checkif @domain in tcstipdomain.domain | groupby srcip, dstip | duration 1h

stream=firewall where dstip='{SuspectHost}'

stream=firewall | select dstip, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby dstip | having denied_count>=5000

stream=firewall where threattype='Malicious' and act not in ('deny','block') and srctype="PRIVATE" and dsttype="PUBLIC"
 and dstisp!='SCHREIBERFOODS' and severitylevel="High" and confidencelevel="High" | groupby dstip

stream=other | limit 1

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED" AND devsrcip='{targethost}' and user='{suspectuser}'

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED" | select devsrcip,system,logevent, user | groupby devsrcip,system,logevent, user |  duration 1h

stream=iam where eid=4720 and subjectuser!='iiq_ad_admin_prod' and subjectuser not like ('%$')|checkif subjectuser not in AdminVIPList.AdminUser 
|groupby subjectuser, targetuser| duration 1h

stream=other | limit 1

stream=ep-dns where action='DNS_QUERY'| select user, image, count_if(status='FAILED') as deny_count| groupby user, image 
| having deny_count > 10000 |  duration 1h

stream=ep-dns and user='{SuspectUser}'

stream=firewall where dstport=53 and user='{SuspectUser}'

stream=firewall where dstport=53 and action='PACKET_BLOCKED' | checkif srcip not in DCIPs.DeviceIP | select srcip, count(dstport) as dns_count | groupby srcip | having dns_count>=1000

stream=win-audit where eid='4698' or eid='602' or eid='4699' |select user, count(distinct(eid)) as unique_eid
|groupby user| having unique_eid >=2 |  duration 30m

stream=webfilter | checkif @domain in tcstipdomain.domain | groupby srcip, dstip | duration 1h

stream=other | limit 1

stream=other | limit 1

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=firewall where srctype='PUBLIC' and act='accept' and srcip not like '198.185.9.%' and srcip not like '198.185.11.%' | select count(dstport) as port_count, count(distinct(dstip)) as dstip_count, srcip | groupby srcip | having port_count>=10 and dstip_count>=10 | duration 5m

stream=firewall where srctype="PRIVATE" | checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby srcip | having denied_count>=2000 | duration 5m

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and ispostremediated='False'|duration 1h

stream=email-gateway where action='EMAIL_SENT' and sender like '%@schreiberfoods%' | select sender,subject, count(action) as number_of_emails_sent 
| groupby sender,subject| having number_of_emails_sent>50

stream=email-gateway where action='EMAIL_SENT' and sender='{SuspectUser}'

stream=threat or stream=firewall where threattype='Malicious' and direction='outgoing' | groupby srcip|duration 1d |limit 10

stream=other | limit 1

stream=authentication where action='LOGIN' and status='FAILED' and srcip!='NULL'|select srcip, count(distinct(user)) as count_users|groupby srcip|having count_users>=3

stream=authentication where action='LOGIN' and status='FAILED' and srcip='{SuspectHost}'

stream=authentication where action='LOGIN' and status='FAILED' and srcip!='NULL'|select srcip, count(distinct(user)) as count_users|groupby srcip|having count_users>=3

stream=authentication where action='LOGIN' and status='FAILED' and srcip='{SuspectHost}'

stream=ep-process where commandline like 
"%.micro" or commandline like 

"%.zepto" or commandline like 

"%.cerber" or commandline like 

"%.locky" or commandline like 

"%.cerber3" or commandline like 

"%.cryp1" or commandline like 

"%.mole" or commandline like 

"%.onion" or commandline like 

"%.axx" or commandline like 

"%.osiris" or commandline like 

"%.crypz" or commandline like 

"%.crypt" or commandline like 

"%.locked" or commandline like 

"%.odin" or commandline like 

"%.ccc" or commandline like 

"%.cerber2" or commandline like 

"%.sage" or commandline like 

"%.globe" or commandline like 

"%.exx" or commandline like 

"%.good" or commandline like 

"%.wallet" or commandline like 

"%.1txt" or commandline like 

"%.decrypt2017" or commandline like 

"%.encrypt" or commandline like 

"%.ezz" or commandline like 

"%.zzzzz" or commandline like 

"%.MERRY" or commandline like 

"%.enciphered" or commandline like 

"%.r5a" or commandline like 

"%.aesir" or commandline like 

"%.ecc" or commandline like 

"%.enigma" or commandline like 

"%.cryptowall" or commandline like 

"%.encrypted" or commandline like 

"%.loli" or commandline like 

"%.breaking_bad" or commandline like 

"%.coded" or commandline like 

"%.ha3" or commandline like 

"%.damage" or commandline like 

"%.wcry" or commandline like 

"%.lol!" or commandline like 

"%.cryptolocker" or commandline like 

"%.dharma" or commandline like 

"%.MRCR1" or commandline like 

"%.sexy" or commandline like 

"%.crjoker" or commandline like 

"%.fantom" or commandline like 

"%.keybtc@inbox_com" or commandline like 

"%.rrk" or commandline like 

"%.legion" or commandline like 

"%.kratos" or commandline like 

"%.LeChiffre" or commandline like 

"%.kraken" or commandline like 

"%.zcrypt" or commandline like 

"%.maya" or commandline like 

"%.enc" or commandline like 

"%.file0locked" or commandline like 

"%.crinf" or commandline like 

"%.serp" or commandline like 

"%.potato" or commandline like 

"%.ytbl" or commandline like 

"%.surprise" or commandline like 

"%.angelamerkel" or commandline like 

"%.windows10" or commandline like 

"%.lesli" or commandline like 

"%.serpent" or commandline like 

"%.PEGS1" or commandline like 

"%.dale" or commandline like 

"%.pdcr" or commandline like 

"%.zzz" or commandline like 

"%.xyz" or commandline like 

"%.1cbu1" or commandline like 

"%.venusf" or commandline like 

"%.coverton" or commandline like 

"%.thor" or commandline like 

"%.rnsmwr" or commandline like 

"%.evillock" or commandline like 

"%.R16m01d05" or commandline like 

"%.wflx" or commandline like 

"%.nuclear55" or commandline like 

"%.darkness" or commandline like 

"%.encr" or commandline like 

"%.rekt" or commandline like 

"%.kernel_time" or commandline like 

"%.zyklon" or commandline like 

"%.Dexter" or commandline like 

"%.locklock" or commandline like 

"%.cry" or commandline like 

"%.VforVendetta" or commandline like 

"%.btc" or commandline like 

"%.raid10" or commandline like 

"%.dCrypt" or commandline like 

"%.zorro" or commandline like 

"%.AngleWare" or commandline like 

"%.EnCiPhErEd" or commandline like 

"%.purge" or commandline like 

"%.realfs0ciety@sigaint.org.fs0ciety" or commandline like 

"%.shit" or commandline like 

"%.atlas" or commandline like 

"%.exotic" or commandline like 

"%.crypted" or commandline like 

"%.padcrypt" or commandline like 

"%.xxx" or commandline like 

"%.hush" or commandline like 

"%.bin" or commandline like 

"%.vbransom" or commandline like 

"%.RMCM1" or commandline like 

"%.cryeye" or commandline like 

"%.unavailable" or commandline like 

"%.braincrypt" or commandline like 

"%.fucked" or commandline like 

"%.crypte" or commandline like 

"%._AiraCropEncrypted" or commandline like 

"%.stn" or commandline like 

"%.paym" or commandline like 

"%.spora" or commandline like 

"%.dll" or commandline like 

"%.RARE1" or commandline like 

"%.alcatraz" or commandline like 

"%.pzdc" or commandline like 

"%.aaa" or commandline like 

"%.encrypted" or commandline like 

"%.ttt" or commandline like 

"%.odcodc" or commandline like 

"%.vvv" or commandline like 

"%.ruby" or commandline like 

"%.pays" or commandline like 

"%.comrade" or commandline like 

"%.enc" or commandline like 

"%.abc" or commandline like 

"%.xxx" or commandline like 

"%.antihacker2017" or commandline like 

"%.herbst" or commandline like 

"%.szf" or commandline like 

"%.rekt" or commandline like 

"%.bript" or commandline like 

"%.crptrgr" or commandline like 

"%.kkk" or commandline like 

"%.rdm" or commandline like 

"%.BarRax" or commandline like 

"%.vindows" or commandline like 

"%.helpmeencedfiles" or commandline like 

"%.hnumkhotep" or commandline like 

"%.CCCRRRPPP" or commandline like 

"%.kyra" or commandline like 

"%.fun" or commandline like 

"%.rip" or commandline like 

"%.73i87A" or commandline like 

"%.bitstak" or commandline like 

"%.kernel_complete" or commandline like 

"%.payrms" or commandline like 

"%.a5zfn" or commandline like 

"%.perl" or commandline like 

"%.noproblemwedecfiles " or commandline like 

"%.lcked" or commandline like 

"%.p5tkjw" or commandline like 

"%.paymst"|  duration 30d

stream=ep-process and system='{SuspectHost}'

stream=ep-process where commandline like 
"%.micro" or commandline like 

"%.zepto" or commandline like 

"%.cerber" or commandline like 

"%.locky" or commandline like 

"%.cerber3" or commandline like 

"%.cryp1" or commandline like 

"%.mole" or commandline like 

"%.onion" or commandline like 

"%.axx" or commandline like 

"%.osiris" or commandline like 

"%.crypz" or commandline like 

"%.crypt" or commandline like 

"%.locked" or commandline like 

"%.odin" or commandline like 

"%.ccc" or commandline like 

"%.cerber2" or commandline like 

"%.sage" or commandline like 

"%.globe" or commandline like 

"%.exx" or commandline like 

"%.good" or commandline like 

"%.wallet" or commandline like 

"%.1txt" or commandline like 

"%.decrypt2017" or commandline like 

"%.encrypt" or commandline like 

"%.ezz" or commandline like 

"%.zzzzz" or commandline like 

"%.MERRY" or commandline like 

"%.enciphered" or commandline like 

"%.r5a" or commandline like 

"%.aesir" or commandline like 

"%.ecc" or commandline like 

"%.enigma" or commandline like 

"%.cryptowall" or commandline like 

"%.encrypted" or commandline like 

"%.loli" or commandline like 

"%.breaking_bad" or commandline like 

"%.coded" or commandline like 

"%.ha3" or commandline like 

"%.damage" or commandline like 

"%.wcry" or commandline like 

"%.lol!" or commandline like 

"%.cryptolocker" or commandline like 

"%.dharma" or commandline like 

"%.MRCR1" or commandline like 

"%.sexy" or commandline like 

"%.crjoker" or commandline like 

"%.fantom" or commandline like 

"%.keybtc@inbox_com" or commandline like 

"%.rrk" or commandline like 

"%.legion" or commandline like 

"%.kratos" or commandline like 

"%.LeChiffre" or commandline like 

"%.kraken" or commandline like 

"%.zcrypt" or commandline like 

"%.maya" or commandline like 

"%.enc" or commandline like 

"%.file0locked" or commandline like 

"%.crinf" or commandline like 

"%.serp" or commandline like 

"%.potato" or commandline like 

"%.ytbl" or commandline like 

"%.surprise" or commandline like 

"%.angelamerkel" or commandline like 

"%.windows10" or commandline like 

"%.lesli" or commandline like 

"%.serpent" or commandline like 

"%.PEGS1" or commandline like 

"%.dale" or commandline like 

"%.pdcr" or commandline like 

"%.zzz" or commandline like 

"%.xyz" or commandline like 

"%.1cbu1" or commandline like 

"%.venusf" or commandline like 

"%.coverton" or commandline like 

"%.thor" or commandline like 

"%.rnsmwr" or commandline like 

"%.evillock" or commandline like 

"%.R16m01d05" or commandline like 

"%.wflx" or commandline like 

"%.nuclear55" or commandline like 

"%.darkness" or commandline like 

"%.encr" or commandline like 

"%.rekt" or commandline like 

"%.kernel_time" or commandline like 

"%.zyklon" or commandline like 

"%.Dexter" or commandline like 

"%.locklock" or commandline like 

"%.cry" or commandline like 

"%.VforVendetta" or commandline like 

"%.btc" or commandline like 

"%.raid10" or commandline like 

"%.dCrypt" or commandline like 

"%.zorro" or commandline like 

"%.AngleWare" or commandline like 

"%.EnCiPhErEd" or commandline like 

"%.purge" or commandline like 

"%.realfs0ciety@sigaint.org.fs0ciety" or commandline like 

"%.shit" or commandline like 

"%.atlas" or commandline like 

"%.exotic" or commandline like 

"%.crypted" or commandline like 

"%.padcrypt" or commandline like 

"%.xxx" or commandline like 

"%.hush" or commandline like 

"%.bin" or commandline like 

"%.vbransom" or commandline like 

"%.RMCM1" or commandline like 

"%.cryeye" or commandline like 

"%.unavailable" or commandline like 

"%.braincrypt" or commandline like 

"%.fucked" or commandline like 

"%.crypte" or commandline like 

"%._AiraCropEncrypted" or commandline like 

"%.stn" or commandline like 

"%.paym" or commandline like 

"%.spora" or commandline like 

"%.dll" or commandline like 

"%.RARE1" or commandline like 

"%.alcatraz" or commandline like 

"%.pzdc" or commandline like 

"%.aaa" or commandline like 

"%.encrypted" or commandline like 

"%.ttt" or commandline like 

"%.odcodc" or commandline like 

"%.vvv" or commandline like 

"%.ruby" or commandline like 

"%.pays" or commandline like 

"%.comrade" or commandline like 

"%.enc" or commandline like 

"%.abc" or commandline like 

"%.xxx" or commandline like 

"%.antihacker2017" or commandline like 

"%.herbst" or commandline like 

"%.szf" or commandline like 

"%.rekt" or commandline like 

"%.bript" or commandline like 

"%.crptrgr" or commandline like 

"%.kkk" or commandline like 

"%.rdm" or commandline like 

"%.BarRax" or commandline like 

"%.vindows" or commandline like 

"%.helpmeencedfiles" or commandline like 

"%.hnumkhotep" or commandline like 

"%.CCCRRRPPP" or commandline like 

"%.kyra" or commandline like 

"%.fun" or commandline like 

"%.rip" or commandline like 

"%.73i87A" or commandline like 

"%.bitstak" or commandline like 

"%.kernel_complete" or commandline like 

"%.payrms" or commandline like 

"%.a5zfn" or commandline like 

"%.perl" or commandline like 

"%.noproblemwedecfiles " or commandline like 

"%.lcked" or commandline like 

"%.p5tkjw" or commandline like 

"%.paymst"|  duration 30d

stream=ep-process AND system='{TargetHost}'

stream=firewall where srctype="PUBLIC" and srcisp!='SCHREIBERFOODS' | select srcip, srcisp, count_if(action='PACKET_BLOCKED') as denied_count | groupby srcip, srcisp | having denied_count>=1000 | duration 5m

stream=firewall where srctype="PUBLIC" and srcip='{SuspectHost}'

stream=authentication where sourcename='WINDOWS' and rlike(user,"([a-zA-Z0-9]*)_.*") and logontype in ('2', '10', '11') | groupby user | duration 1h

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=firewall where srctype='PUBLIC' and act='accept' and srcip not like '198.185.9.%' and srcip not like '198.185.11.%' | select count(dstport) as port_count, count(distinct(dstip)) as dstip_count, srcip | groupby srcip | having port_count>=10 and dstip_count>=10 | duration 5m

stream=firewall where srctype='PUBLIC' AND dstport='{TargetPort}' AND srcip='{SuspectHost}'

stream=firewall where srctype="PUBLIC" and srcisp!='SCHREIBERFOODS'
| select  srcip, dstport, count(distinct(dstip)) as dst_ip, count_if(act='accept') as allowed_traffic, 
count_if(act='deny') as denied_traffic
| groupby srcip, dstport | having dst_ip>=20 and denied_traffic>=20 and allowed_traffic>=1 | duration 10m

stream=iam where action='USER_CREATED' or action='USER_DELETED'

| select user, count(distinct(action)) | groupby user |having action=2| duration 1h

stream=iam where action='USER_ACCOUNT_CREATED' or action='USER_ACCOUNT_DELETED' and user='{suspectuser}'

stream=authentication where action='LOGIN' and srcip !="-" and status="FAILED" and user!="Not Available" and 
reason!="AuthenticationFailedSasError" and user not like ('%$') | select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 1h

stream=authentication where sourcename='WINDOWS' and rlike(user,"([a-zA-Z0-9]*)_.*")  | groupby user | duration 1h

stream=* where devsrcip!='10.70.18.249' | select distinct(devsrcip) as devsrcip, count(*) as event_count |groupby devsrcip | having event_count >1000000 | duration 1h

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and not rlike(user,"([a-zA-Z0-9]*)_.*") and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON'
| checkif workstation not in DCandADFS.Hostname
| select user, logontype, count(distinct(workstation)) as unique_system 
| groupby user, logontype| having unique_system>=3 | duration 30m

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON' and user='{SuspectUser}' and unique_system='{TargetHost}'

stream=authentication where sourcename='WINDOWS' and rlike(user,"([a-zA-Z0-9]*)_.*") and logontype in ('2', '10', '11') | groupby user | duration 1h

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
|select user, count(distinct(srccn)) as country_count| having country_count>=2| groupby user| duration 30m

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
and host='{suspectsrcip}' and user='{targetuser}'

stream=threat where sourcename='FORCEPOINT-DLP' and action='THREAT_DETECTED' and threat = "Block SOF Web Uploads" | select user, count(action) as blocked_count | groupby user | having blocked_count>=50 | duration 1h

stream=threat where sourcename='FORCEPOINT-DLP' and action='THREAT_DETECTED' and threat = "Block SOF Web Uploads" and user='{suspectuser}'

stream=firewall where srctype='PUBLIC' and act ='accept' and dstport in ('22','139','445') and srcisp!='SCHREIBERFOODS' and srcip not like ('198.185.11.%') and policyname!='SSH & FTP Whitelist to MFT' and policyname!='SSH to Prod SFTP Server'
| groupby srcip, dstip | duration 1h

stream=authentication where sourcename='WINDOWS' and eid=4740 and user ='targettuser'

stream=iam where sourcename='WINDOWS' and eid=4740 | select  targetuser, count(eid) as eid_count | groupby targetuser | having  eid_count >=10 | duration 6h

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' | select user, system, distinct_count(srcip) as CntSrcIP | groupby user, system | having CntSrcIP > 3

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' and system='{TargetHost}' and user='{TargetUser}' | duration 6m

stream=firewall where dstport=53 and user='{SuspectUser}'

stream=firewall where dstport=53 and action='PACKET_BLOCKED' | checkif srcip not in DCIPs.DeviceIP | select srcip, count(dstport) as dns_count | groupby srcip | having dns_count>=1000

stream=firewall where srctype="PUBLIC" and srcip='{SuspectHost}'

stream=firewall where srctype="PUBLIC" and srcisp!='SCHREIBERFOODS' | select srcip, srcisp, count_if(action='PACKET_BLOCKED') as denied_count | groupby srcip, srcisp | having denied_count>=2000 | duration 5m

stream=firewall where srctype='PUBLIC' and act ='accept' and dstport in ('22','139','445') and srcisp!='SCHREIBERFOODS' and srcip not like ('198.185.11.%') and policyname!='SSH & FTP Whitelist to MFT' and policyname!='SSH to Prod SFTP Server'
| groupby srcip, dstip | duration 1h

stream=firewall where srctype!="PRIVATE" and dstip='{targethost}' and srcip='{SuspectHost}'

stream=firewall where srctype!="PRIVATE"| select  srcip, dstip, count(distinct(dstport)) as PortCount, count_if(act='accept') as allowed_traffic, count_if(act='deny') as denied_traffic
| groupby srcip, dstip | having PortCount>=20 and denied_traffic>=1 and allowed_traffic>=2 | duration 1h

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and act='deny' and dstport in (445, 3389, 22)
|select count(action) as act_count, srcip| having act_count>=100| groupby srcip| duration 5m

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and act='deny' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype="PRIVATE" | checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby srcip | having denied_count>=2000 | duration 5m

stream=firewall where srctype='PUBLIC' and act ='accept' and dstport in ('22','139','445')
| groupby srcip, dstip | duration 1h

stream=webfilter  | groupby srcip, domain | duration 30m

stream=webfilter where act!='blocked'| checkif domain in tcstipdomain.domain| groupby srcip, domain | duration 30m

stream=webfilter where act!='blocked'| checkif domain in tcstipdomain.domain| groupby srcip, domain | duration 30m

stream=* | groupby devsrcip | duration last 24h

stream=authentication where action='LOGIN' and status='FAILED' and srcip!='NULL'|select srcip, count(distinct(user)) as count_users|groupby srcip|having count_users>=3

stream=authentication where action='LOGIN' and status='FAILED' and srcip='{SuspectHost}'

stream=iam where eid=4720 and subjectuser!='iiq_ad_admin_prod' and subjectuser not like ('%$')|checkif subjectuser not in AdminVIPList.AdminUser 
|groupby subjectuser, targetuser| duration 1h

stream=configuration where sourcename='WINDOWS' and eid=6416 | duration 1h

stream=webfilter and dstip='{SuspectHost}' AND srcip='{TargetHost}' and url='{SuspectURL}'

stream=webfilter where act!='blocked' and (url like 
"%shreiberfoods%" or url like 
"%screiberfoods%" or url like 
"%scheiberfoods%" or url like 
"%schriberfoods%" or url like 
"%schreberfoods%" or url like 
"%schreierfoods%" or url like 
"%schreibrfoods%" or url like 
"%schreibefoods%" or url like 
"%schreiberoods%" or url like 
"%schreiberfods%" or url like 
"%scheeiberfoods%" or url like 
"%schdeiberfoods%" or url like 
"%schfeiberfoods%" or url like 
"%schgeiberfoods%" or url like 
"%schteiberfoods%" or url like 
"%sch5eiberfoods%" or url like 
"%sch4eiberfoods%" or url like 
"%schrwiberfoods%" or url like 
"%schrsiberfoods%" or url like 
"%schrdiberfoods%" or url like 
"%schrfiberfoods%" or url like 
"%schrriberfoods%" or url like 
"%schr4iberfoods%" or url like 
"%schr3iberfoods%" or url like 
"%schreuberfoods%" or url like 
"%schrejberfoods%" or url like 
"%schrekberfoods%" or url like 
"%schrelberfoods%" or url like 
"%schreoberfoods%" or url like 
"%schre9berfoods%" or url like 
"%schre8berfoods%" or url like 
"%schreinerfoods%" or url like 
"%schreiherfoods%" or url like 
"%schreigerfoods%" or url like 
"%schreiverfoods%" or url like 
"%schreibwrfoods%" or url like 
"%schreibsrfoods%" or url like 
"%schreibdrfoods%" or url like 
"%schreibfrfoods%" or url like 
"%schreibrrfoods%" or url like 
"%schreib4rfoods%" or url like 
"%schreib3rfoods%" or url like 
"%schreibeefoods%" or url like 
"%schreibedfoods%" or url like 
"%schreibeffoods%" or url like 
"%schreibegfoods%" or url like 
"%schreibetfoods%" or url like 
"%schreibe5foods%" or url like 
"%schreibe4foods%" or url like 
"%schreiberdoods%" or url like 
"%schreibercoods%" or url like 
"%schreibervoods%" or url like 
"%schreibergoods%" or url like 
"%schreibertoods%" or url like 
"%schreiberroods%" or url like 
"%schreiberfiods%" or url like 
"%schreiberfkods%" or url like 
"%schreiberflods%" or url like 
"%schreiberfpods%" or url like 
"%schreiberf0ods%" or url like 
"%schreiberf9ods%" or url like 
"%schreiberfoids%" or url like 
"%schreiberfokds%" or url like 
"%schreiberfolds%" or url like 
"%schreiberfopds%" or url like 
"%schreiberfo0ds%" or url like 
"%schreiberfo9ds%" or url like 
"%schreiberfooss%" or url like 
"%schreiberfooxs%" or url like 
"%schreiberfoocs%" or url like 
"%schreiberfoofs%" or url like 
"%schreiberfoors%" or url like 
"%schreiberfooes%" or url like 
"%scheriberfoods%" or url like 
"%schrieberfoods%" or url like 
"%schrebierfoods%" or url like 
"%schreiebrfoods%" or url like 
"%schreibrefoods%" or url like 
"%schreibefroods%" or url like 
"%schreiberofods%" or url like 
"%schreiberfodos%" or url like 
"%schreiberfoosd%" or url like 
"%schreiberfodds%" or url like 
"%schreiber.foods%")| select srcip, user, dstip| duration 1h

stream=IAM where action in ('USER_ACCOUNT_CREATED','USER_ACCOUNT_DELETED') | select user, targetuser, distinct_count(action) as CountAction | groupby user, targetuser | having CountAction=2

stream=IAM where action in ('USER_ACCOUNT_CREATED','USER_ACCOUNT_DELETED') and targetuser='{TargetUser}' and user='{SuspectUser}' | duration 6m

stream=authentication where action='LOGIN' | select user, count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | groupby user | having fail_count>=20 and pass_count>=1 | duration 5m

stream=authentication where action='LOGIN' and user='{targetuser}'

stream=* | groupby devsrcip | duration 24h

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and act='deny' and dstport in (445, 3389, 22)
|select count(action) as act_count, srcip| having act_count>=100| groupby srcip| duration 5m

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and act='deny' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
 and threatclassifier!='BLACKLIST' and hash!="" and hostgroup like '%Servers%'
|select count(distinct(hostname)) as host_count, hash | groupby hash | having host_count>=2 | duration 48h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
 and threatclassifier!='BLACKLIST' and hash!="" and hostgroup='Windows Servers' or hostgroup='Windows Servers - Snapshots Disabled' and hash='{suspecthash}'

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) |groupby srcip| duration 1h


stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
 and threatclassifier!='BLACKLIST' and hash!="" and hostgroup='Windows Servers' or hostgroup='Windows Servers - Snapshots Disabled'
|select count(distinct(hostname)) as host_count, hash | groupby hash | having host_count>=2 | duration 48h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
 and threatclassifier!='BLACKLIST' and hash!="" and hostgroup='Windows Servers' or hostgroup='Windows Servers - Snapshots Disabled' and hash='{suspecthash}'

stream=iam where action='USER_CREATED' or action='USER_DELETED'

| select user, count(distinct(action)) | groupby user |having action=2| duration 1h

stream=iam where action='USER_ACCOUNT_CREATED' or action='USER_ACCOUNT_DELETED' and user='{suspectuser}'

stream=* | groupby devsrcip | duration 24h

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) |groupby srcip| duration 5m


stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=signals | limit 10

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
 and threatclassifier!='BLACKLIST' and hash!="" and hostgroup='Windows Servers' or hostgroup='Windows Servers - Snapshots Disabled'
|select count(distinct(hostname)) as host_count, hash | groupby hash | having host_count>=2 | duration 48h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
 and threatclassifier!='BLACKLIST' and hash!="" and hostgroup='Windows Servers' or hostgroup='Windows Servers - Snapshots Disabled' and hash='{suspecthash}'

stream=authentication where action='LOGIN' | select user, count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | groupby user | having fail_count>=20 and pass_count>=1 | duration 5m

stream=authentication where action='LOGIN' and user='{targetuser}'

stream=iam where eid=4720 and subjectuser not like ('%$') and subjectuser not in ('iiq_ad_admin_prod','iiq_ad_admin_qa','iiq_ad_admin_dev') 
| checkif subjectuser not in AdminVIPList.AdminUser
| groupby subjectuser, targetuser| duration 1h

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) |groupby srcip| duration 5m


stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=threat where sourcename='FORCEPOINT-DLP' and action='THREAT_DETECTED' and threat = "Block SOF Web Uploads" | select user, count(action) as blocked_count | groupby user | having blocked_count>=50 | duration 1h

stream=threat where sourcename='FORCEPOINT-DLP' and action='THREAT_DETECTED' and threat = "Block SOF Web Uploads" and user='{suspectuser}'

stream=ep-process where commandline like 
"%.micro" or commandline like 

"%.zepto" or commandline like 

"%.cerber" or commandline like 

"%.locky" or commandline like 

"%.cerber3" or commandline like 

"%.cryp1" or commandline like 

"%.mole" or commandline like 

"%.onion" or commandline like 

"%.axx" or commandline like 

"%.osiris" or commandline like 

"%.crypz" or commandline like 

"%.crypt" or commandline like 

"%.locked" or commandline like 

"%.odin" or commandline like 

"%.ccc" or commandline like 

"%.cerber2" or commandline like 

"%.sage" or commandline like 

"%.globe" or commandline like 

"%.exx" or commandline like 

"%.good" or commandline like 

"%.wallet" or commandline like 

"%.1txt" or commandline like 

"%.decrypt2017" or commandline like 

"%.encrypt" or commandline like 

"%.ezz" or commandline like 

"%.zzzzz" or commandline like 

"%.MERRY" or commandline like 

"%.enciphered" or commandline like 

"%.r5a" or commandline like 

"%.aesir" or commandline like 

"%.ecc" or commandline like 

"%.enigma" or commandline like 

"%.cryptowall" or commandline like 

"%.encrypted" or commandline like 

"%.loli" or commandline like 

"%.breaking_bad" or commandline like 

"%.coded" or commandline like 

"%.ha3" or commandline like 

"%.damage" or commandline like 

"%.wcry" or commandline like 

"%.lol!" or commandline like 

"%.cryptolocker" or commandline like 

"%.dharma" or commandline like 

"%.MRCR1" or commandline like 

"%.sexy" or commandline like 

"%.crjoker" or commandline like 

"%.fantom" or commandline like 

"%.keybtc@inbox_com" or commandline like 

"%.rrk" or commandline like 

"%.legion" or commandline like 

"%.kratos" or commandline like 

"%.LeChiffre" or commandline like 

"%.kraken" or commandline like 

"%.zcrypt" or commandline like 

"%.maya" or commandline like 

"%.enc" or commandline like 

"%.file0locked" or commandline like 

"%.crinf" or commandline like 

"%.serp" or commandline like 

"%.potato" or commandline like 

"%.ytbl" or commandline like 

"%.surprise" or commandline like 

"%.angelamerkel" or commandline like 

"%.windows10" or commandline like 

"%.lesli" or commandline like 

"%.serpent" or commandline like 

"%.PEGS1" or commandline like 

"%.dale" or commandline like 

"%.pdcr" or commandline like 

"%.zzz" or commandline like 

"%.xyz" or commandline like 

"%.1cbu1" or commandline like 

"%.venusf" or commandline like 

"%.coverton" or commandline like 

"%.thor" or commandline like 

"%.rnsmwr" or commandline like 

"%.evillock" or commandline like 

"%.R16m01d05" or commandline like 

"%.wflx" or commandline like 

"%.nuclear55" or commandline like 

"%.darkness" or commandline like 

"%.encr" or commandline like 

"%.rekt" or commandline like 

"%.kernel_time" or commandline like 

"%.zyklon" or commandline like 

"%.Dexter" or commandline like 

"%.locklock" or commandline like 

"%.cry" or commandline like 

"%.VforVendetta" or commandline like 

"%.btc" or commandline like 

"%.raid10" or commandline like 

"%.dCrypt" or commandline like 

"%.zorro" or commandline like 

"%.AngleWare" or commandline like 

"%.EnCiPhErEd" or commandline like 

"%.purge" or commandline like 

"%.realfs0ciety@sigaint.org.fs0ciety" or commandline like 

"%.shit" or commandline like 

"%.atlas" or commandline like 

"%.exotic" or commandline like 

"%.crypted" or commandline like 

"%.padcrypt" or commandline like 

"%.xxx" or commandline like 

"%.hush" or commandline like 

"%.bin" or commandline like 

"%.vbransom" or commandline like 

"%.RMCM1" or commandline like 

"%.cryeye" or commandline like 

"%.unavailable" or commandline like 

"%.braincrypt" or commandline like 

"%.fucked" or commandline like 

"%.crypte" or commandline like 

"%._AiraCropEncrypted" or commandline like 

"%.stn" or commandline like 

"%.paym" or commandline like 

"%.spora" or commandline like 

"%.dll" or commandline like 

"%.RARE1" or commandline like 

"%.alcatraz" or commandline like 

"%.pzdc" or commandline like 

"%.aaa" or commandline like 

"%.encrypted" or commandline like 

"%.ttt" or commandline like 

"%.odcodc" or commandline like 

"%.vvv" or commandline like 

"%.ruby" or commandline like 

"%.pays" or commandline like 

"%.comrade" or commandline like 

"%.enc" or commandline like 

"%.abc" or commandline like 

"%.xxx" or commandline like 

"%.antihacker2017" or commandline like 

"%.herbst" or commandline like 

"%.szf" or commandline like 

"%.rekt" or commandline like 

"%.bript" or commandline like 

"%.crptrgr" or commandline like 

"%.kkk" or commandline like 

"%.rdm" or commandline like 

"%.BarRax" or commandline like 

"%.vindows" or commandline like 

"%.helpmeencedfiles" or commandline like 

"%.hnumkhotep" or commandline like 

"%.CCCRRRPPP" or commandline like 

"%.kyra" or commandline like 

"%.fun" or commandline like 

"%.rip" or commandline like 

"%.73i87A" or commandline like 

"%.bitstak" or commandline like 

"%.kernel_complete" or commandline like 

"%.payrms" or commandline like 

"%.a5zfn" or commandline like 

"%.perl" or commandline like 

"%.noproblemwedecfiles " or commandline like 

"%.lcked" or commandline like 

"%.p5tkjw" or commandline like 

"%.paymst"|  duration 30d

stream=ep-process AND system='{TargetHost}'

stream=threat or stream=firewall where threattype='Malicious' and direction='outgoing' | groupby srcip|duration 1d |last 10

stream=authentication where action='LOGIN' | select user, count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | groupby user | having fail_count>=20 and pass_count>=1 | duration 5m

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and act='deny' and dstport in (445, 3389, 22)
|select count(action) as act_count, srcip| having act_count>=100| groupby srcip| duration 5m

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and act='deny' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=authentication where action='LOGIN' | select user, count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | groupby user | having fail_count>=20 and pass_count>=1 | duration 5m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) |groupby srcip| duration 5m


stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and attackedparty='VIP'|duration 1h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
 and threatclassifier!='BLACKLIST' and hash!="" and hostgroup='Windows Servers' or hostgroup='Windows Servers - Snapshots Disabled'
|select count(distinct(hostname)) as host_count, hash | groupby hash | having host_count>=2 | duration 48h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
 and threatclassifier!='BLACKLIST' and hash!="" and hostgroup='Windows Servers' or hostgroup='Windows Servers - Snapshots Disabled' and hash='{suspecthash}'

stream=iam where targetuser='{targetuser}'

stream=iam | select targetuser, count_if(eid='4740') as eid_count |  groupby targetuser | checkif targetuser in AdminVIPList.AdminUser | having eid_count >= 12 | duration 1h

stream=configuration where sourcename='WINDOWS' and eid=6416 | duration 1h

stream=authentication where action='LOGIN' | select user, count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | groupby user | having fail_count>=20 and pass_count>=1 | duration 5m

stream=authentication where action='LOGIN' and user='{targetuser}'

stream=* | checkif devsrcip in CriticalDevices.Critical_Servers | groupby devsrcip | limit 500 | duration 2h

stream=authentication where action='LOGIN' and srcip !="-" and status="FAILED" and user!="Not Available" and 
reason!="AuthenticationFailedSasError" and user not like ('%$') | select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 1h

stream=threat where sourcename='FORCEPOINT-DLP' and @action='PERMITTED'and @severitytype|select threat, user, count(file) as file_count
| groupby threat, user, file| having file_count >200 | duration 1d

stream=* | timeslice 1m | duration 6h 

stream=email-gateway where action='EMAIL_SENT' and sender like '%@schreiberfoods%' | select sender,subject, count(action) as number_of_emails_sent 
| groupby sender,subject| having number_of_emails_sent>50

stream=email-gateway where action='EMAIL_SENT' and sender='{SuspectUser}'

stream=iam where targetuser='{targetuser}'

stream=iam | select targetuser, count_if(eid='4740') as eid_count |  groupby targetuser | checkif targetuser in AdminVIPList.VIPUser | having eid_count >= 12 | duration 1h

stream=authentication where action='LOGIN' and sourcename='MS-O365' and status="FAILED" and user!="Not Available"
| select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 1h

stream=authentication where action='LOGIN' and sourcename='MS-O365' and status="FAILED" and user!="Not Available"
| select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 1h

stream=* | checkif devsrcip in NonCriticalDevices.NonCriticalServers | groupby devsrcip | limit 500 | duration 30m

stream=* | checkif devsrcip in NonCriticalDevices.NonCriticalServers | groupby devsrcip | limit 500 | duration 24h

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED" AND devsrcip='{targethost}' and user='{suspectuser}'

stream=configuration where sourcetype="FIREWALL" AND action="CONFIGURATION_CHANGED" AND status="PASSED"
 and user not in ('bwadmin','cradmin','jwadmin','nradmin','pgadmin','raadmin')
 | select devsrcip,system,logevent, user | groupby devsrcip,system,logevent, user |  duration 1h

stream=* | timeslice 1m | duration 6h 

stream=* | checkif devsrcip in NonCriticalDevices.NonCriticalServers | groupby devsrcip | limit 500 | duration 24h

stream=firewall where srctype!="PRIVATE" and dstip='{targethost}' and srcip='{SuspectHost}'

stream=firewall where srctype!="PRIVATE"| select  srcip, dstip, count(distinct(dstport)) as PortCount, count_if(act='accept') as allowed_traffic, count_if(act='deny') as denied_traffic
| groupby srcip, dstip | having PortCount>=20 and denied_traffic>=1 and allowed_traffic>=2 | duration 1h

stream=authentication where sourcename="WINDOWS" AND action="LOGIN" AND status="FAILED" and user not like ('%$')
 and not rlike(user,"([a-zA-Z0-9]*)_.*") | select user, srcip, count(status) AS FailCount | groupby srcip,user | having FailCount>=50

stream=* | checkif devsrcip in NonCriticalDevices.NonCriticalServers | groupby devsrcip | limit 500 | duration 24h

stream=* | checkif devsrcip in NonCriticalDevices.NonCriticalServers | groupby devsrcip | limit 500 | duration 24h

stream=iam where targetdomain not like '%MS1' and targetdomain!='\\HOMISE01' | select targetdomain, count_if(eid='4740') as eid_count | checkif targetdomain not in DomainControllers.Hostname | groupby targetdomain | having eid_count >= 10 | duration 3h

stream=iam where targetdomain not like '%MS1' and targetdomain not like '%HOMISE01' | select targetdomain, count_if(eid='4740') as eid_count | checkif targetdomain not in DomainControllers.Hostname | groupby targetdomain | having eid_count >= 10 | duration 3h

stream=* | checkif devsrcip in CriticalDevices.Critical_Servers | groupby devsrcip | limit 500 | duration 2h

stream=authentication where action='LOGIN' and sourcename='MS-O365' and status="FAILED" and user!="Not Available"
| select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 1h

stream=authentication where action='LOGIN' and sourcename='FORTIGATE' and act='ssl-login-fail' and user!='N/A'
| select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 24h

stream=firewall where srctype='PUBLIC' and act ='accept' and dstport in ('22','139','445') and srcip not like ('198.185.11.%') and srcip not like ('198.185.9.%') and policyname!='SSH & FTP Whitelist to MFT' and policyname!='SSH to Prod SFTP Server'
| groupby srcip, dstip | duration 1h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
 and threatclassifier!='BLACKLIST' and hash!="" and hostgroup='Linux Servers' or hostgroup='Windows Servers - Snapshots Disabled'
 or hostgroup='Windows Servers' or hostgroup='PILOT - Windows Servers - Snapshots Disabled' or hostgroup='PILOT - Windows Servers'
  or hostgroup='VSS Disabled' or hostgroup='Troubleshooting'
|select count(distinct(hostname)) as host_count, hash | groupby hash | having host_count>=2 | duration 48h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
 and threatclassifier!='BLACKLIST' and hash!="" and hostgroup='Windows Servers' or hostgroup='Windows Servers - Snapshots Disabled' and hash='{suspecthash}'

stream=authentication where action='LOGIN' and sourcename='WINDOWS' and status="FAILED" and user not like "%$" and srcip!='-'
| select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 1h

stream=* | checkif devsrcip in CriticalDevices.Critical_Servers | groupby devsrcip | duration 2h

stream=* | checkif devsrcip in CriticalDevices.Critical_Servers | groupby devsrcip | duration 2h

stream=signals | limit 10

stream=signals | duration 5m

stream=authentication where action='LOGIN' and sourcename='WINDOWS' and status="FAILED" and user not like "%$" and srcip!='-'
| select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 1h

stream=authentication where action='LOGIN' and sourcename='FORTIGATE' and act='ssl-login-fail' and user!='N/A'
| select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 24h

stream=authentication where action='LOGIN' and srcip !="-" and status="FAILED" and user!="Not Available" and 
reason!="AuthenticationFailedSasError" and user not like ('%$') | select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 1h

stream=* | checkif devsrcip in CriticalDevices.Critical_Servers | groupby devsrcip | duration 2h

stream=webfilter and srcip='{SuspectHost}' and pcount='{TargetResource}'

stream=webfilter where srcip not like ('192.168.15%') and catdesc in ('Abortion', 'Dating', 'Gambling', 'Marijuana', 'Nudity and Risque', 
'Other Adult Materials', 'Pornography', 'URL Shortening', 'Games', 'Meaningless Content', 
'Child Sexual Abuse', 'Crypto Mining', 'Discrimination', 'Drug Abuse', 'Explicit Violence', 'Extremist Groups', 
'Hacking', 'Illegal or Unethical', 'Plagiarism', 'Potentially Unwanted Program', 'Proxy Avoidance', 'Terrorism', 'Dynamic DNS', 
'Malicious Websites', 'Newly Observed Domain', 'Newly Registered Domain', 'Phishing', 'Spam URLs', 'Not Rated') 
| select srcip, count(proxyaction) as pcount | groupby srcip |having pcount>1000 
| duration 1h

stream=IAM where action in ('USER_ACCOUNT_CREATED','USER_ACCOUNT_DELETED') | select user, targetuser, distinct_count(action) as CountAction | groupby user, targetuser | having CountAction=2

stream=IAM where action in ('USER_ACCOUNT_CREATED','USER_ACCOUNT_DELETED') and targetuser='{TargetUser}' and user='{SuspectUser}' | duration 6m

stream=signals | duration 5m

stream=signals | limit 10 | duration 5m

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' | select user, count(status) as fail_count | 
groupby user | having fail_count>=20 | duration 1h

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' | select user, count(status) as fail_count | 
groupby user | having fail_count>=10 | duration 1h

stream=iam where eid='4731' or eid='4720' and sourcename!='MS-O365' and targetuser='{TargetUser}'

stream=iam where eid='4731' or eid='4720' and sourcename!='MS-O365' and targetdomain!='SFI' |  groupby targetuser, group, subjectuser | duration 1h

stream=firewall where srctype="PRIVATE" | checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, count_if(act='deny') as denied_count 
| groupby srcip | having denied_count>=2000 | duration 5m

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' | 
select user, count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | 
groupby user | having fail_count>=10 and having pass_count>=1 | duration 1h

stream=authentication where sourcename='MS-O365' and action='LOGIN' and user!='Not Available' and srctype='PUBLIC' |
select user, count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | 
groupby user | having fail_count>=10 and pass_count>=1 | duration 1h

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' and user!='Not Available' and srctype='PUBLIC' |
select user, count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | 
groupby user | having fail_count>=10 and pass_count>=1 | duration 1h

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where action='LOGIN' and sourcename='MS-O365' and status='FAILED' and srctype='PUBLIC' and user!='Not Available' and reason!='IdsLocked' | 
select user, srcip, reason, count(status) as failed_count | 
groupby user, srcip, reason | 
having failed_count>=10 | 
duration 24h

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' | select user, system, distinct_count(srcip) as CntSrcIP | groupby user, system | having CntSrcIP > 3

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' and system='{TargetHost}' and user='{TargetUser}' | duration 6m

stream=iam where eid='4724' or eid='4723' and user='{SuspectUser}'

stream=iam where (eid='4771') and subjectuser!='iiq_ad_admin_prod' | checkif subjectuser not in AdminVIPList.AdminUser |  select subjectuser, count(eid) as act | groupby subjectuser | having act>=3 | duration 30m

stream=iam where eid='4724' or eid='4723' and user='{SuspectUser}'

stream=iam where eid='4771' and subjectuser!='iiq_ad_admin_prod' | checkif subjectuser not in AdminVIPList.AdminUser |  select subjectuser, count(eid) as act | groupby subjectuser | having act>=3 | duration 30m

stream=firewall where srctype="PUBLIC" and srcip='{SuspectHost}'

stream=firewall where srctype="PUBLIC" and srcisp!='SCHREIBERFOODS' | select srcip, srcisp, count_if(act='deny') as denied_count | groupby srcip, srcisp | having denied_count>=2000 | duration 5m

stream=iam where targetdomain not like '%MS1' and targetdomain not like '%HOMISE01' | select targetdomain, count_if(eid='4740') as eid_count, count(distinct(targetuser)) as user_count | checkif targetdomain not in DomainControllers.Hostname | groupby targetdomain | having eid_count >= 10 and user_count>=2 | duration 3h

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and not rlike(user,"([a-zA-Z0-9]*)_.*") and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON'
| checkif workstation not in DCandADFS.Hostname
| select user, logontype, count(distinct(workstation)) as unique_system 
| groupby user, logontype| having unique_system>=3 | duration 8h

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON' and user='{SuspectUser}' and unique_system='{TargetHost}'

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and not rlike(user,"([a-zA-Z0-9]*)_.*") and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON'
| checkif workstation not in DCandADFS.Hostname
| select user, logontype, count(distinct(workstation)) as unique_system 
| groupby user, logontype| having unique_system>=3 | duration 30m

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON' and user='{SuspectUser}' and unique_system='{TargetHost}'

stream=iam where eid='4731' or eid='4720' and sourcename!='MS-O365' and targetdomain!='SFI' |  groupby targetuser, group, subjectuser | duration 24h

stream=iam where eid='4731' or eid='4720' and sourcename!='MS-O365' and targetuser='{TargetUser}'

stream=win-audit where action="OBJECT_ACCESSED" and status="PASSED" and (eid="5140" or event="A network share object was accessed.") | select user, system, count(action) as access_count | groupby user, system | having access_count>=100 | duration 2h

stream=win-audit where action="OBJECT_ACCESSED" and status="PASSED" and system='{TargetHost}'

stream=authentication where eid='4624' and logontype='9' and (user!='System' or 'SYSTEM')  | select user| groupby user, eid | duration 30m

stream=authentication where eid='4648' AND user='{TargetUser}'

stream=iam where eid='4724' or eid='4723' and user='{SuspectUser}'

stream=authentication where eid='4771' and servicename='kadmin/changepw' | select user, count(eid) as act | groupby user | having act>=3 | duration 30m

stream=iam where eid='4724' or eid='4723' and user='{SuspectUser}'

stream=authentication where eid='4771' and servicename='kadmin/changepw' | select user, count(eid) as act | groupby user | having act>=3 | duration 30m

stream=firewall where srctype="PUBLIC" and srcip='{SuspectHost}'

stream=firewall where srctype="PUBLIC" and srcisp!='SCHREIBERFOODS' | select srcip, srcisp, count_if(act='deny') as denied_count | groupby srcip, srcisp | having denied_count>=2000 | duration 5m

stream=firewall where srctype="PRIVATE" | checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, count_if(act='deny') as denied_count 
| groupby srcip | having denied_count>=2000 | duration 5m

stream=firewall where dstport=53 and user='{SuspectUser}'

stream=firewall where dstport=53 and action='PACKET_BLOCKED' | checkif srcip not in DCIPs.DeviceIP | select srcip, count(dstport) as dns_count | groupby srcip | having dns_count>=1000

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
and host='{suspectsrcip}' and user='{targetuser}'

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and srcip!='198.185.10.2' and user!='Not Available' and user!='um@schreiberfoods.com' and srccn!='-' and srccn!= ''
|select user, count(distinct(srccn)) as country_count| having country_count>=2| groupby user| duration 30m

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and ispostremediated='False'|duration 1h

stream=signals | duration 10m

stream=signals | duration 5m

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and srcisp!='Schreiber Foods, Inc.' and user!='Not Available' and user!='um@schreiberfoods.com' and srccn!='-' and srccn!= ''
|select user, count(distinct(srccn)) as country_count| having country_count>=2| groupby user| duration 30m

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
and host='{suspectsrcip}' and user='{targetuser}'

stream=firewall where srctype="PUBLIC" and srcip='{SuspectHost}'

stream=firewall where srctype="PUBLIC" and srcisp!='Schreiber Foods, Inc.' | select srcip, srcisp, count_if(act='deny') as denied_count | groupby srcip, srcisp | having denied_count>=2000 | duration 5m

stream=authentication where sourcename="WINDOWS" AND action="LOGIN" AND status="FAILED" and user not like ('%$') and srcip!='-'
 and not rlike(user,"([a-zA-Z0-9]*)_.*") | select user, srcip, count(status) AS FailCount | groupby srcip,user | having FailCount>=50

stream=signals | duration 5m

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and attackedparty!='VIP'|duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False'

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and attackedparty='VIP'|duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' |groupby sender| having count_col1>50| duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and sender like '%schreiberfoods%' and recipient like '%schreiberfoods%' 
 and isautoremediated='False'|duration 1h

stream=firewall where srctype='PUBLIC' and act='accept' and srcip not like '198.185.9.%' and srcip not like '198.185.11.%'
 | select count(dstport) as port_count, srcip | groupby srcip |
  having port_count>=100 | duration 10m

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and attackedparty='VIP'|duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' |groupby sender| having count_col1>50| duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and sender like '%schreiberfoods%' and recipient like '%schreiberfoods%' 
 and isautoremediated='False'|duration 1h

stream=firewall where srctype='PUBLIC' and act='accept' and srcip not like '198.185.9.%' and srcip not like '198.185.11.%'
 | select count(dstport) as port_count, count(distinct(dstip)) as dstip_count, srcip | groupby srcip |
  having port_count>=10 and dstip_count>=10 | duration 5m

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=authentication where sourcename="WINDOWS" AND action="LOGIN" AND status="FAILED" and user not like ('%$') and not rlike(user,"([a-zA-Z0-9]*)_.*") | select user, srcip, count(status) AS FailCount | groupby srcip,user | having FailCount>=50

stream=webfilter where srcip not like ('192.168.15%') and catdesc in ('Abortion', 'Dating', 'Gambling', 'Marijuana', 'Nudity and Risque', 
'Other Adult Materials', 'Pornography', 'URL Shortening', 'Games', 'Meaningless Content', 
'Child Sexual Abuse', 'Crypto Mining', 'Discrimination', 'Drug Abuse', 'Explicit Violence', 'Extremist Groups', 
'Hacking', 'Illegal or Unethical', 'Plagiarism', 'Potentially Unwanted Program', 'Proxy Avoidance', 'Terrorism', 'Dynamic DNS', 
'Malicious Websites', 'Newly Observed Domain', 'Newly Registered Domain', 'Phishing', 'Spam URLs', 'Not Rated') and user!=''
| select srcip,user, count(proxyaction) as pcount | groupby srcip, user |having pcount>1000 
| duration 1h

stream=webfilter and srcip='{SuspectHost}' and pcount='{TargetResource}'

stream=signals where sourcestage='prod' | duration 5m

stream=authentication where sourcename='WINDOWS' and eid=4740 and user ='targettuser'

stream=iam where sourcename='WINDOWS' and eid=4740 | select  targetuser, count(eid) as eid_count | groupby targetuser | having  eid_count >=10 | duration 6h

stream=iam where sourcename='WINDOWS' and eid=4740 | select  targetuser, count(eid) as eid_count | groupby targetuser | having  eid_count >=10 | duration 6h

stream=authentication where sourcename='WINDOWS' and eid=4740 and user ='targettuser'

stream=authentication where sourcename='WINDOWS' and eid=4740 and user ='targettuser'

stream=iam where sourcename='WINDOWS' and eid=4740 | select  targetuser, count(eid) as eid_count | groupby targetuser | having  eid_count >=10 | duration 6h

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
and host='{suspectsrcip}' and user='{targetuser}'

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and srcisp!='Schreiber Foods, Inc.' and user!='Not Available' and srccn!='-' and srccn!= '' 
| checkif user not in ImpossibleTravel_exc.Users
| select user, count(distinct(srccn)) as country_count| having country_count>=2| groupby user| duration 30m

stream=firewall | checkif srcip not in DCIPs.DeviceIP | groupby srcip | duration 7d | last 10

stream=EP-FILE where action='FILE_CREATED' AND TargetFilename='where_my_files.txt' OR 
TargetFilename='how_to_recover_data.txt' OR TargetFilename='how_to_decrypt.txt' OR 
TargetFilename='contact_here_to_recover_your_files' OR 
$TargetFilename LIKE "%decrypt-files%readme%txt%" OR $TargetFilename 
LIKE "%decrypt-files%readme_for_decrypt%txt%"OR $TargetFilename LIKE "%decrypt%txt%" 
OR $TargetFilename LIKE "%decrypt%html%"

stream=iam where eid=4720 and subjectuser not like ('%$') and subjectuser not in ('iiq_ad_admin_prod','iiq_ad_admin_qa','iiq_ad_admin_dev','iiq_ad_admin_test') 
| checkif subjectuser not in AdminVIPList.AdminUser
| groupby subjectuser, targetuser| duration 1h

stream=webfilter and srcip='{SuspectHost}' and pcount='{TargetResource}'

stream=webfilter where srcip not like ('192.168.15%') and catdesc in ('Abortion', 'Dating', 'Gambling', 'Marijuana', 'Nudity and Risque', 
'Other Adult Materials', 'Pornography', 'URL Shortening', 'Games', 'Meaningless Content', 
'Child Sexual Abuse', 'Crypto Mining', 'Discrimination', 'Drug Abuse', 'Explicit Violence', 'Extremist Groups', 
'Hacking', 'Illegal or Unethical', 'Plagiarism', 'Potentially Unwanted Program', 'Proxy Avoidance', 'Terrorism', 'Dynamic DNS', 
'Malicious Websites', 'Newly Observed Domain', 'Newly Registered Domain', 'Phishing', 'Spam URLs', 'Not Rated') 
| select srcip, count(proxyaction) as pcount | groupby srcip |having pcount>1000 
| duration 1h

stream=webfilter and srcip='{SuspectHost}' and pcount='{TargetResource}'

stream=webfilter where srcip not like ('192.168.15%') and catdesc in ('Abortion', 'Dating', 'Gambling', 'Marijuana', 'Nudity and Risque', 
'Other Adult Materials', 'Pornography', 'URL Shortening', 'Games', 'Meaningless Content', 
'Child Sexual Abuse', 'Crypto Mining', 'Discrimination', 'Drug Abuse', 'Explicit Violence', 'Extremist Groups', 
'Hacking', 'Illegal or Unethical', 'Plagiarism', 'Potentially Unwanted Program', 'Proxy Avoidance', 'Terrorism', 'Dynamic DNS', 
'Malicious Websites', 'Newly Observed Domain', 'Newly Registered Domain', 'Phishing', 'Spam URLs', 'Not Rated') 
| select srcip,user, count(proxyaction) as pcount | groupby srcip, user |having pcount>1 
| duration 1h

stream=webfilter and srcip='{SuspectHost}' and pcount='{TargetResource}'

stream=webfilter where srcip not like ('192.168.15%') and catdesc in ('Abortion', 'Dating', 'Gambling', 'Marijuana', 'Nudity and Risque', 
'Other Adult Materials', 'Pornography', 'URL Shortening', 'Games', 'Meaningless Content', 
'Child Sexual Abuse', 'Crypto Mining', 'Discrimination', 'Drug Abuse', 'Explicit Violence', 'Extremist Groups', 
'Hacking', 'Illegal or Unethical', 'Plagiarism', 'Potentially Unwanted Program', 'Proxy Avoidance', 'Terrorism', 'Dynamic DNS', 
'Malicious Websites', 'Newly Observed Domain', 'Newly Registered Domain', 'Phishing', 'Spam URLs', 'Not Rated') and user!=''
| select srcip,user, count(proxyaction) as pcount | groupby srcip, user |having pcount>1 
| duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and ispostremediated='False' | duration 1h

stream=* | select count(distinct(devsrcip)) as Reporting_devs | checkif devsrcip in NonCriticalDevices.NonCritical_Servers | having Reporting_devs<=5 | duration 1d

stream=* | select count(distinct(devsrcip)) as Reporting_devs | checkif devsrcip in NonCriticalDevices.NonCritical_Servers | having Reporting_devs<=5 | duration 1d

stream=firewall where dstport NOT in (21,22,23,69,115,990,989) and proto in ('FTP', 'SSH', 'SFTP', 'TFTP', 'TELNET', 'FTPS') and srcip='{SuspectHost}'

stream=firewall where dstport NOT in (21,22,23,69,115,990,989) and proto in ('FTP', 'SSH', 'SFTP', 'TFTP', 'TELNET', 'FTPS')
| groupby srcip | duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and attackedparty='VIP' | duration 1h

stream=threat where devsrcip='Abnormal' and attacktype like("%Phishing%") and isautoremediated='True' and ispostremediated='False' | duration 6h

stream=threat where devsrcip='Abnormal' and attacktype like("%Phishing%") and isautoremediated='False' and ispostremediated='False' and targetuser

stream=iam where action='PASSWORD_CHANGED'| duration 7d

stream=threat where devsrcip='Abnormal' and attacktype like("%Phishing%") and isautoremediated='False' and ispostremediated='False' and targetuser

stream=threat where devsrcip='Abnormal' and attacktype like("%Phishing%") and isautoremediated='False' and ispostremediated='False' | checkif domain in tcstipdomain.Domain | duration 1h

stream=threat where devsrcip='Abnormal' and attacktype like("%Phishing%") and isautoremediated='False' and ispostremediated='False' and targetuser

stream=threat where devsrcip='Abnormal' and attacktype like("%Phishing%") and isautoremediated='False' and ispostremediated='False' | checkif domain in tcstipdomain.Domain | duration 1h

stream=ep-process where commandline like 
"%.micro" or commandline like 

"%.zepto" or commandline like 

"%.cerber" or commandline like 

"%.locky" or commandline like 

"%.cerber3" or commandline like 

"%.cryp1" or commandline like 

"%.mole" or commandline like 

"%.onion" or commandline like 

"%.axx" or commandline like 

"%.osiris" or commandline like 

"%.crypz" or commandline like 

"%.crypt" or commandline like 

"%.locked" or commandline like 

"%.odin" or commandline like 

"%.ccc" or commandline like 

"%.cerber2" or commandline like 

"%.sage" or commandline like 

"%.globe" or commandline like 

"%.exx" or commandline like 

"%.good" or commandline like 

"%.wallet" or commandline like 

"%.1txt" or commandline like 

"%.decrypt2017" or commandline like 

"%.encrypt" or commandline like 

"%.ezz" or commandline like 

"%.zzzzz" or commandline like 

"%.MERRY" or commandline like 

"%.enciphered" or commandline like 

"%.r5a" or commandline like 

"%.aesir" or commandline like 

"%.ecc" or commandline like 

"%.enigma" or commandline like 

"%.cryptowall" or commandline like 

"%.encrypted" or commandline like 

"%.loli" or commandline like 

"%.breaking_bad" or commandline like 

"%.coded" or commandline like 

"%.ha3" or commandline like 

"%.damage" or commandline like 

"%.wcry" or commandline like 

"%.lol!" or commandline like 

"%.cryptolocker" or commandline like 

"%.dharma" or commandline like 

"%.MRCR1" or commandline like 

"%.sexy" or commandline like 

"%.crjoker" or commandline like 

"%.fantom" or commandline like 

"%.keybtc@inbox_com" or commandline like 

"%.rrk" or commandline like 

"%.legion" or commandline like 

"%.kratos" or commandline like 

"%.LeChiffre" or commandline like 

"%.kraken" or commandline like 

"%.zcrypt" or commandline like 

"%.maya" or commandline like 

"%.enc" or commandline like 

"%.file0locked" or commandline like 

"%.crinf" or commandline like 

"%.serp" or commandline like 

"%.potato" or commandline like 

"%.ytbl" or commandline like 

"%.surprise" or commandline like 

"%.angelamerkel" or commandline like 

"%.windows10" or commandline like 

"%.lesli" or commandline like 

"%.serpent" or commandline like 

"%.PEGS1" or commandline like 

"%.dale" or commandline like 

"%.pdcr" or commandline like 

"%.zzz" or commandline like 

"%.xyz" or commandline like 

"%.1cbu1" or commandline like 

"%.venusf" or commandline like 

"%.coverton" or commandline like 

"%.thor" or commandline like 

"%.rnsmwr" or commandline like 

"%.evillock" or commandline like 

"%.R16m01d05" or commandline like 

"%.wflx" or commandline like 

"%.nuclear55" or commandline like 

"%.darkness" or commandline like 

"%.encr" or commandline like 

"%.rekt" or commandline like 

"%.kernel_time" or commandline like 

"%.zyklon" or commandline like 

"%.Dexter" or commandline like 

"%.locklock" or commandline like 

"%.cry" or commandline like 

"%.VforVendetta" or commandline like 

"%.btc" or commandline like 

"%.raid10" or commandline like 

"%.dCrypt" or commandline like 

"%.zorro" or commandline like 

"%.AngleWare" or commandline like 

"%.EnCiPhErEd" or commandline like 

"%.purge" or commandline like 

"%.realfs0ciety@sigaint.org.fs0ciety" or commandline like 

"%.shit" or commandline like 

"%.atlas" or commandline like 

"%.exotic" or commandline like 

"%.crypted" or commandline like 

"%.padcrypt" or commandline like 

"%.xxx" or commandline like 

"%.hush" or commandline like 

"%.bin" or commandline like 

"%.vbransom" or commandline like 

"%.RMCM1" or commandline like 

"%.cryeye" or commandline like 

"%.unavailable" or commandline like 

"%.braincrypt" or commandline like 

"%.fucked" or commandline like 

"%.crypte" or commandline like 

"%._AiraCropEncrypted" or commandline like 

"%.stn" or commandline like 

"%.paym" or commandline like 

"%.spora" or commandline like 

"%.dll" or commandline like 

"%.RARE1" or commandline like 

"%.alcatraz" or commandline like 

"%.pzdc" or commandline like 

"%.aaa" or commandline like 

"%.encrypted" or commandline like 

"%.ttt" or commandline like 

"%.odcodc" or commandline like 

"%.vvv" or commandline like 

"%.ruby" or commandline like 

"%.pays" or commandline like 

"%.comrade" or commandline like 

"%.enc" or commandline like 

"%.abc" or commandline like 

"%.xxx" or commandline like 

"%.antihacker2017" or commandline like 

"%.herbst" or commandline like 

"%.szf" or commandline like 

"%.rekt" or commandline like 

"%.bript" or commandline like 

"%.crptrgr" or commandline like 

"%.kkk" or commandline like 

"%.rdm" or commandline like 

"%.BarRax" or commandline like 

"%.vindows" or commandline like 

"%.helpmeencedfiles" or commandline like 

"%.hnumkhotep" or commandline like 

"%.CCCRRRPPP" or commandline like 

"%.kyra" or commandline like 

"%.fun" or commandline like 

"%.rip" or commandline like 

"%.73i87A" or commandline like 

"%.bitstak" or commandline like 

"%.kernel_complete" or commandline like 

"%.payrms" or commandline like 

"%.a5zfn" or commandline like 

"%.perl" or commandline like 

"%.noproblemwedecfiles " or commandline like 

"%.lcked" or commandline like 

"%.p5tkjw" or commandline like 

"%.paymst"|  duration 30d

stream=ep-process AND system='{TargetHost}'

stream=firewall where srctype='PUBLIC' and srcisp!='Schreiber Foods, Inc.' | groupby srcip, srcisp | duration 24h | limit 20

stream=firewall where srctype="PRIVATE" | checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, dstport, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby srcip, dstport | having denied_count>=500 | duration 5m

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=firewall where srctype='PUBLIC' |select count(dstport) as port_count, count(distinct(dstip)) as dstip_count, srcip| groupby srcip| having port_count>=10 and dstip_count>=10 | duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and ispostremediated='False'| duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and ispostremediated='False'| duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and attacktype like ("%Spam%") and action='THREAT_DETECTED' | select sender, count(action) as no_of_emails | groupby sender | having no_of_emails >= 1 | duration 1h

stream=threat where devsrcip='Abnormal' and attacktype='Phishing: Credential' and action='THREAT_DETECTED' | select sender, count(action) as no_of_emails | groupby sender | having no_of_emails >=20 | duration 2h

stream=threat where sourcename='ABNORMAL SECURITY' and attacktype like ("%Spam%") and action='THREAT_DETECTED' | select sender, count(action) as no_of_emails | groupby sender | having no_of_emails >= 50 | duration 1h

stream=threat where devsrcip='Abnormal' and attacktype like("%Phishing%") and isautoremediated='False' and ispostremediated='False' and targetuser

stream=threat where devsrcip='Abnormal' and attacktype like("%Phishing%") and isautoremediated='False' and ispostremediated='False' | checkif domain in tcstipdomain.Domain |duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and attackedparty='VIP' | duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and sender like '%schreiberfoods%' and recipient like '%schreiberfoods%' 
 and isautoremediated='False'|duration 12h

stream=threat where devsrcip='Abnormal' and attacktype='Phishing: Credential' and action='THREAT_DETECTED' | select sender, count(action) as no_of_emails | groupby sender | having no_of_emails >=1 | duration 2h

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and ispostremediated='False' | duration 1h

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False'

stream=threat where sourcename='ABNORMAL SECURITY' and isautoremediated='False' and attackedparty!='VIP'|duration 30d

stream=threat where devsrcip='Abnormal' and attacktype='Phishing: Credential' and action='THREAT_DETECTED' | select sender, count(action) as no_of_emails | groupby sender | having no_of_emails >=20 | duration 2h

stream=threat where devsrcip='Abnormal' and attacktype='Phishing: Credential' and action='THREAT_DETECTED' | select sender, count(action) as no_of_emails | groupby sender | having no_of_emails >=20 | duration 2h

stream=authentication where action='LOGIN' and sourcename='FORTIGATE' and act='ssl-login-fail' and user!='N/A'
| select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 1h

stream=authentication where sourcetype="FIREWALL" AND action="LOGIN" AND status="FAILED"| select srcip, devsrcip, count(status) AS FailCount | groupby srcip,devsrcip | having FailCount>=10 | duration 5m

stream=authentication where sourcetype="FIREWALL" AND action="LOGIN" AND status="FAILED" ANd srcip='{suspecthost}' and devsrcip='{targethost}'

stream=firewall where threattype='Malicious' | checkif dstip in tcstipip.IP | groupby srcip, dstip, act | duration 24h

stream=* | checkif devsrcip in CriticalDevices.Critical_Servers | groupby devsrcip | duration 2h

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' | select user, system, distinct_count(srcip) as CntSrcIP | groupby user, system | having CntSrcIP > 3

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' and system='{TargetHost}' and user='{TargetUser}' | duration 6m

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' | select user, system, distinct_count(srcip) as CntSrcIP | groupby user, system | having CntSrcIP > 3

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' and system='{TargetHost}' and user='{TargetUser}' | duration 6m

stream=signals | limit 10

stream=authentication where sourcename="WINDOWS" AND action="LOGIN" AND status="FAILED" and user not like ('%$') and not rlike(user,"([a-zA-Z0-9]*)_.*") | select user, srcip, count(status) AS FailCount | groupby srcip,user | having FailCount>=50

stream=* | select count(distinct(devsrcip)) as Reporting_devs | checkif devsrcip in NonCriticalDevices.NonCritical_Servers | having Reporting_devs<=5 | duration 1d

stream=authentication where sourcename='WINDOWS' and eid=4740 and srcip ='SuspectUser'

stream=authentication where sourcename='WINDOWS' and eid=4740 
| select count(eid) as eid_count, user, srcip| groupby user, srcip| having  eid_count >1 | duration 10d

stream=* where devsrcip!='10.70.18.249' | select distinct(devsrcip) as devsrcip, count(*) as event_count |groupby devsrcip | having event_count >1000000 | duration 2h

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' | select user, system, distinct_count(srcip) as CntSrcIP | groupby user, system | having CntSrcIP > 3

stream=AUTHENTICATION where action='LOGIN' and status='PASSED' and system='{TargetHost}' and user='{TargetUser}' | duration 6m

stream=firewall where srctype="PRIVATE" | checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, dstport, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby srcip, dstport | having denied_count>=500 | duration 5m

stream=firewall where threattype='Malicious' | checkif srcip in tcstipip.ip | groupby srcip, dstip, act | duration 7d | limit 10

stream=ep-process where commandline like 
"%.micro" or commandline like 

"%.zepto" or commandline like 

"%.cerber" or commandline like 

"%.locky" or commandline like 

"%.cerber3" or commandline like 

"%.cryp1" or commandline like 

"%.mole" or commandline like 

"%.onion" or commandline like 

"%.axx" or commandline like 

"%.osiris" or commandline like 

"%.crypz" or commandline like 

"%.crypt" or commandline like 

"%.locked" or commandline like 

"%.odin" or commandline like 

"%.ccc" or commandline like 

"%.cerber2" or commandline like 

"%.sage" or commandline like 

"%.globe" or commandline like 

"%.exx" or commandline like 

"%.good" or commandline like 

"%.wallet" or commandline like 

"%.1txt" or commandline like 

"%.decrypt2017" or commandline like 

"%.encrypt" or commandline like 

"%.ezz" or commandline like 

"%.zzzzz" or commandline like 

"%.MERRY" or commandline like 

"%.enciphered" or commandline like 

"%.r5a" or commandline like 

"%.aesir" or commandline like 

"%.ecc" or commandline like 

"%.enigma" or commandline like 

"%.cryptowall" or commandline like 

"%.encrypted" or commandline like 

"%.loli" or commandline like 

"%.breaking_bad" or commandline like 

"%.coded" or commandline like 

"%.ha3" or commandline like 

"%.damage" or commandline like 

"%.wcry" or commandline like 

"%.lol!" or commandline like 

"%.cryptolocker" or commandline like 

"%.dharma" or commandline like 

"%.MRCR1" or commandline like 

"%.sexy" or commandline like 

"%.crjoker" or commandline like 

"%.fantom" or commandline like 

"%.keybtc@inbox_com" or commandline like 

"%.rrk" or commandline like 

"%.legion" or commandline like 

"%.kratos" or commandline like 

"%.LeChiffre" or commandline like 

"%.kraken" or commandline like 

"%.zcrypt" or commandline like 

"%.maya" or commandline like 

"%.enc" or commandline like 

"%.file0locked" or commandline like 

"%.crinf" or commandline like 

"%.serp" or commandline like 

"%.potato" or commandline like 

"%.ytbl" or commandline like 

"%.surprise" or commandline like 

"%.angelamerkel" or commandline like 

"%.windows10" or commandline like 

"%.lesli" or commandline like 

"%.serpent" or commandline like 

"%.PEGS1" or commandline like 

"%.dale" or commandline like 

"%.pdcr" or commandline like 

"%.zzz" or commandline like 

"%.xyz" or commandline like 

"%.1cbu1" or commandline like 

"%.venusf" or commandline like 

"%.coverton" or commandline like 

"%.thor" or commandline like 

"%.rnsmwr" or commandline like 

"%.evillock" or commandline like 

"%.R16m01d05" or commandline like 

"%.wflx" or commandline like 

"%.nuclear55" or commandline like 

"%.darkness" or commandline like 

"%.encr" or commandline like 

"%.rekt" or commandline like 

"%.kernel_time" or commandline like 

"%.zyklon" or commandline like 

"%.Dexter" or commandline like 

"%.locklock" or commandline like 

"%.cry" or commandline like 

"%.VforVendetta" or commandline like 

"%.btc" or commandline like 

"%.raid10" or commandline like 

"%.dCrypt" or commandline like 

"%.zorro" or commandline like 

"%.AngleWare" or commandline like 

"%.EnCiPhErEd" or commandline like 

"%.purge" or commandline like 

"%.realfs0ciety@sigaint.org.fs0ciety" or commandline like 

"%.shit" or commandline like 

"%.atlas" or commandline like 

"%.exotic" or commandline like 

"%.crypted" or commandline like 

"%.padcrypt" or commandline like 

"%.xxx" or commandline like 

"%.hush" or commandline like 

"%.bin" or commandline like 

"%.vbransom" or commandline like 

"%.RMCM1" or commandline like 

"%.cryeye" or commandline like 

"%.unavailable" or commandline like 

"%.braincrypt" or commandline like 

"%.fucked" or commandline like 

"%.crypte" or commandline like 

"%._AiraCropEncrypted" or commandline like 

"%.stn" or commandline like 

"%.paym" or commandline like 

"%.spora" or commandline like 

"%.dll" or commandline like 

"%.RARE1" or commandline like 

"%.alcatraz" or commandline like 

"%.pzdc" or commandline like 

"%.aaa" or commandline like 

"%.encrypted" or commandline like 

"%.ttt" or commandline like 

"%.odcodc" or commandline like 

"%.vvv" or commandline like 

"%.ruby" or commandline like 

"%.pays" or commandline like 

"%.comrade" or commandline like 

"%.enc" or commandline like 

"%.abc" or commandline like 

"%.xxx" or commandline like 

"%.antihacker2017" or commandline like 

"%.herbst" or commandline like 

"%.szf" or commandline like 

"%.rekt" or commandline like 

"%.bript" or commandline like 

"%.crptrgr" or commandline like 

"%.kkk" or commandline like 

"%.rdm" or commandline like 

"%.BarRax" or commandline like 

"%.vindows" or commandline like 

"%.helpmeencedfiles" or commandline like 

"%.hnumkhotep" or commandline like 

"%.CCCRRRPPP" or commandline like 

"%.kyra" or commandline like 

"%.fun" or commandline like 

"%.rip" or commandline like 

"%.73i87A" or commandline like 

"%.bitstak" or commandline like 

"%.kernel_complete" or commandline like 

"%.payrms" or commandline like 

"%.a5zfn" or commandline like 

"%.perl" or commandline like 

"%.noproblemwedecfiles " or commandline like 

"%.lcked" or commandline like 

"%.p5tkjw" or commandline like 

"%.paymst"|  duration 30d

stream=ep-process AND system='{TargetHost}'

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) |groupby srcip| duration 5m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where threattype='Malicious' | checkif srcip in tcstipip.ip | groupby srcip, dstip, act | duration 24h

stream=* | checkif devsrcip in CriticalDevices.Critical_Servers | groupby devsrcip | duration 2h

stream=AUDITD where action='PROCESS_ADDED' and (process='nc' or process like "%ncat%" or process like "%netcat%" or process like "%nc\.openbsd%" or process like "%nc\.traditional%") and user='{SuspectUser}' and system='{TargetHost}' | duration 6m

stream=AUDITD where action='PROCESS_ADDED' and (process='nc' or process like "%ncat%" or process like "%netcat%" or process like "%nc\.openbsd%" or process like "%nc\.traditional%") | groupby system, user

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) | groupby srcip | duration 5m

stream=authentication where sourcename='WINDOWS' and user like '_conn_' and logontype in ('2', '10', '11')| select user| duration 1d

stream=firewall where srctype='PUBLIC' and srcisp!='Schreiber Foods, Inc.' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) | groupby srcip, dstport | duration 24h | limit 20

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=firewall where srctype='PUBLIC' |select count(dstport) as port_count, count(distinct(dstip)) as dstip_count, srcip| groupby srcip| having port_count>=10 and dstip_count>=10 | duration 1h

stream=firewall where threattype='Malicious' and act not in ('deny','block') | groupby srcip, dstip, act, threattype | duration 1d

stream=firewall where threattype='Malicious' and act not in ('deny','block') | groupby srcip, dstip, act | duration 1d

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=firewall where srctype='PUBLIC' |select count(dstport) as port_count, count(distinct(dstip)) as dstip_count, srcip| groupby srcip| having port_count>=10 and dstip_count>=10 | duration 1h

stream=firewall where threattype='Malicious' and act not in ('deny','block') | groupby srcip, dstip, act | duration 1d

stream=* | checkif devsrcip in CriticalDevices.Critical_Servers | groupby devsrcip | duration 2h

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON'|checkif workstation not in DomainControllers.Hostname |select user, count(distinct(workstation)) as unique_system 
|groupby user| having unique_system>3 | duration 30m

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON' and user='{SuspectUser}' and unique_system='{TargetHost}'

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON'|checkif workstation not in DomainControllers.Hostname |select user, count(distinct(workstation)) as unique_system 
|groupby user| having unique_system>3 | duration 30m

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON' and user='{SuspectUser}' and unique_system='{TargetHost}'

stream=firewall where threattype='Malicious' | checkif dstip in tcstipip.IP | groupby srcip, dstip, act | duration 7d | limit 10

stream=firewall | checkif srcip not in DCIPs.DeviceIP | groupby srcip | duration 7d | last 10

stream=firewall where srctype='PUBLIC' and srcisp!='Schreiber Foods, Inc.' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) | groupby srcip, dstport | duration 7d | last 10

stream=firewall where threattype='Malicious' | checkif dstip in tcstipip.IP | groupby srcip, dstip, act | duration 7d | last 10

stream=iam where action='PASSWORD_CHANGED'| select targetuser, user, count(action) as act | checkif user in AdminVIPList.VIPUser | groupby targetuser, user |having act>=3| duration 3h

stream=firewall where srctype='PUBLIC' and srcisp!='Schreiber Foods, Inc.' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) | groupby srcip, dstport | duration 7d | last 10

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and dstip not in ('8.8.8.8','8.8.4.4') | groupby srcip, dstip | duration 7d | last 10

stream=firewall where srctype='PUBLIC' and srcisp!='Schreiber Foods, Inc.' | groupby srcip, srcisp | duration 7d | last 10

stream=firewall where srctype='PUBLIC' |select count(dstport) as port_count, count(distinct(dstip)) as dstip_count, srcip| groupby srcip| having port_count>=10 and dstip_count>=10 | duration 1m

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=* where devsrcip!='10.70.18.249' | select distinct(devsrcip) as devsrcip, count(*) as event_count |groupby devsrcip | having event_count >1000000 | duration 2h

stream=iam where action='PASSWORD_CHANGED'| select targetuser, user, count(action) as act | checkif user in AdminVIPList.VIPUser | groupby targetuser, user |having act>=3| duration 1h

stream=firewall where srctype='PUBLIC' and srcisp!='Schreiber Foods, Inc.' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) | groupby srcip, dstport | duration 7d | limit 10

stream=firewall where srctype='PUBLIC' and srcisp!='Schreiber Foods, Inc.' | groupby srcip, srcisp | duration 7d | last 10

stream=firewall where threattype='Malicious' | checkif dstip in tcstipip.IP | groupby srcip, dstip, act | duration 7d | last 10

stream=firewall where srctype="PUBLIC" and srcisp!='SCHREIBERFOODS' and srcisp='Schreiber Foods, Inc.'
| select  srcip, dstport, count(distinct(dstip)) as dst_ip, count_if(act='accept') as allowed_traffic, 
count_if(act='deny') as denied_traffic
| groupby srcip, dstport | having dst_ip>=20 and denied_traffic>=20 and allowed_traffic>=1 | duration 10m

stream=firewall where srctype='PUBLIC' AND dstport='{TargetPort}' AND srcip='{SuspectHost}'

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and dstip not in ('8.8.8.8','8.8.4.4') | groupby srcip, dstip | duration 7d | limit 10

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and dstip not in ('8.8.8.8','8.8.4.4') | groupby srcip, dstip | duration 7d | last 10

stream=firewall where threattype='Malicious' | checkif srcip in tcstipip.ip | groupby srcip, dstip, act | duration 7d | last 10

stream=firewall where threattype='Malicious' | checkif srcip in tcstipip.ip | groupby srcip, dstip, act | duration 7d | last 10

stream=authentication where sourcename='WINDOWS' and action='LOGIN' and status='FAILED' and reason='USER_DISABLED' and user not like '%$' 

stream=authentication where sourcename='WINDOWS' and action='LOGIN' and status='FAILED' and reason='USER_DISABLED' and user not like "%$" 
|select user, count(action) as act| groupby user| having act>=10 | duration 1h

stream=authentication where eid='4624' and logontype='9' and (user!='System' or user!='SYSTEM')  | select user| groupby user, eid | duration 30m

stream=authentication where eid='4648' AND user='{TargetUser}'

stream=authentication where eid='4624' and logontype='9' and user not in ('System','SYSTEM')  | select user| groupby user, eid | duration 30m

stream=authentication where eid='4648' AND user='{TargetUser}'

stream=iam where action='PASSWORD_CHANGED' and status='FAILED' and targetuser='{targetuser}'

stream=iam where action='PASSWORD_CHANGED' and status='FAILED'| select targetuser, count(status) as attempt_count | checkif targetuser in AdminVIPList.VIPUser | checkif targetuser in AdminVIPList.VIPEmail | groupby targetuser |having attempt_count>=3| duration 30d

stream=firewall where threattype='Malicious' and act not in ('deny','block') | groupby srcip, dstip, act

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and dstip not in ('8.8.8.8','8.8.4.4') | groupby srcip, dstip | duration 7d | limit 10

stream=firewall where threattype='Malicious' and act not in ('deny','block') and srctype="PUBLIC"
 and srcip not like "198.185.9.%" and srcisp!='SCHREIBERFOODS'
 and severitylevel="High" and confidencelevel="High" | groupby srcip

stream=* where devsrcip!='10.70.18.249' | select distinct(devsrcip) as devsrcip, count(*) as event_count |groupby devsrcip | having event_count >1000000 | duration 1h

stream=firewall where threattype='Malicious' and act not in ('deny','block','server-rst','client-rst') and srctype="PRIVATE" and dsttype="PUBLIC"
 and dstisp!='SCHREIBERFOODS' and severitylevel="High" and confidencelevel="High" | groupby dstip

stream=firewall where srctype='PUBLIC' and srcisp!='Schreiber Foods, Inc.' | groupby srcip, srcisp | duration 7d | limit 10

stream=firewall | checkif srcip not in DCIPs.DeviceIP | groupby srcip | duration 7d | limit 10

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) | groupby srcip | duration 30m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) | groupby srcip | duration 30m

stream=firewall where threattype='Malicious' and act not in ('deny','block','server-rst','client-rst') and srctype="PRIVATE" and dsttype="PUBLIC"
 and dstisp!='SCHREIBERFOODS' and severitylevel="High" and confidencelevel="High" | groupby dstip

stream=firewall where threattype='Malicious' and act not in ('deny','block','server-rst','client-rst') and srctype="PUBLIC"
 and srcip not like "198.185.9.%" and srcisp!='SCHREIBERFOODS'
 and severitylevel="High" and confidencelevel="High" | groupby srcip

stream=firewall where threattype='Malicious' and act not in ('deny','block','server-rst','client-rst') and srctype="PUBLIC"
 and srcip not like "198.185.9.%" and srcisp!='SCHREIBERFOODS'
 and severitylevel="High" and confidencelevel="High" | groupby srcip

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp!='Schreiber Foods, Inc.' | groupby srcip, srcisp | duration 30m

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp!='Schreiber Foods, Inc.' | groupby srcip, dstport | duration 30m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp!='Schreiber Foods, Inc.' | groupby srcip | duration 30m

stream=authentication where action='LOGIN' and sourcename='FORTIGATE' and act='ssl-login-fail' and user!='N/A'
| select srcip,count(distinct(user)) as usercount, count(action) as action, count_if(status='PASSED') as pass_count
|groupby srcip| having action>=25 and usercount >=3 and pass_count>=1 | duration 1h

stream=authentication where action='LOGIN' and sourcename='FORTIGATE' and srctype='PUBLIC' and user!='N/A'
| select srcip,count(distinct(user)) as usercount, count(action) as action, count_if(status='PASSED') as pass_count
|groupby srcip| having action>=25 and usercount >=3 and pass_count>=1 | duration 1h

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') | groupby srcip, dstport, dstip | duration 30m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') | groupby srcip, dstport, dstip | duration 30m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hash='{SuspectHash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST'
|select count(distinct(hostname)) as host_count, hash | having host_count<=1 | groupby hash | duration 2d

stream=win-audit where eid='4698' or eid='602' or eid='4699' |select user, count(distinct(eid)) as unique_eid
|groupby user| having unique_eid >=2 |  duration 20m

stream=email-gateway where action='EMAIL_SENT' and sender like '%@schreiberfoods%' | select sender, count(sender) as number_of_emails_sent 
| groupby sender| having number_of_emails_sent>50

stream=email-gateway where action='EMAIL_SENT' and sender='{SuspectUser}'

stream=email-gateway where action='EMAIL_SENT' and sender like '%@schreiberfoods%' | select sender, count(sender) as number_of_emails_sent 
| groupby sender| having number_of_emails_sent>50

stream=email-gateway where action='EMAIL_SENT' and sender='{SuspectUser}'

stream=authentication where action='LOGIN' and srcip !="-" and status="FAILED" and user!="Not Available" and 
reason!="AuthenticationFailedSasError" and user not like ('%$') | select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>25 and usercount >1 | duration 1h

stream=authentication where sourcename="WINDOWS" AND action="LOGIN" AND status="FAILED" and user not like ('%$') and not rlike(user,"([a-zA-Z0-9]*)_.*") | select user, srcip, count(status) AS FailCount | groupby srcip,user | having FailCount>=50

stream=authentication where sourcename="WINDOWS" AND action="LOGIN" AND status="FAILED" and user not like ('%$') and not rlike(user,"([a-zA-Z0-9]*)_.*") | select user, srcip, count(status) AS FailCount | groupby srcip,user | having FailCount>=50

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hash='{SuspectHash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST'
|select count(distinct(hostname)) as host_count, hash | having host_count<=1 | groupby hash | duration 2d

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST'
|select count(distinct(hostname)) as host_count, hash | having host_count<=1 | groupby hash | duration 1h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hash='{SuspectHash}'

stream=authentication where action='LOGIN' and srcip !="-" and status="FAILED" and user!="Not Available" and 
reason!="AuthenticationFailedSasError" and user not like ('%$') | select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>25 and usercount >1 | duration 1h

stream=firewall where srctype="PRIVATE" | checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, dstport, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby srcip, dstport | having denied_count>=500 | duration 5m

stream=firewall where srctype="PRIVATE" | checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, dstport, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby srcip, dstport | having denied_count>=500 | duration 5m

stream=firewall where dstport NOT in (21,22,23,69,115,990,989) and proto in ('FTP', 'SSH', 'SFTP', 'TFTP', 'TELNET', 'FTPS') and srcip='{SuspectHost}'

stream=firewall where dstport NOT in (21,22,23,69,115,990,989) and proto in ('FTP', 'SSH', 'SFTP', 'TFTP', 'TELNET', 'FTPS')
| groupby srcip | duration 1h

stream=firewall | select dstip, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby dstip | having denied_count>=1000 | duration 1d

stream=firewall where dstip='{SuspectHost}'

stream=firewall | select dstip, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby dstip | having denied_count>=1000 | duration 1d

stream=firewall where dstip='{SuspectHost}'

stream=firewall where dstip='{SuspectHost}'

stream=firewall | select dstip, count_if(action='PACKET_BLOCKED') as denied_count 
| groupby dstip | having denied_count>=1000

stream=win-audit where eid='4698' or eid='602' or eid='4699' |select user, count(distinct(eid)) as unique_eid
|groupby user| having unique_eid >=2 |  duration 20m

stream=firewall where srctype='PUBLIC' |select count(dstport) as port_count, count(distinct(dstip)) as dstip_count, srcip| groupby srcip| having port_count>=10 and dstip_count>=10 | duration 5m

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=iam WHERE action='USER_ENABLED' OR action='USER_DISABLED' | select targetuser, count(distinct(action)) as act 
| groupby targetuser |having act>=2| duration 1h

stream=iam WHERE action='USER_ENABLED' OR action='USER_DISABLED' and targetuser='{TargetUser}'

stream=iam WHERE action='USER_ENABLED' OR action='USER_DISABLED' and targetuser='{TargetUser}'

stream=iam WHERE action='USER_ENABLED' OR action='USER_DISABLED' | select targetuser, count(distinct(action)) as act 
| groupby targetuser |having act>=2| duration 1h

stream=authentication where eid='4624' and logontype='9' | select user| groupby user, eid

stream=authentication where eid='4648' AND user='{TargetUser}'

stream=firewall where srctype='PUBLIC' | select count(dstport) as port_count, count(distinct(dstip)) as dstip_count, srcip | groupby srcip | having port_count>=10 and dstip_count>=10 | duration 5m

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=win-audit where action="OBJECT_ACCESSED" and status="PASSED" and (eid="5140" or event="A network share object was accessed.") | groupby user,system | having count_col1>=100 |duration 2h

stream=win-audit where action="OBJECT_ACCESSED" and status="PASSED" and system='{TargetHost}'

stream=iam where eid='4731' or eid='4720' and sourcename!='MS-O365' and targetuser='{TargetUser}'

stream=iam where eid='4731' or eid='4720' and sourcename!='MS-O365' |groupby targetuser, user|  duration 30m

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hostname='{suspectHost}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
|select hostname, count(distinct(hash)) as unique_hash_count |groupby hostname|having unique_hash_count>=2| duration 48h

stream=firewall where srctype="PUBLIC" | select srcip, srcisp, count_if(action='PACKET_BLOCKED') as denied_count | groupby srcip, srcisp | having denied_count>=1000

stream=firewall where srctype="PUBLIC" and srcip='{SuspectHost}'

stream=ep-process where commandline like 
"%.micro" or commandline like 

"%.zepto" or commandline like 

"%.cerber" or commandline like 

"%.locky" or commandline like 

"%.cerber3" or commandline like 

"%.cryp1" or commandline like 

"%.mole" or commandline like 

"%.onion" or commandline like 

"%.axx" or commandline like 

"%.osiris" or commandline like 

"%.crypz" or commandline like 

"%.crypt" or commandline like 

"%.locked" or commandline like 

"%.odin" or commandline like 

"%.ccc" or commandline like 

"%.cerber2" or commandline like 

"%.sage" or commandline like 

"%.globe" or commandline like 

"%.exx" or commandline like 

"%.good" or commandline like 

"%.wallet" or commandline like 

"%.1txt" or commandline like 

"%.decrypt2017" or commandline like 

"%.encrypt" or commandline like 

"%.ezz" or commandline like 

"%.zzzzz" or commandline like 

"%.MERRY" or commandline like 

"%.enciphered" or commandline like 

"%.r5a" or commandline like 

"%.aesir" or commandline like 

"%.ecc" or commandline like 

"%.enigma" or commandline like 

"%.cryptowall" or commandline like 

"%.encrypted" or commandline like 

"%.loli" or commandline like 

"%.breaking_bad" or commandline like 

"%.coded" or commandline like 

"%.ha3" or commandline like 

"%.damage" or commandline like 

"%.wcry" or commandline like 

"%.lol!" or commandline like 

"%.cryptolocker" or commandline like 

"%.dharma" or commandline like 

"%.MRCR1" or commandline like 

"%.sexy" or commandline like 

"%.crjoker" or commandline like 

"%.fantom" or commandline like 

"%.keybtc@inbox_com" or commandline like 

"%.rrk" or commandline like 

"%.legion" or commandline like 

"%.kratos" or commandline like 

"%.LeChiffre" or commandline like 

"%.kraken" or commandline like 

"%.zcrypt" or commandline like 

"%.maya" or commandline like 

"%.enc" or commandline like 

"%.file0locked" or commandline like 

"%.crinf" or commandline like 

"%.serp" or commandline like 

"%.potato" or commandline like 

"%.ytbl" or commandline like 

"%.surprise" or commandline like 

"%.angelamerkel" or commandline like 

"%.windows10" or commandline like 

"%.lesli" or commandline like 

"%.serpent" or commandline like 

"%.PEGS1" or commandline like 

"%.dale" or commandline like 

"%.pdcr" or commandline like 

"%.zzz" or commandline like 

"%.xyz" or commandline like 

"%.1cbu1" or commandline like 

"%.venusf" or commandline like 

"%.coverton" or commandline like 

"%.thor" or commandline like 

"%.rnsmwr" or commandline like 

"%.evillock" or commandline like 

"%.R16m01d05" or commandline like 

"%.wflx" or commandline like 

"%.nuclear55" or commandline like 

"%.darkness" or commandline like 

"%.encr" or commandline like 

"%.rekt" or commandline like 

"%.kernel_time" or commandline like 

"%.zyklon" or commandline like 

"%.Dexter" or commandline like 

"%.locklock" or commandline like 

"%.cry" or commandline like 

"%.VforVendetta" or commandline like 

"%.btc" or commandline like 

"%.raid10" or commandline like 

"%.dCrypt" or commandline like 

"%.zorro" or commandline like 

"%.AngleWare" or commandline like 

"%.EnCiPhErEd" or commandline like 

"%.purge" or commandline like 

"%.realfs0ciety@sigaint.org.fs0ciety" or commandline like 

"%.shit" or commandline like 

"%.atlas" or commandline like 

"%.exotic" or commandline like 

"%.crypted" or commandline like 

"%.padcrypt" or commandline like 

"%.xxx" or commandline like 

"%.hush" or commandline like 

"%.bin" or commandline like 

"%.vbransom" or commandline like 

"%.RMCM1" or commandline like 

"%.cryeye" or commandline like 

"%.unavailable" or commandline like 

"%.braincrypt" or commandline like 

"%.fucked" or commandline like 

"%.crypte" or commandline like 

"%._AiraCropEncrypted" or commandline like 

"%.stn" or commandline like 

"%.paym" or commandline like 

"%.spora" or commandline like 

"%.dll" or commandline like 

"%.RARE1" or commandline like 

"%.alcatraz" or commandline like 

"%.pzdc" or commandline like 

"%.aaa" or commandline like 

"%.encrypted" or commandline like 

"%.ttt" or commandline like 

"%.odcodc" or commandline like 

"%.vvv" or commandline like 

"%.ruby" or commandline like 

"%.pays" or commandline like 

"%.comrade" or commandline like 

"%.enc" or commandline like 

"%.abc" or commandline like 

"%.xxx" or commandline like 

"%.antihacker2017" or commandline like 

"%.herbst" or commandline like 

"%.szf" or commandline like 

"%.rekt" or commandline like 

"%.bript" or commandline like 

"%.crptrgr" or commandline like 

"%.kkk" or commandline like 

"%.rdm" or commandline like 

"%.BarRax" or commandline like 

"%.vindows" or commandline like 

"%.helpmeencedfiles" or commandline like 

"%.hnumkhotep" or commandline like 

"%.CCCRRRPPP" or commandline like 

"%.kyra" or commandline like 

"%.fun" or commandline like 

"%.rip" or commandline like 

"%.73i87A" or commandline like 

"%.bitstak" or commandline like 

"%.kernel_complete" or commandline like 

"%.payrms" or commandline like 

"%.a5zfn" or commandline like 

"%.perl" or commandline like 

"%.noproblemwedecfiles " or commandline like 

"%.lcked" or commandline like 

"%.p5tkjw" or commandline like 

"%.paymst"

stream=ep-process AND system='{TargetHost}'

stream=iam WHERE action='USER_ENABLED' OR action='USER_DISABLED' and targetuser='{TargetUser}'

stream=iam WHERE action='USER_ENABLED' OR action='USER_DISABLED' and targetuser not like '%$' | select targetuser, count(distinct(action)) as act 
| groupby targetuser |having act>=2| duration 1h

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=firewall where srctype='PUBLIC' | select count(dstport) as port_count, count(distinct(dstip)) as dstip_count, srcip | groupby srcip | having port_count>=20 and dstip_count>=20 | duration 5m

stream=webfilter where catdesc in ('Abortion', 'Dating', 'Gambling', 'Marijuana', 'Nudity and Risque', 
'Other Adult Materials', 'Pornography', 'URL Shortening', 'Advertising', 'Games', 'Meaningless Content', 
'Child Sexual Abuse', 'Crypto Mining', 'Discrimination', 'Drug Abuse', 'Explicit Violence', 'Extremist Groups', 
'Hacking', 'Illegal or Unethical', 'Plagiarism', 'Potentially Unwanted Program', 'Proxy Avoidance', 'Terrorism', 'Dynamic DNS', 
'Malicious Websites', 'Newly Observed Domain', 'Newly Registered Domain', 'Phishing', 'Spam URLs', 'Not Rated') 
| select srcip, count(proxyaction) as pcount | groupby srcip |having pcount>1000 
| duration 1h

stream=webfilter and srcip='{SuspectHost}' and pcount='{TargetResource}'

stream=iam where eid=4720 and subjectuser not like ('%$') and subjectuser not in ('iiq_ad_admin_prod','iiq_ad_admin_qa','iiq_ad_admin_dev','iiq_ad_admin_test','vro_winrm') 
| checkif subjectuser not in AdminVIPList.AdminUser
| groupby subjectuser, targetuser| duration 1h

stream=firewall where srctype="PUBLIC" and srcisp!='Schreiber Foods, Inc.' | select srcip, srcisp, srccn, count_if(act='deny') as denied_count | groupby srcip, srcisp, srccn | having denied_count>=2000 | duration 5h

stream=firewall where srctype="PUBLIC" and srcip='{SuspectHost}'

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=firewall where srctype='PUBLIC' | select count(dstport) as port_count, count(distinct(dstip)) as dstip_count, srcip | groupby srcip | having port_count>=20 and dstip_count>=20 | duration 5m

stream=email-gateway and recipient='{TargetUser}' and sender='{SuspectUser}'

stream=email-gateway where sender like  
 
"%screiberfoods%" or sender like  

"%scheiberfoods%" or sender like  

"%schriberfoods%" or sender like  

"%schreberfoods%" or sender like  

"%schreierfoods%" or sender like  

"%schreibrfoods%" or sender like  

"%schreibefoods%" or sender like  

"%schreiberoods%" or sender like  

"%schreiberfods%" or sender like  

"%scheeiberfoods%" or sender like  

"%schdeiberfoods%" or sender like  

"%schfeiberfoods%" or sender like  

"%schgeiberfoods%" or sender like  

"%schteiberfoods%" or sender like  

"%sch5eiberfoods%" or sender like  

"%sch4eiberfoods%" or sender like  

"%schrwiberfoods%" or sender like  

"%schrsiberfoods%" or sender like  

"%schrdiberfoods%" or sender like  

"%schrfiberfoods%" or sender like  

"%schrriberfoods%" or sender like  

"%schr4iberfoods%" or sender like  

"%schr3iberfoods%" or sender like  

"%schreuberfoods%" or sender like  

"%schrejberfoods%" or sender like  

"%schrekberfoods%" or sender like  

"%schrelberfoods%" or sender like  

"%schreoberfoods%" or sender like  

"%schre9berfoods%" or sender like  

"%schre8berfoods%" or sender like  

"%schreinerfoods%" or sender like  

"%schreiherfoods%" or sender like  

"%schreigerfoods%" or sender like  

"%schreiverfoods%" or sender like  

"%schreibwrfoods%" or sender like  

"%schreibsrfoods%" or sender like  

"%schreibdrfoods%" or sender like  

"%schreibfrfoods%" or sender like  

"%schreibrrfoods%" or sender like  

"%schreib4rfoods%" or sender like  

"%schreib3rfoods%" or sender like  

"%schreibeefoods%" or sender like  

"%schreibedfoods%" or sender like  

"%schreibeffoods%" or sender like  

"%schreibegfoods%" or sender like  

"%schreibetfoods%" or sender like  

"%schreibe5foods%" or sender like  

"%schreibe4foods%" or sender like  

"%schreiberdoods%" or sender like  

"%schreibercoods%" or sender like  

"%schreibervoods%" or sender like  

"%schreibergoods%" or sender like  

"%schreibertoods%" or sender like  

"%schreiberroods%" or sender like  

"%schreiberfiods%" or sender like  

"%schreiberfkods%" or sender like  

"%schreiberflods%" or sender like  

"%schreiberfpods%" or sender like  

"%schreiberf0ods%" or sender like  

"%schreiberf9ods%" or sender like  

"%schreiberfoids%" or sender like  

"%schreiberfokds%" or sender like  

"%schreiberfolds%" or sender like  

"%schreiberfopds%" or sender like  

"%schreiberfo0ds%" or sender like  

"%schreiberfo9ds%" or sender like  

"%schreiberfooss%" or sender like  

"%schreiberfooxs%" or sender like  

"%schreiberfoocs%" or sender like  

"%schreiberfoofs%" or sender like  

"%schreiberfoors%" or sender like  

"%schreiberfooes%" or sender like  

"%scheriberfoods%" or sender like  

"%schrieberfoods%" or sender like  

"%schrebierfoods%" or sender like  

"%schreiebrfoods%" or sender like  

"%schreibrefoods%" or sender like  

"%schreibefroods%" or sender like  

"%schreiberofods%" or sender like  

"%schreiberfodos%" or sender like  

"%schreiberfoosd%" or sender like  

"%schreiberfodds%" or sender like  

"%schreiber.foods%" | duration 2d

stream=email-gateway where sender like  
 
"%screiberfoods%" or sender like  

"%scheiberfoods%" or sender like  

"%schriberfoods%" or sender like  

"%schreberfoods%" or sender like  

"%schreierfoods%" or sender like  

"%schreibrfoods%" or sender like  

"%schreibefoods%" or sender like  

"%schreiberoods%" or sender like  

"%schreiberfods%" or sender like  

"%scheeiberfoods%" or sender like  

"%schdeiberfoods%" or sender like  

"%schfeiberfoods%" or sender like  

"%schgeiberfoods%" or sender like  

"%schteiberfoods%" or sender like  

"%sch5eiberfoods%" or sender like  

"%sch4eiberfoods%" or sender like  

"%schrwiberfoods%" or sender like  

"%schrsiberfoods%" or sender like  

"%schrdiberfoods%" or sender like  

"%schrfiberfoods%" or sender like  

"%schrriberfoods%" or sender like  

"%schr4iberfoods%" or sender like  

"%schr3iberfoods%" or sender like  

"%schreuberfoods%" or sender like  

"%schrejberfoods%" or sender like  

"%schrekberfoods%" or sender like  

"%schrelberfoods%" or sender like  

"%schreoberfoods%" or sender like  

"%schre9berfoods%" or sender like  

"%schre8berfoods%" or sender like  

"%schreinerfoods%" or sender like  

"%schreiherfoods%" or sender like  

"%schreigerfoods%" or sender like  

"%schreiverfoods%" or sender like  

"%schreibwrfoods%" or sender like  

"%schreibsrfoods%" or sender like  

"%schreibdrfoods%" or sender like  

"%schreibfrfoods%" or sender like  

"%schreibrrfoods%" or sender like  

"%schreib4rfoods%" or sender like  

"%schreib3rfoods%" or sender like  

"%schreibeefoods%" or sender like  

"%schreibedfoods%" or sender like  

"%schreibeffoods%" or sender like  

"%schreibegfoods%" or sender like  

"%schreibetfoods%" or sender like  

"%schreibe5foods%" or sender like  

"%schreibe4foods%" or sender like  

"%schreiberdoods%" or sender like  

"%schreibercoods%" or sender like  

"%schreibervoods%" or sender like  

"%schreibergoods%" or sender like  

"%schreibertoods%" or sender like  

"%schreiberroods%" or sender like  

"%schreiberfiods%" or sender like  

"%schreiberfkods%" or sender like  

"%schreiberflods%" or sender like  

"%schreiberfpods%" or sender like  

"%schreiberf0ods%" or sender like  

"%schreiberf9ods%" or sender like  

"%schreiberfoids%" or sender like  

"%schreiberfokds%" or sender like  

"%schreiberfolds%" or sender like  

"%schreiberfopds%" or sender like  

"%schreiberfo0ds%" or sender like  

"%schreiberfo9ds%" or sender like  

"%schreiberfooss%" or sender like  

"%schreiberfooxs%" or sender like  

"%schreiberfoocs%" or sender like  

"%schreiberfoofs%" or sender like  

"%schreiberfoors%" or sender like  

"%schreiberfooes%" or sender like  

"%scheriberfoods%" or sender like  

"%schrieberfoods%" or sender like  

"%schrebierfoods%" or sender like  

"%schreiebrfoods%" or sender like  

"%schreibrefoods%" or sender like  

"%schreibefroods%" or sender like  

"%schreiberofods%" or sender like  

"%schreiberfodos%" or sender like  

"%schreiberfoosd%" or sender like  

"%schreiberfodds%" or sender like  

"%schreiber.foods%" | duration 1h

stream=email-gateway and recipient='{TargetUser}' and sender='{SuspectUser}'

stream=win-audit where action="OBJECT_ACCESSED" and status="PASSED" and system='{TargetHost}'

stream=win-audit where action="OBJECT_ACCESSED" and status="PASSED" and (eid="5140" or event="A network share object was accessed.") | groupby user,system | having count_col1>=100 |duration 2h

stream=win-audit where action="OBJECT_ACCESSED" and status="PASSED" and (eid="5140" or event="A network share object was accessed.") | groupby user,system | having count_col1>=100 |duration 2h

stream=win-audit where action="OBJECT_ACCESSED" and status="PASSED" and system='{TargetHost}'

stream=email-gateway where sender like  
 
"%screiberfoods%" or sender like  

"%scheiberfoods%" or sender like  

"%schriberfoods%" or sender like  

"%schreberfoods%" or sender like  

"%schreierfoods%" or sender like  

"%schreibrfoods%" or sender like  

"%schreibefoods%" or sender like  

"%schreiberoods%" or sender like  

"%schreiberfods%" or sender like  

"%scheeiberfoods%" or sender like  

"%schdeiberfoods%" or sender like  

"%schfeiberfoods%" or sender like  

"%schgeiberfoods%" or sender like  

"%schteiberfoods%" or sender like  

"%sch5eiberfoods%" or sender like  

"%sch4eiberfoods%" or sender like  

"%schrwiberfoods%" or sender like  

"%schrsiberfoods%" or sender like  

"%schrdiberfoods%" or sender like  

"%schrfiberfoods%" or sender like  

"%schrriberfoods%" or sender like  

"%schr4iberfoods%" or sender like  

"%schr3iberfoods%" or sender like  

"%schreuberfoods%" or sender like  

"%schrejberfoods%" or sender like  

"%schrekberfoods%" or sender like  

"%schrelberfoods%" or sender like  

"%schreoberfoods%" or sender like  

"%schre9berfoods%" or sender like  

"%schre8berfoods%" or sender like  

"%schreinerfoods%" or sender like  

"%schreiherfoods%" or sender like  

"%schreigerfoods%" or sender like  

"%schreiverfoods%" or sender like  

"%schreibwrfoods%" or sender like  

"%schreibsrfoods%" or sender like  

"%schreibdrfoods%" or sender like  

"%schreibfrfoods%" or sender like  

"%schreibrrfoods%" or sender like  

"%schreib4rfoods%" or sender like  

"%schreib3rfoods%" or sender like  

"%schreibeefoods%" or sender like  

"%schreibedfoods%" or sender like  

"%schreibeffoods%" or sender like  

"%schreibegfoods%" or sender like  

"%schreibetfoods%" or sender like  

"%schreibe5foods%" or sender like  

"%schreibe4foods%" or sender like  

"%schreiberdoods%" or sender like  

"%schreibercoods%" or sender like  

"%schreibervoods%" or sender like  

"%schreibergoods%" or sender like  

"%schreibertoods%" or sender like  

"%schreiberroods%" or sender like  

"%schreiberfiods%" or sender like  

"%schreiberfkods%" or sender like  

"%schreiberflods%" or sender like  

"%schreiberfpods%" or sender like  

"%schreiberf0ods%" or sender like  

"%schreiberf9ods%" or sender like  

"%schreiberfoids%" or sender like  

"%schreiberfokds%" or sender like  

"%schreiberfolds%" or sender like  

"%schreiberfopds%" or sender like  

"%schreiberfo0ds%" or sender like  

"%schreiberfo9ds%" or sender like  

"%schreiberfooss%" or sender like  

"%schreiberfooxs%" or sender like  

"%schreiberfoocs%" or sender like  

"%schreiberfoofs%" or sender like  

"%schreiberfoors%" or sender like  

"%schreiberfooes%" or sender like  

"%scheriberfoods%" or sender like  

"%schrieberfoods%" or sender like  

"%schrebierfoods%" or sender like  

"%schreiebrfoods%" or sender like  

"%schreibrefoods%" or sender like  

"%schreibefroods%" or sender like  

"%schreiberofods%" or sender like  

"%schreiberfodos%" or sender like  

"%schreiberfoosd%" or sender like  

"%schreiberfodds%" or sender like  

"%schreiber.foods%" | duration 1h

stream=email-gateway and recipient='{TargetUser}' and sender='{SuspectUser}'

stream=iam where eid='4731' or eid='4720' and sourcename!='MS-O365' and targetuser='{TargetUser}'

stream=iam where eid='4731' or eid='4720' and sourcename!='MS-O365' |groupby targetuser, user|  duration 30m

stream=iam where eid='4731' or eid='4720' and sourcename!='MS-O365' and targetuser='{TargetUser}'

stream=iam where eid='4731' or eid='4720' and sourcename!='MS-O365' |groupby targetuser, user|  duration 30m

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hostname='{suspectHost}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved"
|select hostname, count(distinct(hash)) as unique_hash_count |groupby hostname|having unique_hash_count>=2| duration 48h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!="" and hash='{suspecthash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!=""
|select count(distinct(hostname)) as host_count, hash | groupby hash | having host_count>=2 | duration 48h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!="" and hash='{suspecthash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!=""
|select count(distinct(hostname)) as host_count, hash | groupby hash | having host_count>=2 | duration 48h

stream=authentication where eid='4624' and logontype='9' | select user| groupby user, eid

stream=authentication where eid='4648' AND user='{TargetUser}'

stream=firewall where srctype="PUBLIC" and srcisp!='Schreiber Foods, Inc.' | select srcip, srcisp, srccn, count_if(act='deny') as denied_count | groupby srcip, srcisp, srccn | having denied_count>=2000 | duration 5m

stream=firewall where srctype="PUBLIC" and srcip='{SuspectHost}'

stream=firewall where srctype="PUBLIC" and srcip='{SuspectHost}'

stream=firewall where srctype="PUBLIC" and srcisp!='Schreiber Foods, Inc.' | select srcip, srcisp, srccn, count_if(act='deny') as denied_count | groupby srcip, srcisp, srccn | having denied_count>=2000 | duration 5m

stream=webfilter where catdesc in ('Abortion', 'Dating', 'Gambling', 'Marijuana', 'Nudity and Risque', 
'Other Adult Materials', 'Pornography', 'URL Shortening', 'Advertising', 'Games', 'Meaningless Content', 
'Child Sexual Abuse', 'Crypto Mining', 'Discrimination', 'Drug Abuse', 'Explicit Violence', 'Extremist Groups', 
'Hacking', 'Illegal or Unethical', 'Plagiarism', 'Potentially Unwanted Program', 'Proxy Avoidance', 'Terrorism', 'Dynamic DNS', 
'Malicious Websites', 'Newly Observed Domain', 'Newly Registered Domain', 'Phishing', 'Spam URLs', 'Not Rated') 
| select srcip, count(proxyaction) as pcount | groupby srcip |having pcount>1000 
| duration 1h

stream=webfilter and srcip='{SuspectHost}' and pcount='{TargetResource}'

stream=webfilter and dstip='{SuspectHost}' AND srcip='{TargetHost}' and url='{SuspectURL}'

stream=webfilter select srcip, user, dstip| where  url like 
"%shreiberfoods%" or url like 
"%screiberfoods%" or url like 
"%scheiberfoods%" or url like 
"%schriberfoods%" or url like 
"%schreberfoods%" or url like 
"%schreierfoods%" or url like 
"%schreibrfoods%" or url like 
"%schreibefoods%" or url like 
"%schreiberoods%" or url like 
"%schreiberfods%" or url like 
"%scheeiberfoods%" or url like 
"%schdeiberfoods%" or url like 
"%schfeiberfoods%" or url like 
"%schgeiberfoods%" or url like 
"%schteiberfoods%" or url like 
"%sch5eiberfoods%" or url like 
"%sch4eiberfoods%" or url like 
"%schrwiberfoods%" or url like 
"%schrsiberfoods%" or url like 
"%schrdiberfoods%" or url like 
"%schrfiberfoods%" or url like 
"%schrriberfoods%" or url like 
"%schr4iberfoods%" or url like 
"%schr3iberfoods%" or url like 
"%schreuberfoods%" or url like 
"%schrejberfoods%" or url like 
"%schrekberfoods%" or url like 
"%schrelberfoods%" or url like 
"%schreoberfoods%" or url like 
"%schre9berfoods%" or url like 
"%schre8berfoods%" or url like 
"%schreinerfoods%" or url like 
"%schreiherfoods%" or url like 
"%schreigerfoods%" or url like 
"%schreiverfoods%" or url like 
"%schreibwrfoods%" or url like 
"%schreibsrfoods%" or url like 
"%schreibdrfoods%" or url like 
"%schreibfrfoods%" or url like 
"%schreibrrfoods%" or url like 
"%schreib4rfoods%" or url like 
"%schreib3rfoods%" or url like 
"%schreibeefoods%" or url like 
"%schreibedfoods%" or url like 
"%schreibeffoods%" or url like 
"%schreibegfoods%" or url like 
"%schreibetfoods%" or url like 
"%schreibe5foods%" or url like 
"%schreibe4foods%" or url like 
"%schreiberdoods%" or url like 
"%schreibercoods%" or url like 
"%schreibervoods%" or url like 
"%schreibergoods%" or url like 
"%schreibertoods%" or url like 
"%schreiberroods%" or url like 
"%schreiberfiods%" or url like 
"%schreiberfkods%" or url like 
"%schreiberflods%" or url like 
"%schreiberfpods%" or url like 
"%schreiberf0ods%" or url like 
"%schreiberf9ods%" or url like 
"%schreiberfoids%" or url like 
"%schreiberfokds%" or url like 
"%schreiberfolds%" or url like 
"%schreiberfopds%" or url like 
"%schreiberfo0ds%" or url like 
"%schreiberfo9ds%" or url like 
"%schreiberfooss%" or url like 
"%schreiberfooxs%" or url like 
"%schreiberfoocs%" or url like 
"%schreiberfoofs%" or url like 
"%schreiberfoors%" or url like 
"%schreiberfooes%" or url like 
"%scheriberfoods%" or url like 
"%schrieberfoods%" or url like 
"%schrebierfoods%" or url like 
"%schreiebrfoods%" or url like 
"%schreibrefoods%" or url like 
"%schreibefroods%" or url like 
"%schreiberofods%" or url like 
"%schreiberfodos%" or url like 
"%schreiberfoosd%" or url like 
"%schreiberfodds%" or url like 
"%schreiber.foods%"| duration 1h

stream=webfilter and dstip='{SuspectHost}' AND srcip='{TargetHost}' and url='{SuspectURL}'

stream=webfilter select srcip, user, dstip| where  url like 
"%shreiberfoods%" or url like 
"%screiberfoods%" or url like 
"%scheiberfoods%" or url like 
"%schriberfoods%" or url like 
"%schreberfoods%" or url like 
"%schreierfoods%" or url like 
"%schreibrfoods%" or url like 
"%schreibefoods%" or url like 
"%schreiberoods%" or url like 
"%schreiberfods%" or url like 
"%scheeiberfoods%" or url like 
"%schdeiberfoods%" or url like 
"%schfeiberfoods%" or url like 
"%schgeiberfoods%" or url like 
"%schteiberfoods%" or url like 
"%sch5eiberfoods%" or url like 
"%sch4eiberfoods%" or url like 
"%schrwiberfoods%" or url like 
"%schrsiberfoods%" or url like 
"%schrdiberfoods%" or url like 
"%schrfiberfoods%" or url like 
"%schrriberfoods%" or url like 
"%schr4iberfoods%" or url like 
"%schr3iberfoods%" or url like 
"%schreuberfoods%" or url like 
"%schrejberfoods%" or url like 
"%schrekberfoods%" or url like 
"%schrelberfoods%" or url like 
"%schreoberfoods%" or url like 
"%schre9berfoods%" or url like 
"%schre8berfoods%" or url like 
"%schreinerfoods%" or url like 
"%schreiherfoods%" or url like 
"%schreigerfoods%" or url like 
"%schreiverfoods%" or url like 
"%schreibwrfoods%" or url like 
"%schreibsrfoods%" or url like 
"%schreibdrfoods%" or url like 
"%schreibfrfoods%" or url like 
"%schreibrrfoods%" or url like 
"%schreib4rfoods%" or url like 
"%schreib3rfoods%" or url like 
"%schreibeefoods%" or url like 
"%schreibedfoods%" or url like 
"%schreibeffoods%" or url like 
"%schreibegfoods%" or url like 
"%schreibetfoods%" or url like 
"%schreibe5foods%" or url like 
"%schreibe4foods%" or url like 
"%schreiberdoods%" or url like 
"%schreibercoods%" or url like 
"%schreibervoods%" or url like 
"%schreibergoods%" or url like 
"%schreibertoods%" or url like 
"%schreiberroods%" or url like 
"%schreiberfiods%" or url like 
"%schreiberfkods%" or url like 
"%schreiberflods%" or url like 
"%schreiberfpods%" or url like 
"%schreiberf0ods%" or url like 
"%schreiberf9ods%" or url like 
"%schreiberfoids%" or url like 
"%schreiberfokds%" or url like 
"%schreiberfolds%" or url like 
"%schreiberfopds%" or url like 
"%schreiberfo0ds%" or url like 
"%schreiberfo9ds%" or url like 
"%schreiberfooss%" or url like 
"%schreiberfooxs%" or url like 
"%schreiberfoocs%" or url like 
"%schreiberfoofs%" or url like 
"%schreiberfoors%" or url like 
"%schreiberfooes%" or url like 
"%scheriberfoods%" or url like 
"%schrieberfoods%" or url like 
"%schrebierfoods%" or url like 
"%schreiebrfoods%" or url like 
"%schreibrefoods%" or url like 
"%schreibefroods%" or url like 
"%schreiberofods%" or url like 
"%schreiberfodos%" or url like 
"%schreiberfoosd%" or url like 
"%schreiberfodds%" or url like 
"%schreiber.foods%"| duration 1h

stream=documents |duration 1h

stream=* | duration 5m | limit 1

stream=iam where and targetuser= {targetuser} and action='PASSWORD_CHANGED'| duration 7d

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and file = 'Lateral Movement 172.16.74.68 (interactive session)' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST'
|select count(distinct(hostname)) as host_count, hash | having host_count<=1 | groupby hash | duration 1h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hash='{SuspectHash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hash='{SuspectHash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and file != 'Lateral Movement 172.16.74.68 (interactive session)' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST'
|select count(distinct(hostname)) as host_count, hash | having host_count<=1 | groupby hash | duration 1h

stream=iam where targetdomain not like '%MS1' and targetdomain not like '%HOMISE01' and targetdomain not like 'AWSUSE1MSP0' | select targetdomain, count_if(eid='4740') as eid_count, count(distinct(targetuser)) as user_count | checkif targetdomain not in DomainControllers.Hostname | groupby targetdomain | having eid_count >= 10 and user_count>=2 | duration 3h

stream=threat where sourcename='SENTINELONE' and eventdesc='Kill performed successfully' and hostname='BENPCTV02' | duration 1d | select hostname, hash, count(eventdesc) as kill_count | groupby hostname, hash | having kill_count>=50

stream=threat where sourcename='SENTINELONE' and eventdesc='Kill performed successfully' and hostname='BENPCTV02' | duration 1d | select hostname, hash, count(eventdesc) as kill_count | groupby hostname, hash | having kill_count>=50

stream=* | groupby devsrcip | select devsrcip, sum(evtlen) | duration 24h

stream=* | groupby devsrcip | select devsrcip, sum(evtlen) | duration 24h

stream=* | groupby devsrcip | select devsrcip, sum(evtlen) | duration 24h

stream=authentication where sourcename='WINDOWS' and action='LOGIN' and rlike(user,"([a-zA-Z0-9]*)_.*") and logontype in ('2', '10', '11') | duration 2d

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and file != 'Lateral Movement 172.16.74.68 (interactive session)' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and threatstatus!='marked_as_benign'
|select count(distinct(hostname)) as host_count, hash | having host_count<=1 | groupby hash | duration 1h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hash='{SuspectHash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!="" and threatstatus!='marked_as_benign'
|select count(distinct(hostname)) as host_count, hash | groupby hash | having host_count>=2 | duration 48h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!="" and hash='{suspecthash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hostname='{suspectHost}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatstatus!='marked_as_benign'
|select hostname, count(distinct(hash)) as unique_hash_count |groupby hostname|having unique_hash_count>=2| duration 48h

stream=authentication where sourcename='WINDOWS' and action='LOGIN' and rlike(user,"([a-zA-Z0-9]*)_.*") and logontype in ('2', '10', '11') | duration 2h

stream=authentication where sourcename='WINDOWS' and action='LOGIN' and rlike(user,"([a-zA-Z0-9]*)_.*") and logontype in ('2', '10', '11') | groupby user, subjectuser | duration 2h

stream=authentication where sourcename='WINDOWS' and action='LOGIN' and rlike(user,"([a-zA-Z0-9]*)_.*") and logontype in ('2', '10', '11')  | duration 2h

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and not rlike(user,"([a-zA-Z0-9]*)_.*") and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON'
| checkif workstation not in DCandADFS.Hostname
| select user, logontype, count(distinct(workstation)) as unique_system 
| groupby user, logontype| having unique_system>=5 | duration 30m

stream=authentication where action='LOGIN' and eid='4624' and user !='%$' and workstation!='-' and workstation!= "" and user!='ANONYMOUS LOGON' and user='{SuspectUser}' and unique_system='{TargetHost}'

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and act='deny' and dstport in (445, 3389, 22) and srcip!='172.16.72.107'
|select count(action) as act_count, srcip| having act_count>=100| groupby srcip| duration 5m

stream=firewall where srctype='PRIVATE' and dsttype='PUBLIC' and act='deny' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hash='{SuspectHash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and file != 'Lateral Movement 172.16.74.68 (interactive session)' and eventdesc!= "Threat automatically marked as resolved" and threatstatus!='marked_as_benign'
|select count(distinct(hostname)) as host_count, hash | having host_count<=1 | groupby hash | duration 1h

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' AND targetuser='{TargetUser}'

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' | select targetuser, subjectuser, count(distinct(action)) as act | groupby targetuser, subjectuser |having act>=1| duration 1h

stream=iam where and targetuser= {targetuser} and action='PASSWORD_CHANGED'| duration 7d

stream=authentication where user={user}  and deviceproperties not like ("%{'Name': 'DisplayName'%") | duration 30m

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' | select targetuser, subjectuser, count(distinct(action)) as act | groupby targetuser, subjectuser |having act>=2 | duration 1h

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' AND targetuser='{TargetUser}'

stream=iam where targetdomain not like '%MS1' and targetdomain not like '%HOMISE01' and targetdomain not like 'AWSUSE1MSP0' | select targetdomain, count_if(eid='4740') as eid_count, count(distinct(targetuser)) as user_count 
| checkif targetdomain not in DomainControllers.Hostname | groupby targetdomain | having eid_count >= 10 and user_count>=2 | duration 3h

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' | select targetuser, subjectuser, count(distinct(action)) as act | groupby targetuser, subjectuser |having act>=2 | duration 1h

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' AND targetuser='{TargetUser}'

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') | groupby srcip, dstport, dstip | duration 30m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=iam where and targetuser= {targetuser} and action='PASSWORD_CHANGED'| duration 7d

stream=iam where and targetuser= {user} and action='PASSWORD_CHANGED'| duration 7d

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') | groupby srcip, dstport, dstip | duration 30m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!="" and threatstatus!='marked_as_benign'
|select count(distinct(hostname)) as host_count, hash | groupby hash | having host_count>=2 | duration 48h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!="" and hash='{suspecthash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hostname='{suspectHost}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatstatus!='marked_as_benign'
|select hostname, count(distinct(hash)) as unique_hash_count |groupby hostname|having unique_hash_count>=2| duration 48h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hash='{SuspectHash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and file != 'Lateral Movement 172.16.74.68 (interactive session)' and eventdesc!= "Threat automatically marked as resolved" and threatstatus!='marked_as_benign'
|select count(distinct(hostname)) as host_count, hash | having host_count<=1 | groupby hash | duration 1h

stream=iam where and targetuser= {targetuser} and action='PASSWORD_CHANGED'| duration 7d

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') | groupby srcip, dstport, dstip | duration 30m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') | groupby srcip, dstport, dstip | duration 30m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') | groupby srcip, dstport, dstip | duration 30m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!="" and threatstatus!='marked_as_benign'
|select count(distinct(hostname)) as host_count, hash | groupby hash | having host_count>=2 | duration 48h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatclassifier!='BLACKLIST' and hash!="" and hash='{suspecthash}'

stream=iam WHERE action='USER_DELETED' and targetuser={targetuser} and subjectuser={subjectuser} | duration 1h

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hostname='{suspectHost}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and eventdesc!= "Threat automatically marked as resolved" and threatstatus!='marked_as_benign'
|select hostname, count(distinct(hash)) as unique_hash_count |groupby hostname|having unique_hash_count>=2| duration 48h

stream=webfilter where domain='botbot.ddosvps.cc' | duration 30m

stream=webfilter where domain='botbot.ddosvps.cc' | duration 30m

stream=webfilter where domain='botbot.ddosvps.cc' | duration 30m

stream=AUTHENTICATION where sourcename='NIX' and authproto='SSH' and logevent like ('%Timeout before authentication%') | duration 30m

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and hash='{SuspectHash}'

stream=threat where sourcename='SENTINELONE' and action='THREAT_DETECTED' and file != 'Lateral Movement 172.16.74.68 (interactive session)' and eventdesc!= "Threat automatically marked as resolved" and threatstatus!='marked_as_benign'
|select count(distinct(hostname)) as host_count, hash | having host_count<=1 | groupby hash | duration 1h

stream=firewall | checkif srcip in RegressionIOC.IP | duration 30m

stream=firewall | checkif srcip in RegressionIOC.IP | duration 30m

stream=firewall | checkif dstip in RegressionIOC.IP | duration 30m

stream=iam WHERE action='USER_CREATED' and targetuser={targetuser} and subjectuser={subjectuser} | duration 1h

stream=iam WHERE action='USER_CREATED' and targetuser={targetuser} and subjectuser={subjectuser} | duration 1h

stream=firewall where srctype='PUBLIC' and act='accept' and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') | groupby srcip, dstport, dstip | duration 30m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall | checkif dstip in RegressionIOC.IP | duration 30m

stream=AUTHENTICATION where sourcename='NIX' and authproto='SSH' and logevent like ('%Timeout before authentication%') | duration 30m

stream=iam WHERE subjectuser not like ("%$") and (action='USER_CREATED' OR action='USER_DELETED') | select targetuser, subjectuser, count(distinct(action)) as act | groupby targetuser, subjectuser |having act>=2 | duration 1h

stream=iam WHERE action='USER_CREATED' OR action='USER_DELETED' AND targetuser='{TargetUser}'

stream=authentication where user={user}  and deviceproperties like ("%{'Name': 'DisplayName'%") | duration 30m

stream=authentication where user={user} and deviceproperties like ("%{'Name': 'DisplayName'%") | duration 4h

stream=authentication where user={User} and deviceproperties like ("%{'Name': 'DisplayName'%") | duration 4h

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and srcisp!='Schreiber Foods, Inc.' and user!='Not Available' and srccn!='-' and srccn!= '' and 
deviceproperties not like ("%{'Name': 'DisplayName',%") 
| checkif user not in ImpossibleTravel_exc.Users
| select user, count(distinct(srccn)) as country_count| having country_count>=2| groupby user| duration 30m

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
and host='{suspectsrcip}' and user='{targetuser}'

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='accept' and dstip not in ("198.185.9.52","198.185.9.50") and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') | groupby srcip, dstport, dstip | duration 30m

stream=authentication where sourcetype="FIREWALL" AND action="LOGIN" AND status="FAILED" ANd srcip='{suspecthost}' and devsrcip='{targethost}'

stream=authentication where sourcetype="FIREWALL" AND action="LOGIN" AND status="FAILED" | select srcip, devsrcip, count(status) AS FailCount | groupby srcip,devsrcip | having FailCount>=50 | duration 5m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='accept' and dstip not in ("198.185.9.52","198.185.9.50") and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') | groupby srcip, dstport, dstip | duration 30m

stream=authentication where user={User} and deviceproperties like ("%{'Name': 'DisplayName'%") | duration 4h

stream=authentication where user=(user) and deviceproperties not like ("%{'Name': 'DisplayName'%") | select user, srccn, count(distinct(srccn)) as country_count | having country_count>=2  | groupby user, srccn | duration 30m

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=firewall where srctype='PUBLIC' and act='accept' and srcip not like '198.185.9.%' and srcip not like '198.185.11.%'
 | select count(distinct(dstport)) as port_count, srcip | groupby srcip |
  having port_count>=50 | duration 10m

stream=firewall where srctype='PUBLIC' and srcip not like '198.185.9.%' and srcip not like '198.185.11.%'
 | select count(distinct(dstport)) as port_count, srcip, count_if(act='accept') as allowed_conn, count_if(act!='accept') as deny_conn | groupby srcip 
 | having port_count>=50 and allowed_conn>=1 | duration 10m

stream=firewall where srctype='PUBLIC' and srcip='{SuspectHost}'

stream=firewall where srctype="PRIVATE" and dstisp!="Apple Inc." and dstip not like ("192.168.15.%") | checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, count_if(act='deny') as denied_count 
| groupby srcip | having denied_count>=2000 | duration 5m

stream=authentication where sourcename='WINDOWS' and eid=4740 and user ='targettuser'

stream=iam where sourcename='WINDOWS' and eid=4740 | select targetuser, count(eid) as eid_count | groupby targetuser | having  eid_count >=10 | duration 3h

stream=authentication where user={user} and deviceproperties like ("%{'Name': 'DisplayName'%") | duration 4h

stream=authentication where user=(user) and deviceproperties like ("%{'Name': 'DisplayName'%") | duration 4h

stream=authentication where user=(user) and deviceproperties not like ("%{'Name': 'DisplayName'%") | select user, srccn, count(distinct(srccn)) as country_count | having country_count>=2  | groupby user, srccn | duration 30m

stream=firewall where srctype="PRIVATE" and dstisp!="Apple Inc." and dstip not like ("192.168.15.%") and srcip not like ("192.168.15.%")| checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, count_if(act='deny') as denied_count 
| groupby srcip | having denied_count>=2000 | duration 5m

stream=firewall where srctype="PUBLIC" and srcip='{SuspectHost}'

stream=firewall where srctype="PUBLIC" and srcisp!='Schreiber Foods, Inc.' | select srcip, srcisp, srccn, count_if(act='deny') as denied_count | groupby srcip, srcisp, srccn | having denied_count>=50000 | duration 5m

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and srcisp!='Schreiber Foods, Inc.' and user!='Not Available' and srccn!='-' and srccn!= '' and 
deviceproperties not like ("%{'Name': 'DisplayName'%")
| checkif user not in ImpossibleTravel_exc.Users
| select user, count(distinct(srccn)) as country_count| having country_count>=2| groupby user| duration 30m

stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and user!='Not Available' and srccn!='-' and srccn!= ''
and host='{suspectsrcip}' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' and user!='Not Available' and srctype='PUBLIC' |
select user, count_if(status='FAILED') as fail_count | groupby user | having fail_count>=10 | duration 30m

stream=authentication where action='LOGIN' and user!='Not Available' | select user, count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | groupby user | having fail_count>=20 and pass_count>=1 | duration 5m

stream=authentication where action='LOGIN' and user='{targetuser}'

stream=authentication where action='LOGIN' and user!='Not Available'
 and reason not in ('UserStrongAuthClientAuthNRequiredInterrupt', 'AuthenticationFailedSasError', 'RequestExceededGatewayTimeout')
| select user, count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | groupby user 
| having fail_count>=20 and pass_count>=1 | duration 10m

stream=authentication where action='LOGIN' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' and user!='Not Available' and srctype='PUBLIC' and reason='IdsLocked'|
select user, reason, count_if(status='FAILED') as fail_count | groupby user, reason | having fail_count>=10 | duration 10m

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=cloudtrail where eventname in ('GetSecretValue','Decrypt') and useragent NOT like '%flexdeploy%' and 
userarn NOT like '%flexdeploy%' and srcisp!='Amazon.com, Inc.' 
|select userarn, count(*) as decryptions|groupby userarn |having decryptions >=10|duration 1h

stream=authentication where sourcename='MS-O365' and action='LOGIN' and user!='Not Available' and srctype='PUBLIC' and reason!='IdsLocked'|
select user, reason, count_if(status='FAILED') as fail_count | groupby user, reason | having fail_count>=10 | duration 10m

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where action='LOGIN' and user!='Not Available' and user not LIKE "%$"
| select user,count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | groupby user
| having fail_count>=20 and pass_count>=1 | duration 1d

stream=authentication where action='LOGIN' and user='{targetuser}'

stream=authentication where sourcename='MS-O365' and action='LOGIN' and user!='Not Available' and srctype='PUBLIC'|
select user, reason, count_if(status='FAILED') as fail_count | groupby user, reason | having fail_count>=10 | duration 10m

stream=authentication where sourcename='MS-O365' and action='LOGIN' and status='FAILED' and reason = 'InvalidUserNameOrPassword' and user='{targetuser}'

stream=authentication where action='LOGIN' and user='{targetuser}'

stream=authentication where action='LOGIN' and user!='Not Available' and user='%$%'
| select user,count_if(status='FAILED') as fail_count, count_if(status='PASSED') as pass_count | groupby user
| having fail_count>=20 and pass_count>=1 | duration 30m

stream=configuration where eventname in ('FIREWALL_DISABLED')|duration 1d

stream=iam WHERE action='USER_DELETED' and targetuser={targetuser} and subjectuser={subjectuser} | duration 1h

stream=threat where devsrcip='Abnormal' and attacktype='Phishing: Credential' and action='THREAT_DETECTED' | select sender, count(action) as no_of_emails | groupby sender | having no_of_emails >=20 | duration 10m

stream=threat where sourcename='ABNORMAL SECURITY' and attacktype like ("%Spam%") and action='THREAT_DETECTED' | select sender, count(action) as no_of_emails | groupby sender | having no_of_emails >= 50 | duration 30m

stream=authentication where sourcename='WINDOWS' and eid=4740 and user ='targettuser'

stream=iam where sourcename='WINDOWS' and eid=4740 and subjectuser NOT like '%$'| select targetuser, count(eid) as eid_count |groupby targetuser | having  eid_count >=10 | duration 3h

stream=threat where devsrcip='Abnormal' and attacktype='Phishing: Credential' and action='THREAT_DETECTED' and isautoremediated='False'
 and ispostremediated='False'
| select sender, count(action) as no_of_emails | groupby sender | having no_of_emails >=20 | duration 20m

stream=firewall where srctype='PUBLIC' and act='allow' and dstport in (445, 3389, 22) and srcip='{suspecthost}' and act_count='{targetresource}'

stream=firewall where srctype='PUBLIC' and act='accept' and dstip not in ("198.185.9.52","198.185.9.50") and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') and srcip not like ("198.185.12%") | groupby srcip, dstport, dstip | duration 30m

stream=authentication where action='LOGIN' and sourcename='WINDOWS' and status="FAILED" and user not like "%$" 
 and srcip!='-' and srcip!='172.16.72.22'
| select srcip,count(distinct(user)) as usercount, count(action) as action 
|groupby srcip| having action>=25 and usercount >=3 | duration 30m

stream=firewall where srctype!="PRIVATE" and dstip='{targethost}' and srcip='{SuspectHost}'

stream=firewall where srctype!="PRIVATE"| select  srcip, dstip, count(distinct(dstport)) as PortCount, count_if(act='accept') as allowed_traffic, count_if(act='deny') as denied_traffic
| groupby srcip, dstip | having PortCount>=20 and denied_traffic>=1 and allowed_traffic>=2 | duration 1h

stream=configuration where eventname in ('FIREWALL_DISABLED')|duration 1d

stream=cloudtrail where eventname in ('GetSecretValue','Decrypt') and useragent NOT like '%flexdeploy%' and 
userarn NOT like '%flexdeploy%' and srcisp!='Amazon.com, Inc.' 
|select userarn, count(*) as decryptions|groupby userarn |having decryptions >=10|duration 1h

stream=configuration where eventname='COPY_TO_REMOVABLE_STORAGE'|select emailid, count(eventname) as count_of_files_copied_to_removable_media
| having count_of_files_copied_to_removable_media>=50 |groupby emailid | duration 1d

stream=configuration where eventname='COPY_TO_REMOVABLE_STORAGE'|select emailid, count(eventname) as count_of_files_copied_to_removable_media
| having count_of_files_copied_to_removable_media>=50 |groupby emailid | duration 1d

stream=configuration where eventname='COPY_TO_REMOVABLE_STORAGE'|select emailid, count(eventname) as count_of_files_copied_to_removable_media
| having count_of_files_copied_to_removable_media>=50 |groupby emailid | duration 1d

stream=configuration where eventname in ('FIREWALL_DISABLED')|groupby emailid, logonname|duration 1d

stream=cloudtrail where eventname in ('GetSecretValue','Decrypt') and useragent NOT like '%flexdeploy%' and 
userarn NOT like '%flexdeploy%' and srcisp!='Amazon.com, Inc.' 
|select userarn, count(*) as decryptions|groupby userarn |having decryptions >=10|duration 5d

stream=cloudtrail where eventname in ('GetSecretValue','Decrypt') and useragent NOT like '%flexdeploy%' and 
userarn NOT like '%flexdeploy%' and srcisp!='Amazon.com, Inc.' 
|select userarn, count(*) as decryptions|groupby userarn |having decryptions >=10|duration 7d

stream=configuration where eventname='COPY_TO_REMOVABLE_STORAGE'|select emailid, count(eventname) as count_of_files_copied_to_removable_media
| having count_of_files_copied_to_removable_media>=50 |groupby emailid | duration 1d

stream=iam WHERE action='USER_DELETED' and targetuser={targetuser} and subjectuser={subjectuser} | duration 7d

stream=iam WHERE action='USER_DELETED' and targetuser={targetuser} and subjectuser={subjectuser} | duration 14d

stream=cloudtrail where eventname in ('GetSecretValue','Decrypt') and useragent NOT like '%flexdeploy%' and 
userarn NOT like '%flexdeploy%' and srcisp!='Amazon.com, Inc.' 
|select userarn, count(*) as decryptions|groupby userarn |having decryptions >=10|duration 1h

stream=cloudtrail where eventname in ('GetSecretValue','Decrypt') and useragent NOT like '%flexdeploy%' and 
userarn NOT like '%flexdeploy%' and srcisp!='Amazon.com, Inc.' 
|select userarn, count(*) as decryptions|groupby userarn |having decryptions >=10|duration 1h

stream=configuration where eventname in ('FIREWALL_DISABLED')|groupby emailid, logonname|duration 1d

stream=azure

stream=configuration where sourcename='FORCEPOINT NEO' and eventname in ('FIREWALL_DISABLED') | groupby logonname, system | duration 1h

stream=documents where sourcename='MS-O365' and operation='SharePoint'|select user, count_if(action='DELETED') as count_of_deleted|groupby user|having count_of_deleted>=10|duration 5d

stream=configuration where sourcename='FORCEPOINT NEO' and eventname='COPY_TO_REMOVABLE_STORAGE'|select logonname, system, count(eventname) as files_copied
| having files_copied>=50 | groupby logonname, system | duration 1d

stream=configuration where sourcename='FORCEPOINT NEO' and eventname='COPY_TO_REMOVABLE_STORAGE'|select logonname, system, count(eventname) as files_copied
| having files_copied>=50 | groupby logonname, system | duration 1h

stream=win-audit where sourcename='WINDOWS' and action='POLICY_CHANGED'  and event='An attempt was made to unregister a security event source.' and subjectuser like ("%$") | groupby subjectuser| duration 1h

stream=email-gateway where sourcename='FORCEPOINT NEO' and rulename='Email sent to personal email domain'|select sender, count (*) as count_of_files|groupby sender|having count_of_files>=10|duration 10m

stream=email-gateway where sourcename='FORCEPOINT NEO' and rulename='Email sent to personal email domain'|select sender, count (*) as count_of_files|groupby sender|having count_of_files>=10|duration 10m

stream=documents where sourcename='MS-O365' and operation='OneDrive' |select user, count_if(action='DELETED') as count_of_deleted|groupby user|having count_of_deleted>=100|duration 1h

stream=win-audit where sourcename='WINDOWS' and action='POLICY_CHANGED'  and event='An attempt was made to unregister a security event source.' and subjectuser like ("%$") | groupby subjectuser| duration 1h

stream=email-gateway where sourcename='FORCEPOINT NEO' and rulename='Email sent to personal email domain'|select sender, count (*) as count_of_files|groupby sender|having count_of_files>=10|duration 10m

stream=documents where sourcename='MS-O365' and operation='OneDrive' |select user, count_if(action='DELETED') as count_of_deleted|groupby user|having count_of_deleted>=100|duration 1h

stream=documents where sourcename='MS-O365' and operation='SharePoint'|select user, count_if(action='DELETED') as count_of_deleted|groupby user|having count_of_deleted>=10|duration 5d

stream=documents where sourcename='MS-O365' and operation='SharePoint'|select user, count_if(action='DELETED') as count_of_deleted|groupby user|having count_of_deleted>=10|duration 5d

stream=win-audit where sourcename='WINDOWS' and action='POLICY_CHANGED'  and event='An attempt was made to unregister a security event source.' and subjectuser not like ("%$") | groupby subjectuser| duration 1h

stream=threat where sourcename='TENABLE DEVELOPER' and severity='critical'|groupby firstfound, assetfqdn| select firstfound,assetfqdn, count(severity) as critical_count| having critical_count>=100 | duration 1d

stream=threat where sourcename='WINDOWS' and threat='A replay attack was detected.' and subjectuser not like '%$' | groupby subjectuser|duration 3d

stream=auditd where sourcename='NIX' and user in ('user', 'root') 
 and commandline not in ('%passwd%', '%setfacl%', '%sudo%', '%wget%', '%systemctl stop auditd%')|  groupby system|duration 14m

stream=auditd where sourcename='NIX' and user in ('user', 'root') 
 and commandline not in ('%passwd%', '%setfacl%', '%sudo%', '%wget%', '%systemctl stop auditd%')|  groupby system|duration 14m

stream=threat where sourcename='WINDOWS' and threat='A replay attack was detected.' and subjectuser not like '%$' | groupby subjectuser|duration 3d

stream=win-audit where subjectuser like '%$' 
 and event in ('System audit policy was changed.', 'Auditing settings on object were changed.', 'A registry value was modified.')|  groupby subjectuser| duration 32m

stream=win-audit where subjectuser like '%$' 
 and event in ('System audit policy was changed.', 'Auditing settings on object were changed.', 'A registry value was modified.')|  groupby subjectuser| duration 32m

