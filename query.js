const queries = [
    `stream=firewall where sourcetype="FIREWALL" and srctype="PUBLIC" and not (dstport="80" or dstport="443" or dstport="8080" or act="deny") |  select srcip, dstip, distinct_count(dstport) as cntdstport, count_if(action=="PACKET_ALLOWED" or action=="ACCEPT" or action=="ALLOW") as actioncnt |  groupby srcip, dstip |  having cntdstport>500 and actioncnt > 0`,
    `stream=iam where where sourcename="WINDOWS" and eid="4740" | duration 1h | select targetdomain, system, distinct_count(targetuser) as cntuser, count(*) as cntevent | groupby targetdomain, system | having cntevent>15`,
    `stream=authentication | where user= "theo.hamilton@plutusinc.org" and action='LOGIN' |groupby user, status| select user, status`,
    `stream=authentication where action="LOGIN" | duration =20m | groupby user, srcip, system| select user, srcip, system, count_if(status="PASSED") AS PASS ,count_if(status="FAILED") AS FAIL| having FAIL>10 or FAIL>5*PASS`,
    `stream=authentication  where action='LOGIN'  | duration=10h |  groupby user,srcip,system | select user,srcip,system, count_if(Status='PASSED') AS PASSED_COUNT, count_if(Status='FAILED') AS FAILED_COUNT | having FAILED_COUNT>10 and FAILED_COUNT>10*PASSED_COUNT`,
    `stream=authentication | where action= "LOGIN" and status= "FAILED" | groupby user | limit 10`,
    `stream=authentication | where action= "LOGIN" and status= "PASSED" | groupby user | limit 10`,
    `stream=firewall where sourcetype="FIREWALL" and srctype="PUBLIC" and not (dstport="80" or dstport="8080" or dstport="443") |  select srcip, dstport, distinct_count(dstip) as dstipcnt, count_if(actiontaken=="accept" or actiontaken=="close" or actiontaken=="ip-conn") as actioncnt |  groupby srcip, dstport | having dstipcnt > 10 and actioncnt > 1`,
    `stream=firewall where sourcetype="FIREWALL" and srctype="PUBLIC" |  select srcip, dstip, distinct_count(dstport) as cntdstport, count_if(actiontaken=="accept" or actiontaken=="close" or actiontaken=="ip-conn") as actioncnt |  groupby srcip, dstip |  having cntdstport>50 and actioncnt > 1`,
    `stream=IAM where (action='USER_DISABLED' or action='USER_ENABLED') | select user, targetuser, distinct_count(action) as countaction | groupby user, targetuser | having countaction=2`,
    `stream=webfilter | where action='URL_BLOCKED' AND (category='Nudity' or category='Adult Sex Education' or category='Adult Themes' or category='Pornography' or category='K-12 Sex Education' or category='Lingerie/Bikini' or category='Other Adult Material') | duration 1h`,
    `stream=* where devsrcip="172.16.15.200" and sourcename="FORCEPOINT-CLOUD-PROXY" not like "%None%" and (domain like '%.surf' or domain like '%.gq' or domain like '%.cf' or domain like '%.ml' or domain like '%.tk' or domain like '%.work' or domain like '%.tokyo' or domain like '%.top' or domain like '%.fit' or domain like '%.webcam' or domain like '%.loan' or domain like '%.viajes' or domain like '%.email' or domain like '%.rest' or domain like '%.london' or domain like '%.pw' or domain like '%.ws' or domain like '%keznews%' or domain like '%ipulsecloud%' or domain like '%mega.%' or domain like '%Mega.%' or domain like '%KEZNEWS.%')|  groupby srcip`,
    `stream=EMAIL-GATEWAY where action='EMAIL_REDIRECTED' and (recipient like "%gmail%" or recipient like "%yahoo%" or recipient like "%rediffmail% or recipient like "%outlook% or recipient like "%hotmail%" or recipient like "%proton%") | select sender, count(action) as CntEmails | groupby sender | having CntEmails > 100`,
    `stream=FIREWALL where dsttype="PUBLIC" and srctype!="PUBLIC" and srcip!="192.168.1.160" and dstip not in ("172.16.12.190","172.30.58.27","10.6.5.139","172.28.15.21","172.20.0.47","172.20.0.77","10.100.5.99","10.100.5.100","172.17.0.9","172.17.0.140") and dstport in ("139","445") and logevent not in ("%Deny%","%deny%","%denied%","%timeout%","%action=0%","%terminated%") and act not in ("deny","Deny","denied") |  duration 5m`,
    `stream=threat where devsrcip="172.16.15.200" and lower(commandline) like ("%-enc%") | groupby SrcHost, CommandLine `,
    `stream=win-audit where eid=4688 and parentprocess like'%sc.exe%' 'and (logevent like '%create%' or logevent like '%\config%') | groupby system`,
    `stream=win-audit where logevent like "%net.exe%"" or logevent like "%net1.exe%" or logevent like "%localgroup%" or logevent like "%/add%"" or logevent like "%user%"" | groupby system`,
    `stream=webfilter where devsrcip="172.16.10.54" AND category LIKE "%Phishing%URL%" |  groupby category,srcip | duration 1d`,
    `stream=webfilter where devsrcip="172.16.10.54" AND category LIKE "%Cross-site%Scripting%" |  groupby category,srcip`,
    `stream=webfilter where devsrcip="172.16.10.54" AND category LIKE "%Cryptomining%" |  groupby category,srcip`,
    `stream=THREAT where devsrcip="Office 365" and action="THREAT_DETECTED" and threat="Phish: [URL detonation reputation]" and  @OriginalDeliveryLocation!="Quarantine"  |  duration 5m`,
    `stream=IAM where action in ('USER_ACCOUNT_CREATED','USER_ACCOUNT_DELETED') | select user, targetuser, distinct_count(action) as CountAction | groupby user, targetuser | having CountAction=2`,
    `stream=threat where devsrcip='Abnormal' and attacktype like("%Phishing%") and isautoremediated='False' and ispostremediated='False' | checkif url in tcstipdomain.url |duration 7d`,
    `stream=firewall where srctype='PUBLIC' and act ='accept' and dstport in ('22','139','445') and srcip not like ('198.185.11.%') and srcip not like ('198.185.9.%') and policyname!='SSH & FTP Whitelist to MFT' and policyname!='SSH to Prod SFTP Server' | groupby srcip, dstip | duration 1h`,
    `stream=iam where action='PASSWORD_CHANGED' and status='FAILED'| select targetuser, count(status) as attempt_count | checkif targetuser in AdminVIPList.VIPUser | checkif targetuser in AdminVIPList.VIPEmail | groupby targetuser |having attempt_count>=3| duration 30d`,
    `stream=iam where and targetuser= {user} and action='PASSWORD_CHANGED'| duration 7d`,
    `stream=firewall where srctype='PUBLIC' and act='accept' and dstip not in ("198.185.9.52","198.185.9.50") and dstport in (445, 3389, 22, 137, 139, 53, 25, 20, 21, 23, 1433, 1434, 3306) and srcisp not in ('Schreiber Foods, Inc.','Microsoft Corporation') and srcip not like ("198.185.12%") | groupby srcip, dstport, dstip | duration 30m`,
    `stream=threat where devsrcip='Abnormal' and attacktype like("%Phishing%") and isautoremediated='False' and ispostremediated='False' | checkif domain in tcstipdomain.Domain |duration 1h`,
    `stream=iam where and targetuser= {targetuser} and action='PASSWORD_CHANGED'| duration 7d`,
    `stream=iam WHERE action='USER_DELETED' and targetuser={targetuser} and subjectuser={subjectuser} | duration 14d`,
    `stream=authentication where user=(user) and deviceproperties not like ("%{'Name': 'DisplayName'%") | select user, srccn, count(distinct(srccn)) as country_count | having country_count>=2  | groupby user, srccn | duration 30m`,
    `stream=AUTHENTICATION where sourcename='NIX' and authproto='SSH' and logevent like ('%Timeout before authentication%') | duration 30m`,
    `stream=threat where sourcename='FORCEPOINT-DLP' and logevent like ("%act=Permitted%") or logevent like ("%act=Continued%") | duration 6h`,
    `stream=win-audit where sourcename='WINDOWS' and action='POLICY_CHANGED'  and event='An attempt was made to unregister a security event source.' and subjectuser not like ("%$") | groupby subjectuser| duration 1h`,
    `stream=threat or stream=firewall where threattype='Malicious' and direction='outgoing' | groupby srcip|duration 1d |last 10`,
    `stream=iam where eid=4720 and subjectuser not like ('%$') and subjectuser not in ('iiq_ad_admin_prod','iiq_ad_admin_qa','iiq_ad_admin_dev','iiq_ad_admin_test','vro_winrm')  | checkif subjectuser not in AdminVIPList.AdminUser | groupby subjectuser, targetuser| duration 1h`,
    `stream=authentication where sourcename='CITRIX-ADC' and action='COMMAND_EXECUTED' and command like ("login%") and status = 'FAILED' | select srcip, user, count(status) as Fail_count |  groupby srcip, user | duration 5m`,
    `stream=EP-FILE where action='FILE_CREATED' AND TargetFilename='where_my_files.txt' OR  TargetFilename='how_to_recover_data.txt' OR TargetFilename='how_to_decrypt.txt' OR  TargetFilename='contact_here_to_recover_your_files' OR  $TargetFilename LIKE "%decrypt-files%readme%txt%" OR $TargetFilename  LIKE "%decrypt-files%readme_for_decrypt%txt%"OR $TargetFilename LIKE "%decrypt%txt%"  OR $TargetFilename LIKE "%decrypt%html%"`,
    `stream=threat where sourcename='FORCEPOINT-DLP' and @action='PERMITTED'and @severitytype|select threat, user, count(file) as file_count | groupby threat, user, file| having file_count >200 | duration 1d`,
    `stream=authentication where action='LOGIN' and srcip !="-" and status="FAILED" and user!="Not Available" and  reason!="AuthenticationFailedSasError" and user not like ('%$') | select srcip,count(distinct(user)) as usercount, count(action) as action  |groupby srcip| having action>=25 and usercount >=3 | duration 1h`,
    `stream=authentication where sourcename="WINDOWS" AND action="LOGIN" AND status="FAILED" and user not like ('%$') and srcip!='-'  and not rlike(user,"([a-zA-Z0-9]*)_.*") | select user, srcip, count(status) AS FailCount | groupby srcip,user | having FailCount>=50`,
    `stream=threat where sourcename='ABNORMAL SECURITY' and attacktype like ("%Spam%") and action='THREAT_DETECTED' | select sender, count(action) as no_of_emails | groupby sender | having no_of_emails >= 50 | duration 30m`,
    `stream=authentication where action='LOGIN' and status='PASSED' and sourcename='MS-O365' and srcisp!='Schreiber Foods, Inc.' and user!='Not Available' and srccn!='-' and srccn!= '' and  deviceproperties not like ("%{'Name': 'DisplayName'%") | checkif user not in ImpossibleTravel_exc.Users | select user, count(distinct(srccn)) as country_count| having country_count>=2| groupby user| duration 30m`,
    `stream=firewall where srctype="PRIVATE" and dstisp!="Apple Inc." and dstip not like ("192.168.15.%") and srcip not like ("192.168.15.%")| checkif srcip not in Firewall_Devices.Firewall_IP | select srcip, count_if(act='deny') as denied_count  | groupby srcip | having denied_count>=2000 | duration 5m`,
    `stream=iam where action='USER_CREATED' or action='USER_DELETED'  | select user, count(distinct(action)) | groupby user |having action=2| duration 1h`,
    `stream=webfilter where srcip not like ('192.168.15%') and catdesc in ('Abortion', 'Dating', 'Gambling', 'Marijuana', 'Nudity and Risque',  'Other Adult Materials', 'Pornography', 'URL Shortening', 'Games', 'Meaningless Content',  'Child Sexual Abuse', 'Crypto Mining', 'Discrimination', 'Drug Abuse', 'Explicit Violence', 'Extremist Groups',  'Hacking', 'Illegal or Unethical', 'Plagiarism', 'Potentially Unwanted Program', 'Proxy Avoidance', 'Terrorism', 'Dynamic DNS',  'Malicious Websites', 'Newly Observed Domain', 'Newly Registered Domain', 'Phishing', 'Spam URLs', 'Not Rated') and user!='' | select srcip,user, count(proxyaction) as pcount | groupby srcip, user |having pcount>1000  | duration 1h`,
    `stream=iam WHERE subjectuser not like ("%$") and (action='USER_CREATED' OR action='USER_DELETED') | select targetuser, subjectuser, count(distinct(action)) as act | groupby targetuser, subjectuser |having act>=2 | duration 1h`,
    `stream=win-audit where action in ('PROCESS_CREATED', 'OBJECT_ACCESSED') and ((rlike(lower(commandline), '(hkcu|hkey_current_user|hklm|hkey_local_machine).*?software.*?(microsoft.*?windows.*currentversion|wow6432node.*?google.*?chrome.*?extensions)')) or (rlike(lower(scriptblocktext) like '(hkcu|hkey_current_user|hklm|hkey_local_machine).*?software.*?(microsoft.*?windows.*currentversion|wow6432node.*?google.*?chrome.*?extensions)'))) | groupby system, user `,
    `stream=email-gateway where action='EMAIL_DELIVERED' and status='PASSED' and file is not null and srcip is not null and substr(SUBSTR(file,Instr(File,"."),LENGTH(file)), 0,4) IN ('.app','.bin','.exe','.osx','.out','.prg','.run','.ham','.js','.ore','.pex','.plx','.rox','.upx') | select srcip, count(*) as CountUnique | groupby by srcip | having CountUnique>=2`,
    `stream=EP-PROCESS where action='PROCESS_ADDED' and rlike(lower(commandline),'(namedpipes_executor|namedpipes_server|namedpipes_client).*?--(pipe|server|client)' | groupby user, system`,
    `stream=webserver where (rlike(url,"\\%24\\%7B") or rlike(url,"\\%24\\%28") or rlike(url."\\%24\\%7C")) | groupby srcip`,
    `stream=ep-process where action='PROCESS_ADDED' and (rlike(lower(commandline), 'powershell -executionpolicy bypass -command.*-file') or rlike(lower(commandline), 'get-(childitem|item) -path.*(pst|ost|eml|msg|msf|sbd).*export') or rlike(lower(commandline), '(new-mailboxexportrequest|get-mailbox|search-mailbox|new-mailboxsearch)') | groupby user, system`,
    `stream=win-audit where action='PROCESS_CREATED' and rlike(lower(commandline), 'c.*?windows.*?microsoft.net.*?framework64.*?(csc\.exe|csc)' | groupby system, user`,
    `stream=win-audit where action='PROCESS_CREATED' and (rlike(lower(commandline), 'powershell -executionpolicy bypass -command.*-file') or rlike(lower(commandline), 'get-(childitem|item) -path.*(pst|ost|eml|msg|msf|sbd).*export') or rlike(lower(commandline), '(new-mailboxexportrequest|get-mailbox|search-mailbox|new-mailboxsearch)') | groupby user, system`,
    `stream=win-audit where action='PROCESS_CREATED' and (lower(commandline) like '%powershell -ep bypass%wget%import-module%createprocessfromparent%' or lower(commandline) like '%import-module%createprocessfromparent%' or lower(commandline) like '%impersonatefromparentpid -ppid%' or lower(commandline) like '%ppid-spoof%-ppid%') | groupby user, system`,
    `stream=threat where sourcename = "TREND-MICRO-ENDPOINT" |  groupby @cs5 as Action , file , threat , user , devsrcip | duration 1d`,
    `stream=win-audit where action="PROCESS_CREATED" and rlike(lower(newprocessname), ".(bat|cmd|ps1|vbs|js|wsf|py|pl|rb|ahk|reg|sql|sh|lnk|hta|batm|msc|mst|xsl|xml|css|hta|pl|php|java)") | groupby NewProcessName, substring_index(NewProcessName,"\\",-1), user, system | select newprocessname, substring_index(NewProcessName,"\\",-1) as processname, user, system`,
    `stream=webserver where sourcename='ARRAY-OS' sourcetype='LOADBALANCER' | duration 7d | groupby virtualip | limit 100`,
    `stream=* | select system, sourcename, substring(xhour, 0, 8) as date | groupby system, sourcename, substring(xhour, 0, 8) | duration 8d`,
    `stream=ep-process where action='PROCESS_ADDED' and rlike(lower(commandline), 'destination.*?(customshellhost.exe|explorer.exe).*?force' | groupby  user, system`,
    `stream=* | duration 7d | limit -1`,
    `stream=& | groupby srcip`,
    `stream=ep-process where ((image like '%\CamMute.exe' not image like '%\Lenovo\Communication Utility\%') or (image like '%\chrome_frame_helper.exe' not image like '%\Google\Chrome\application\%') or (image like '%\dvcemumanager.exe' not image like '%\Microsoft Device Emulator\%') or (image like '%\Gadget.exe' not image like '%\Windows Media Player\%') or (image like '%\hcc.exe' not image like '%\HTML Help Workshop\%') or (image like '%\hkcmd.exe' not image  ["*\System32\*", "*\SysNative\*", "*\SysWowo64\*"]) OR (image="*\Mc.exe" -image IN ["*\Microsoft Visual Studio*", "*\Microsoft SDK*", "*\Windows Kit*"]) OR (image="*\MsMpEng.exe" -image IN ["*\Microsoft Security Client\*", "*\Windows Defender\*", "*\AntiMalware\*"]) OR (image="*\msseces.exe" -image IN ["*\Microsoft Security Center\*", "*\Microsoft Security Client\*", "*\Microsoft Security Essentials\*"]) OR (image="*\OInfoP11.exe" -image="*\Common Files\Microsoft Shared\*") OR (image="*\OleView.exe" -image IN ["*\Microsoft Visual Studio*", "*\Microsoft SDK*", "*\Windows Kit*", "*\Windows Resource Kit\*"]) OR (image="*\rc.exe" -image IN ["*\Microsoft Visual Studio*", "*\Microsoft SDK*", "*\Windows Kit*", "*\Windows Resource Kit\*", "*\Microsoft.NET\*"]))`,
    `stream=configuration where action='CONFIGURATION_CHANGED' and (lower(commandline) like '%start-athprocessunderspecificparent%' or lower(commandline) like '%start-process%start-athprocessunderspecificparent%') or lower(commandline) like '%get-process -name%start-athprocessunderspecificparent%') | groupby system`,
    `stream=* where sourcename="JUNOS" | duration 7d | select substring(xhour,0, 8) as date | limit -1`,
    `stream=* | duration=15m |  groupby srcip`,
    `stream=threat where sourcename='TIPPINGPOINT' and action='THREAT_BLOCKED' and status='PASSED' and threat like '%Backdoor%' |  duration 1h | groupby threat, srcip, dstip | limi 100`,
    `stream=webfilter where useragent like ('%Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.67 Safari/537.36%') | duration 2h`,
    `stream=authentication where action ='LOGIN' and status='FAILED' |  groupby reason | duration 1w | limit100`,
    `stream=* where sourcename='TIPPINGPOINT' | groupby eventname | duration | limit 100`,
    `stream=win-audit where action='PROCESS_CREATED' and (rlike(lower(commandline), '((get-childitem|get-item).*?(creationtime|astwritetime|astaccesstime))') or rlike(lower(commandline), '(timestomp)' | groupby user, system`,
    `stream=WIN-AUDIT where action='PROCESS_CREATED' and rlike(lower(commandline),'(namedpipes_executor|namedpipes_server|namedpipes_client).*?--(pipe|server|client)' | groupby user, system`,
    `stream=win-audit where action='PROCESS_CREATED' and not rlike(parentprocessname),'(Windows.*?(System32|SysWOW64))' and rlike(lower(commandline), 'copy.*?(cmd.exe|cscript.exe|wscript.exe|powershell.exe|explorer.exe|svchost.exe|lsass.exe|services.exe|winlogon.exe|notepad.exe|taskhostw.exe|lsm.exe)') | groupby user, system | having count_col1 >= 10`,
    `stream=IAM and action="REPORT_CREATED" | duration 1d | limit 10`,
    `stream=auditd and action='PROCESS_ADDED' |duration 1h |groupby system, systemtstamp |  limit 100`,
    `stream=threat where sourcename='FORCEPOINT-DLP' not (@act='Quarantined' or @act='Blocked') AND threat='dlp_block_user_whitelisting (BCM-4396_Shiv.kumar)' AND devsrcip='10.101.76.23' | duration 15m | groupby @act, threat, @suser, file | limit 100 `,
    `stream=authentication AND action='LOGIN' AND status='FAILED' |  limit 10 `,
    `stream=firewall where action='PACKET_BLOCKED' and not left(dstip,3) between 224 and 239 and not dstport in ('514','8081','161','162','8080','5355') and not srcport in ('514','80','8080','8800') and dstip is not null and srcip is not null |group by srcip, dstip |select srcip, dstip, count(*) as countunique |having countunique>30000`,
    `stream=authentication where sourcename='MS-O365' | groupby @ExtendedProperties[0].Value as useragent, @UserId as userid, status | duration 30m`,
    `stream=threat where sourcename='NETSKOPE' and action='THREAT_DETECTED' and not severity IN ("", "unknown") |  groupby upper(severity) | select upper(severity) as Severity, count(*) | duration 1d`,
    `stream=firewall where sourcetype!='NETWORK-OS' and indicatortype in not null and status='PASSED' and categoryoutcome='/Success' and indicator!='None' and action in ('PACKET_ALLOWED','CONNECTION_ESTABLISHED','SESSION_CONNECTED') | groupby indicator, system, deviceaddress | select indicatior, system, deviceaddress, count(*) as countunique | having countunique>=1`,
    `stream=authentication where sourcename='MS-O365' and logevent like "%shell/%" | groupby @ExtendedProperties[0].Value as useragent, @UserId as userid, status`,
    `stream=authentication where sourcename='WINDOWS' and logontype='network' and status='failed' and not rlike(user,"(a-zA-Z)*") and not user='101' and deviceprocessname='advapi' and statussubstat in ('0xC0000064_0xc000006a','0xc000015B', '0xc0000072') | duration 1h | select round(($SystemTstamp/86400000)+25569,3) as NewTimestamp, User,COUNT(*) | groupby newtimestamp, user | having count>=10`,
    `stream=firewall where dstport=53 and not (dstip='8.8.8.8' or dstip='66.198.145.99') | groupby dstip | duration 1`,
    `stream=threat where sourcename = "TREND-MICRO-ENDPOINT" |  groupby @cs5 as Action , file , threat , user , devsrcip | duration 1d`,
    `stream=threat where sourcename='CROWDSTRIKE-FALCON' and threat is not null and not user REGEXP('[a-zA-Z]') | duration 1d | select user, count(*) as CountUnique | groupby user | having CountUnique>100`,
    `stream=email-gateway where sourcename='CISCO-IRONPORT' and srcip is not null and sendergroup in ('SUSPECTLIST','BLACKLIST') and action='EMAIL_DELIVERED' and status='PASSED' and sbrs REGEXP '(?i)(?:^\-+[0-9]|^[0-2]|china)' | select deviceaddress, distinct_count(srcip) as CountUnique | groupby by deviceaddress | having CountUnique>=5`,
    `stream=email-gateway where sourcename='CISCO-IRONPORT' and srcip is not null and sendergroup in ('SUSPECTLIST','BLACKLIST') and action='EMAIL_DELIVERED' and status='PASSED' and sbrs REGEXP '(?i)(?:^\-+[0-9]|^[0-2]|china)' | duration 1h | select srcip, srcdomain,deviceaddress, count(*) as CountUnique | groupby by srcip,srcdomain,deviceaddress | having CountUnique>=10`,
    `stream=firewall where sourcename='ASA' and dsttype='PUBLIC' and srctype='PRIVATE' and action='PACKET_ALLOWED' and categoryoutcome ='/Success' and status='PASSED' and dstport in (1389, 389, 636, 1099) |  duration 30m | groupby srcip, dstip, deviceaddress, system | select srcip, dstip, dstport, count(*) as countunique, distinct_count(srcip) as uniquesources | having uniquesources < 25`,
    `stream=firewall where srctype='PUBLIC' and whitelist is null and not left(dstip,3) between 224 and 239 and dstport not in ('514','8081','161','162','8080','5355') and srcport not in ('514','80','8080','8800') and dstip is not null and srcip is not null and action='PACKET_BLOCKED' | duration 30m | select srcip, dstip | groupby srcip, dstip, distinct_count(srcip) as distinctsrcip, COUNT(*) as countunique | having distinctsrcip>1 and countunique>20000`,
    `stream=firewall where sourcename='ASA' and eventid='106017' and status='FAILED' |  duration 30m |  select srcip, dstip, deviceaddress, system, count(*) as cnt |  groupby srcip, dstip, deviceaddress, system having cnt > 100`,
    `stream=iam where sourcename='SITEMINDER' and eventname in ('AuthAccept','ValidateAccept') and threattype is not null and indicatortype is null | select srcip, threattype, count(*), distinct_count(srcip) as CountUnique | groupby srcip, theattype | having CountUnique>=1`,
    `stream=authentication where threattype is not null and indicatortype is null and eventname not in ('Connection closed','Received disconnect','Did not receive identification string','Failed password','Identification not received') | select srcip, threattype, count(*), distinct_count(srcip) as CountUnique | groupby srcip, theattype | having CountUnique>=1`,
    `stream=iam where sourcename='SITEMINDER' and reason='UserDisabled' and not eventname='AuthReject' and smstatus not like '%authcode%' and smstatus like '%User%' and not user REGEXP ('[a-zA-Z]') and user not in ('None','-','weblogic') | select round((substr(cnamtime,1,(length(cnamtime)))/86400000)+25569,3) as NewTimestamp, eventname, smstatus, user, realm, count(*) as cnt | groupby NewTimestamp, eventname, smstatus, user, realm | having cnt>=1`,
    `stream=iam where sourcename='SITEMINDER' and not reason='-' and eventname='AzReject' and not user REGEXP ('[a-zA-Z]') and user not in ('None','-') | duration 1h | select round((SUBSTR(cnamtime,1,(length(cnamtime)))/86400000)+25569,3) as NewTimestamp, user, realm, devsrcip, count(*) as cnt | groupby  NewTimestamp, user, devsrcip, realm | having cnt>100`,
    `stream=iam where sourcename='SITEMINDER' and eventname='AuthReject' and smstatus like '%error%' and reason='ExcessiveFailedLoginAttempts' and not user REGEXP ('[a-zA-Z]') and user!='None' and not reason='-' | duration 15m | select round((SUBSTR(cnamtime,1,(length(cnamtime)))/86400000)+25569,3) as NewTimestamp, user, smdomain, realm, count(*) as cnt | groupby NewTimestamp, user, smdomain, realm | having cnt>=10`,
    `stream=threat where sourcename='ASM' and returncode in ('0','200') and threat!='N/A' and action='THREAT_DETECTED' and threat not in ('Cross Site Scripting (XSS)','Path Traversal','SQL-Injection') and url not in ('/*','/') and not (lower(url) REGEXP ('(.png|.json|.jsp|.jsf|.png|.jpg|.bmp|.js|.gif|.css|.svg|.html)(?![a-zA-z\-\/\.\_\?\&\|])')) | duration 1h | select srcip, count(threat) as CntThreat, url, count(*) as CountUnique | groupby srcip, url | having CntThreat>=1 `,
    `stream=threat where sourcename='ASM' and action='THREAT_DETECTED' and returncode in ('0','200') and (lower(url) like lower('%SELECT%') or lower(url) like lower('%INSERT%') or lower(url) like lower('LIKE%UNION%') or lower(url) like lower('%CONVERT%') or lower(url) like lower('%CONCAT%') or lower(url) like lower('%TRUNCATE%') or lower(url) like lower('%DELETE%') or lower(url) like lower('%EVAL%') or lower(url) like lower('%UPDATE%') or lower(url) like lower('%SLEEP%')) and not user in ('-','None','101') and not (lower(url) REGEXP ('(?i)(?:update|select|delete|eval|insert|convert|concat|sleep|union)(?=[0-9a-zA-z\-\/\.\_\?])')) and not (lower(url) REGEXP ('(.pnLIKEg|.json|.jsp|.jsf|.png|.jpg|.bmp|.js|.gif|.css|.svg|.html)(?![a-zA-z\-\/\.\_\?\&\|])')) and not (lower(url) like '%update' or lower(url) like '%select' or lower(url) like '%insert' or lower(url) like '%delete') | duration 1h | select  srcip, count(*) as CountUnique | groupby srcip, url | having CountUnique>=1`,
    `stream=webfilter where action='URL_ALLOWED' and not method='NA' and dsthost is not null and user is not null and not (category like '%gINCHNSIR-Talk-Test-Allow%' or category like 'CR_7645343%' or category like 'CR9539464%' or category like 'CR_7737302%' or category like 'CR7939602%' or category like '%Operating%System%and%Software%Updates%' or category like 'VPN_URLs' or category like '%INPUNSAP_Telstra_Urls%' or category like '%gINBLRGLAH-BMO_Allow%' or category like '%CR9894769_URLs%' or category like '%Fresco_Videos_Whitelisting%' or category like 'None_Not_Notify%' or category like 'Crowdstrike_URLs%' or category like '%Exemption%URLs%' or category like 'Citrix_Allow%' or category like 'CR7504540_4374303_allow%' or category like '%Windows_Microsoft_URLs%' or category like '%SCCM-URL%' or category like 'TCS%' or category like '%Intune_Urls%') or contentcategory='CR%') and not user regexp('[a-zA-Z]') and not (user like '%tcscom%' or user like '%r.manage.microsoft.com:443%' or user like '%accesoremoto.bancolombia.com:443%') and not (dsthost like '%tcs%' or dsthost like '%ultimatix%') and not (user like 'noauth-bypassurl$@4897005.zscalerthree.net' or user like 'noauth-protocol$@4897005.zscalerthree.net' or user like 'noauth-useragent$@4897005.zscalerthree.net' or user like 'noauth-misc$@4897005.zscalerthree.net' or user like 'noauth-unknownkrbuser$@4897005.zscalerthree.net') and (srctype='PRIVATE' or whitelist is not null) and not dstip='2.20.92.6' | duration 1h | select substr(user,1,(length(user)-instr(user, "@")-1)) as user,dsthost,count(*) as countunique | groupby user, dsthost | having countunique >= 500`,
    `stream=webserver where returncode like '2%' and (srctype='PRIVATE' and dsttype='PRIVATE') and ((useragent like '%\%3Cscript\%3E%' or useragent like '%\%3C\%2Fscript\%3E%' or useragent like '%<%>%' or useragent like '%</%>%') or (url like '%\%3D\%3B%' or url like '%\%3D\%27%' or url like '%\%3D\%00%' or url like '%\%3D^\n%' or url like '%\%3Cscript\%3E%' or url like '%\%3C\%2Fscript\%3E%' or url like '%<%>%' or url like '%</%>%') or (httpreferer like '%\%3D\%3B%' or httpreferer like '%\%3D\%27%' or httpreferer like '%\%3D\%00%' or httpreferer like '%\%3D^\n%' or httpreferer like '%\%3Cscript\%3E%' or httpreferer like '%\%3C\%2Fscript\%3E%' or httpreferer like '%<%>%' or httpreferer like '%</%>%')) and not (lower(url) regexp ('(.png|.json|.jsf|.png|.jpg|.bmp|.js|.gif|.css|.svg|.html)(?![a-zA-z\-\/\.\_\?\&\|])')) and not (lower(httpreferer) regexp ('(.png|.json|.jsf|.png|.jpg|.bmp|.js|.gif|.css|.svg|.html)(?![a-zA-z\-\/\.\_\?\&\|])')) | duration 1h | select srcip, count(*) as countunique | groupby srcip | having countunique>=10`,
    `stream=webserver where returncode like '2%' and (srctype='PUBLIC' and dsttype='PRIVATE') and (( httpreferer like '%../%' or httpreferer like '%..\%2f%' or httpreferer like '%\%2e\%2e\%2f%' or httpreferer like '%\%25\%2e\%25\%2e\%25\%5c%') or ( url like '%../%' or url like '%..\%2f%' or url like '%\%2e\%2e\%2f%' or url like '%\%25\%2e\%25\%2e\%25\%5c%')) and not (lower(url) regexp('(.png|.json|.jsf|.png|.jpg|.bmp|.js|.gif|.css|.svg|.html)(?![a-zA-z\-\/\.\_\?\&\|])')) and not (lower(httpreferer) regexp('(.png|.json|.jsf|.png|.jpg|.bmp|.js|.gif|.css|.svg|.html)(?![a-zA-z\-\/\.\_\?\&\|])')) | duration 1h | select srcip, count(*) as countunique | groupby srcip | having countunique>=20`,
    `stream=webserver where returncode='2%' and srctype='PRIVATE' and dsttype='PRIVATE' and url like '%shell%' and not (url like '%/shell/%' or url like '%/shellError.js%' or url like '%shell_%') | duratrion 1h | select srcip, count(*) as countunique | groupby srcip | having countunique>=5`,
    `stream=webserver where (lower(url) like lower('%SELECT%') or lower(url) like lower('%INSERT%') or lower(url) like lower('%UNION%') or lower(url) like lower('%CONVERT%') OR lower(url) like lower('%CONCAT%') or lower(url) like lower('%TRUNCATE%') OR lower(url) like lower('%DELETE%') or lower(url) like lower('%EVAL%') or lower(url) like lower('%UPDATE%') or lower(url) like lower('%SLEEP%')) and not $User IN ('-','None','101') and not (lower(url) REGEXP ('(?i)(?:update|select|delete|eval|insert|convert|concat|sleep|union)(?=[0-9a-zA-z\-\/\.\_\?])')) and not (lower(url) REGEXP ('(.png|.json|.jsp|.jsf|.png|.jpg|.bmp|.js|.gif|.css|.svg|.html|.ico)(?![a-zA-z\-\/\.\_\?\&\|])')) and not (lower(url) like '%update' or lower(url) like '%select' or lower(url) like '%insert' or lower(url) like '%delete') and url not like '%searchapi%rest%fetch%' and url not like '%api%search%' and srctype='PUBLIC' and whitelist is null | select srcip, count(*) as CountUnique | groupby srcip | having CountUnique>=1`,
    `stream=webserver | where returncode like '2%' and (srctype='PUBLIC' and dsttype='PRIVATE') and ((useragent like '%\%3Cscript\%3E%' or useragent like '%\%3C\%2Fscript\%3E%' or useragent like '%<%>%' or useragent like '%</%>%') or (url like '%\%3D\%3B%' or url like '%\%3D\%27%' or url like '%\%3D\%00%' or url like '%\%3D^\n%' or url like '%\%3Cscript\%3E%' or url like '%\%3C\%2Fscript\%3E%' or url like '%<%>%' or url like '%</%>%') or (httpreferer like '%\%3D\%3B%' or httpreferer like '%\%3D\%27%' or httpreferer like '%\%3D\%00%' or httpreferer like '%\%3D^\n%' or httpreferer like '%\%3Cscript\%3E%' or httpreferer like '%\%3C\%2Fscript\%3E%' or httpreferer like '%<%>%' or httpreferer like '%</%>%')) | duration 1h | select srcip, count(*) as countunique | groupby srcip | having countunique>=1`,
    `stream=threat where sourcename='windows' and eventid in ('4618', '4649', '4618') and categoryoutcome ='/Failure' | duration 1h | select system, srcip, threat, count(*) as CountUnique | groupby system, srcip, threat | having threat countunique>=1`,
    `stream=webserver where (lower(useragent) like lower('%SELECT%') or lower(useragent) like lower('%INSERT%') or lower(useragent) like lower('%UNION%') or lower(useragent) like lower('%CONVERT%') or lower(useragent) like lower('%CONCAT%') or lower(useragent) like lower('%TRUNCATE%') or lower(useragent) like lower('%DELETE%') or lower(useragent) like lower('%EVAL%') or lower(useragent) like lower('%UPDATE%') or lower(useragent) like lower('%SLEEP%')) and not user in ('-','None','101') and not (lower(useragent) REGEXP ('(?i)(?:update|select|delete|eval|insert|convert|concat|sleep|union)(?=[0-9a-zA-z\-\/\.\_\?])')) and not (lower(useragent) REGEXP ('(.png|.json|.jsp|.jsf|.png|.jpg|.bmp|.js|.gif|.css|.svg|.html)(?![a-zA-z\-\/\.\_\?\&\|])')) and not (lower(useragent) like '%update' or lower($UserAgent) like '%select' or lower(useragent) like '%insert' or lower(useragent) like '%delete') and srctype='PUBLIC' and whitelist is null | select srcip, useragent, count(*) as CountUnique | groupby srcip, useragent | having CountUnique>=1`,
    `stream=webserver | where (srctype='PRIVATE' and dsttype='PRIVATE') and action='REQUEST_ALLOWED' and httpreferer not in ('-', '""-""', 'None') and srcip not in ('::1', '-') and user not in ( 'None', '-', '0#.w|ultimatix\\sakmsp_srchdca') and not httpreferer like '%www.ultimatix.net/uxportal/uxportalhome.html%' | duration=15m | select SUBSTR(httpreferer,1,(length(httpreferer)-length(SUBSTRING_INDEX(httpreferer, "/", -1)))) AS HTTPReferer, count(*) as countunique, distinct_count(srcip) as distinctsrcip, distinct_count(user) as distinctuser | groupby HTTPReferer | having (distinctsrcip==1 and distinctuser==1 and countunique>4000) or (distinctsrcip>1 and distinctuser>=1 and countunique>45000)`,
    `stream=sysmon-process where image like '%schtasks.exe' and commandline like '%/create%/s%' |select distinct_count(system) as dstsystem, commandline, user |  groupby user, commandline, | duration 1h | having dstsystem > 3`,
    `stream=* where sourcetype="IPS" and devsrcip in ('10.202.4.20', '10.203.4.20') | duration 1d | groupby devsrcip, sourcename. sourcetype`,
    `stream=system where NOT (SrcIP='0.0.0.0' or SrcIP like '203.199.247%') and LogType='DDOS' AND (ActionTaken='forward' or ActionTaken='proxy' or ActionTaken='bypass') and Category='Anomalies' | duration=1h | groupby SrcIP | limit 100`,
    `stream=signals where suspecthost!='' and not detectionname like '%TEST' | select suspecthost , count_if (detectionname like 'MALICIOUS IP%') as Mal_IP_Count, count_if (detectionname not like 'MALICIOUS IP%') as Other_Alert_Count  | groupby suspecthost | having Mal_IP_Count>0 and Other_Alert_Count>0 | duration 1d`,
    `stream=EP-FILE where action="FILE_CREATED" and rlike(lower(targetfilename),"\\.(bat|cmd|ps1|vbs|js|wsf|py|pl|rb|ahk|reg|sql|sh|lnk|hta|batm|msc|mst|xsl|xml|css|hta|pl|php|java)") | groupby substring_index(targetfilename,"\\",-1), targetfilename, user, system | select substring_index(targetfilename,"\\",-1) as file, targetfilename, user, system `,
    `stream=sysmon-process where action='PROCESS_ADDED' and eid='1' and parentimage like '%powershell.exe' commandline like ('%schtasks%Create%SC %ONLOGON%TN %Updater%TR %powershell%' or commandline like '%schtasks%Create%SC %DAILY%TN %Updater%TR %powershell%' or commandline like  '%schtasks%Create%SC %ONIDLE%TN %Updater%TR %powershell%' or commandline like  '%schtasks%Create%SC %Updater%TN %Updater%TR %powershell%') | duration 1h |  select system, parentimage, commandline |  groupby system, parentimage, commandline |  limit 100`,
    `Stream=IAM and action='FILE_DELETED' and status='PASSED' SubSystem='ADMINISTRATION' | groupby action, message, devsrcip |  duration 24h | limit 100`,
    `Stream=IAM and sourcetype='FIREWALL' and action='SCHEDULE_TASK_UPDATED' | groupby message, system | duration 24h | limit 10`,
    `stream=firewall and action="PACKET_ALLOWED" and sourcetype="FIREWALL" and not srcip like "10.%" | groupby sourcename, srcip`,
    `stream=EP-FILE where action="FILE_CREATED" and rlike(lower(targetfilename),"\\.(bat|cmd|ps1|vbs|js|wsf|py|pl|rb|ahk|reg|sql|sh|lnk|hta|batm|msc|mst|xsl|xml|css|hta|pl|php|java)") | groupby substring_index(targetfilename,"\\",-1), targetfilename, user, system | select substring_index(targetfilename,"\\",-1) as file, targetfilename, user, system `,
    `stream=win-audit where action="PROCESS_CREATED" and rlike(lower(newprocessname), ".(bat|cmd|ps1|vbs|js|wsf|py|pl|rb|ahk|reg|sql|sh|lnk|hta|batm|msc|mst|xsl|xml|css|hta|pl|php|java)") | groupby NewProcessName, substring_index(NewProcessName,"\\",-1), user, system | select newprocessname, substring_index(NewProcessName,"\\",-1) as processname, user, system`,
    `stream=webserver where returncode like '2%' and (srctype='PUBLIC' and dsttype='PRIVATE') and ((useragent like '%\%3Cscript\%3E%' or useragent like '%\%3C\%2Fscript\%3E%' or useragent like '%<%>%' or useragent like '%</%>%') or (url like '%\%3D\%3B%' or url like '%\%3D\%27%' or url like '%\%3D\%00%' or url like '%\%3D^\n%' or url like '%\%3Cscript\%3E%' or url like '%\%3C\%2Fscript\%3E%' or url like '%<%>%' or url like '%</%>%') or (httpreferer like '%\%3D\%3B%' or httpreferer like '%\%3D\%27%' or httpreferer like '%\%3D\%00%' or httpreferer like '%\%3D^\n%' or httpreferer like '%\%3Cscript\%3E%' or httpreferer like '%\%3C\%2Fscript\%3E%' or httpreferer like '%<%>%' or httpreferer like '%</%>%')) and not (lower(url) regexp ('(.png|.json|.jsf|.png|.jpg|.bmp|.js|.gif|.css|.svg|.html|.ico)(?![a-zA-z\-\/\.\_\?\&\|])')) and not (lower(httpreferer) regexp ('(.png|.json|.jsf|.png|.jpg|.bmp|.js|.gif|.css|.svg|.html|.ico)(?![a-zA-z\-\/\.\_\?\&\|])')) and user not in ('2189437','2140634','2187348','2199485','2063932','2228287','2188693','2236052')  | select srcip, count(*) as countunique | groupby srcip | having countunique>=1`,
    `stream=* where sourcename="WINDOWS" | duration = 7d | groupby sourcename, eid `,
    `stream=cloudtrail where sourcename='AWS-CLOUDTRAIL' and sourcetype='CLOUD' nd eventsource='iam.amazonaws.com' and eventname='UpdateLoginProfile' | duration 1h | groupby userarn, @requestParameters.userName as username | having count_col1 >=1`,
    `stream=* | duration 1d | select substring(xhour,0, 8) as date, sum(evtlen) | groupby substring(xhour,0, 8)`,
    `stream=authentication where sourcename='MS-O365' | groupby @ExtendedProperties[0].Value as useragent, @UserId as userid, status`,
    `stream=win-audit where action='PROCESS_CREATED' and (lower(commandline) like '%start-athprocessunderspecificparent%' or lower(commandline) like '%start-process%start-athprocessunderspecificparent%') or lower(commandline) like '%get-process -name%start-athprocessunderspecificparent%') | groupby user, system`,
    `stream=firewall | select dstip, (cast(sum(case when dstport=='23' then 1 else 0 end) as float)/cast(count(*) as float))*100 as percentagecount, (cast(sum(case when dstport=='23' then 1 else 0 end) as float)/cast(count(*) as float)) as ratiocount | duration 1h | groupby dstip | having percentagecount>0 and ratiocount>0 `,
    `stream=firewall | where action!='PACKET_ALLOWED' and action!='PACKET_BLOCKED' | duration 1m |  groupby action, devsrcip | limit 10`,
    `stream=threat where sourcetype="FIREWALL" and vector="WEB" and urlcategorylist in ("phishing","malware") and not act="block-url" | groupby user | duration 1h`,
    `stream=gsuite where sourcename='G-SUITE' and app='rules' | duration 1h | groupby user | having count_col1>=`,
    `stream=cloudtrail where sourcename='AWS-CLOUDTRAIL' and sourcetype='CLOUD' and eventname=('CreateRoute', 'CreateRouteTable', 'ReplaceRoute', 'ReplaceRouteTableAssociation', 'DeleteRouteTable', 'DeleteRoute', 'DisassociateRouteTable') | duration 1h |  groupby @recipientAccountId, srcip | having count_col1>=1`,
    `stream=cloudtrail where sourcename='AWS-CLOUDTRAIL' and sourcetype='CLOUD' and ((eventname='ModifySnapshotAttribute' and @requestParameters.attributeType='CREATE_VOLUME_PERMISSION' and @requestParameters.createVolumePermission.add.items.group='all') or (eventname='ModifyDBClusterSnapshotAttribute' and @requestParameters.valuesToAdd='all')) | duration 1h |  groupby srcip | having count_col1>=`,
    `stream=zendesk where @source_type='user_setting' and actiontaken=('create', 'update') and change_description='suspended' | duration 1h | groupby user | having count_col1>=1`,
    `stream=sysmon-process where action='PROCESS_ADDED' rlike(image,'dwm.exe|explorer.exe|winlogon.exe|csrss.exe|PresentationHost.exe|dllhost.exe|ppldump.exe') and (commandline like '%.py' or commandline like '%.bat' or commandline like '%.cmd' or commandline like '%.ps1' or commandline like '%.pl' or commandline like '%.rb' or commandline like '%.java' or commandline like '%.jar' or commandline like '%.cpp' or commandline like '%.dll') |  groupby user, system`,
    `stream=calendar where sourcename='G-SUITE' and @name='CHANGE_CALENDAR_SETTING' and @parameters.SETTING_NAME='SHARING_OUTSIDE_DOMAIN' and value in ('READ_WRITE_ACCESS', 'READ_ONLY_ACCESS', 'MANAGE_ACCESS')  | duration 1h | groupby user | having count_col1>=`,
    `stream=cloudtrail where eventname IN ("ArchiveFindings", "CreateFindingsFilter", "DeleteMember", "DisassociateFromMasterAccount", "DisassociateMember", "DisableMacie", "DisableOrganizationAdminAccount", "UpdateFindingsFilter", "UpdateMacieSession", "UpdateMemberSession", "UpdateClassificationJob") | select userarn, user, count(*) as count_col | groupby user | having count_col1> 5 | duration 1h`,
    `stream=webfilter where sourcename='CLOUDFLARE' and action='URL_BLOCKED' and status='PASSED' and rlike (requesturl,'\b((?:user\/|users\/|userId\=|savingsuser\/)[0-9]+)\b')i | duration 15m | groupby srcip | having count_col1 >=150`,
    `stream=okta where @eventType='application.user_membership.show_password' | select @target[0].type[0] as targetuser, @target[1].type[1] as targetappname , actor.type as actortype, user | groupby targetuser, targetappname, actortype, user| duration 1h `,
    `stream=webfilter where sourcename='CLOUDFLARE' and action='URL_BLOCKED' and status='PASSED' and rlike (ClientRequestURI,'\b((?:user\/|users\/|userId\=|savingsuser\/)[0-9]+)\b')i | duration 15m | groupby srcip | having count_col1 >=150`,
    `stream=threat where sourcename='TIPPINGPOINT' and action='THREAT_DETECTED' and dstport in ('9001', '9030', '9031', '9051', '9050', '9150', '9151') and @actiontken='permit' |  duration 1h | limit 30 | group by dstport`,
    `stream=threat where sourcename='TIPPINGPOINT' and action='THREAT_BLOCKED' and status='PASSED' and threat like '%DoS%' |  duration 1h | groupby threat, srcip, dstip | limi 100`,
    `stream=threat where sourcename='TIPPINGPOINT' and action='THREAT_BLOCKED' and status='PASSED' |  duration 30m | groupby srcip, dstip, threat | having count_col1 3`,
    `stream=authentication where sourcename='GITHUB' and action='LOGIN' | duration 15m | select user, system, count_if(status='FAILED') as failcount, count_if(status='PASSED') as passcount | groupby user | having failcount >= 50 and failcount >= passcount * 5 | limit 100`,
    `stream=Fortiweb where sourcename='FORTIWEB' and @cat='Signature Detection' | duration 1d | select srcip, dstip, @dhost, @cs6 as Signature ID, threat, @requestMethod, @request, logevent | select srcip as attacker, @dhost as TargetHost, dstip as TargetIP, threat, count(logevent) as AttackCount | groupby srcip, @dhost, dstip, threat`,
    `stream=configuration where Sourcename="WINDOWS" and @Channel= "System" |  duration 1w | select Object as Service_Name, @Hostname as Host, Config as Service_details, DevSrcIP as Source_IP, @SourceName as Application, @EventTime as Date&Time`,
    `stream=* where devsrcip='192.169.0.227' | duration 7d |  select cnamtime, devsrcip, logevent, @Message , @CmdName , @user| select cnamtime, @Message as Events, @CmdName as status, @user`,
    `stream=Authentication where sourcename='NIX' and action='LOGIN' and authproto='SSH' | duration 15min | select srcip, system, count_if(status='FAILED') as failcount, count_if(status='PASSED') as passcount | groupby srcip, system | having failcount >= 10 and passcount >=1`,
    `stream=firewall where service='P2P' and status='PASSED' | groupby cnamtime, srcip, dstip, service, act, actiontaken | duration 30`,
    `stream=firewall where sourcetype="FIREWALL" and srctype="PUBLIC" and not (srcip='157.227.4.3' or dstport="80" or dstport="8080" or dstport="443") |  select srcip, dstport, distinct_count(dstip) as dstipcnt, count_if(action=="PACKET_ALLOWED" or action=="ACCEPT" or action=="ALLOW") as actioncnt |  groupby srcip, dstport | having dstipcnt > 300 and actioncnt > 1`,
    `stream=firewall where sourcetype="FIREWALL" and srctype="PUBLIC" and not srcip='180.151.253.114' and not srcip='61.246.171.222' |  select srcip, srccn, dstip, distinct_count(dstport) as cntdstport, count_if(action=="PACKET_ALLOWED" or action=="ACCEPT" or action=="ALLOW") as actioncnt |  groupby srcip, srccn, dstip |  having cntdstport>500 and actioncnt > 1`,
    `stream=iam where sourcename="WINDOWS" and action in ("USER_DISABLED","USER_ENABLED") and not targetuser like "%$" | groupby user, targetuser | select user, targetuser, distinct_count(action) as ActCnt | duration 15m | having ActCnt > 1`,
    `stream=THREAT where SourceName='MS-O365' and not @LatestDeliveryLocation='Quarantine' |  duration 15m  | select sender,distinct_count(recipient) as recipient_count |  groupby sender |  having recipient_count>10 `,
    `stream=TREND-MICRO-ENDPOINT where sourcetype='ENDPOINT-SECURITY' and sourcename='TREND-MICRO-ENDPOINT' and threat='Intrusion Prevention' and not dstip like ('192.168.40.%') |  groupby actiontaken,threat,virusname,dstip,@TMCMLogDetectedHost `,
    `stream=CONFIGURATION where config='Object attribute configured' and actiontaken='Add' and message like ('Add user.local%') AND sourcetype='FIREWALL' AND system in ('UNIFIFW-PRI', 'Unifi-Mumbai', 'UNIFI_HYDRABAD', 'UNIFI-BANGALORE')  | groupby cnamtime,system,action,user,actiontaken,config,message`,
    `stream=WIN-AUDIT where sourcename='WINDOWS' and system='UNIFI-Backup.Unifi.com'  and category='Removable Storage'  and not user like ('%$%')  and not category in ('File System', 'Other Object Access Events', 'File Share', 'Detailed File Share', 'Handle Manipulation', 'Sensitive Privilege Use') | duration 30d | groupby cnamtime,action,category,event,eid,user`,
    `stream=WIN-AUDIT where sourcename='WINDOWS' and system='UNIFI-Backup.Unifi.com' and not user like ('%$%')  and category in ('File System', 'File Share') and eid in ('4659', '4660', '5143') and user like '%dministrator' |  duration 30d |  groupby cnamtime,action,category,event,eid,user  `,
    `stream=crowdstrike where rawaction="ProcessRollup2V19" and rlike(logevent, 'ImageFileName.*?WMIC.exe' | groupby agentid, logevent`,
    `stream=aws-cloudtrail | where eventname='RunInstances'`,
    `stream=aws-cloudtrail | where eventsource='ec2.amazonaws.com' | groupby eventname | limit 100`,
    `stream=crowdstrike where rawaction="ProcessRollup2V19" and rlike(logevent, 'ImageFileName.*?WMIC.exe' | groupby agentid, logevent`,
    `stream=crowdstrike  where rawaction='ProcessRollup2V19'  and (     (rlike(logevent, 'ImageFileName.*?WMIC.exe')      and (         rlike(logevent, 'CommandLine.*?get')          or rlike(logevent, 'CommandLine.*?list')          or rlike(logevent, 'CommandLine.*?process call create')          or rlike(logevent, 'CommandLine.*?cmd.exe')          or rlike(logevent, 'CommandLine.*?powershell.exe')          or rlike(logevent, 'CommandLine.*?command.exe')     ) )  | groupby agentid, logevent`,
    `stream=CDN-HTTP | where @ClientRequestPath='/plaidv2' |  groupby srcip | duration 24h`,
    `stream=aws-rds where rawaction='FAILED_CONNECT' and user != '' | select user, srcip, system, count_if(rawaction='FAILED_CONNECT') as FailCount|  groupby user, srcip, system | having FailCount >=10 |`,
    `stream=CROWDSTRIKE where rawaction='FileRenameInfoV2' and get_json_object(logevent, '$.SourceFileName') like '%rundll32.exe' or '%cmd.exe' or '%mshta.exe' or '%certutil.exe'| duration 15m`,
    `stream=crowdstrike  where rawaction='ProcessRollup2V19'  and (     (rlike(logevent,ParentBaseFileName.*?svchost.exe) and rlike(logevent,ImageFileName.*?cmd.exe))     or (rlike(logevent,ParentBaseFileName.*?explorer.exe) and rlike(logevent,ImageFileName.*?powershell.exe))     or (rlike(logevent,ParentBaseFileName.*?winword.exe) and (rlike(logevent,ImageFileName.*?cmd.exe) or rlike(logevent,ImageFileName.*?powershell.exe)))     or (rlike(logevent,ParentBaseFileName.*?excel.exe) and (rlike(logevent,ImageFileName.*?cmd.exe) or rlike(logevent,ImageFileName.*?powershell.exe)))     or (rlike(logevent,ParentBaseFileName.*?outlook.exe) and (rlike(logevent,ImageFileName.*?cmd.exe) or rlike(logevent,ImageFileName.*?powershell.exe))) )`,
    `stream=aws-cloudtrail | where eventname='RunInstances' and recipientaccountid="948821884325" and rlike(logevent, 'i-0cc0a01f686099b78')  | duration 12h`,
    `stream=Nextdlp | where LogType='AUDIT' AND RawAction="OperatorLogin" AND Role="['Limited Administrator']" | duration 14d`,
    `stream=CROWDSTRIKE | where @DomainName='epicunitscan.info' |  duration 24h`,
    `stream=CDN-HTTP | where SrcISP='M247 Ltd' and UserAgent like 'okhttp%' | groupby @RequestHeaders.deviceid,@ClientRequestPath |  duration 24h`,
    `stream=CDN-HTTP | where @RequestHeaders like '%Proxy-Authorization%' |  duration 24h`,
    `stream=CDN-HTTP | where SrcISP='M247 Ltd' and UserAgent like 'okhttp%' | groupby @ClientRequestPath |  duration 24h`,
    `stream=SLACK where RawAction='ekm_logging_config_set' | groupby user | groupby user`,
    `stream=firewall where sourcetype="FIREWALL" and srctype="PUBLIC" and not (dstport="80" or dstport="443" or dstport="8080" or act="deny") |  select srcip, dstip, distinct_count(dstport) as cntdstport, count_if(action=="PACKET_ALLOWED" or action=="ACCEPT" or action=="ALLOW") as actioncnt |  groupby srcip, dstip |  having cntdstport>500 and actioncnt > 0`,
    `stream=iam where where sourcename="WINDOWS" and eid="4740" | duration 1h | select targetdomain, system, distinct_count(targetuser) as cntuser, count(*) as cntevent | groupby targetdomain, system | having cntevent>15`,
    `stream=EP-PROCESS where (image like "%net%exe%" or image like "%net1%exe%") and (commandline like "%group%" or commandline like "%localgroup%" or commandline like "%user%" or commandline like "%view%" or commandline like "%share" or commandline like "%accounts%" or commandline like "%use%" or commandline like "%stop %") stream=EP-PROCESS where (image like "%net%exe%" or image like "%net1%exe%") and (commandline like "%group%" or commandline like "%localgroup%" or commandline like "%user%" or commandline like "%view%" or commandline like "%share" or commandline like "%accounts%" or commandline like "%use%" or commandline like "%stop %") and not user like "%NT AUTHORITY%" | groupby system, user`,
    `stream=iam where sourcename="WINDOWS" and action in ("USER_DISABLED","USER_ENABLED") and not targetuser like "%$" | groupby user, targetuser | select user, targetuser, distinct_count(action) as ActCnt | duration 15m | having ActCnt > 1`,
    `stream=firewall where sourcetype="FIREWALL" and srctype="PUBLIC" and not (dstport="80" or dstport="8080" or dstport="443" or dstport="8080") |  select srcip, dstip, distinct_count(dstport) as cntdstport, count_if(action=="PACKET_ALLOWED" or action=="ACCEPT" or action=="ALLOW") as actioncnt |  groupby srcip, dstip |  having cntdstport>500 and actioncnt > 0`,
    `stream=firewall where sourcetype="FIREWALL" and srctype="PUBLIC" and not (dstport="80" or dstport="8080" or dstport="443") |  select srcip, dstport, distinct_count(dstip) as dstipcnt, count_if(action=="PACKET_ALLOWED" or action=="ACCEPT" or action=="ALLOW") as actioncnt |  groupby srcip, dstport | having dstipcnt > 300 and actioncnt > 1`,
    `stream=firewall where sourcetype="FIREWALL" and srctype="PUBLIC" and not (dstport="80" or dstport="8080" or dstport="443") |  duration 3m |  select srcip, dstport, distinct_count(dstip) as dstipcnt, count_if(action=="PACKET_ALLOWED" or action=="ACCEPT" or action=="ALLOW") as actioncnt |  groupby srcip, dstport | having dstipcnt>300 and actioncnt > 0`,
    `stream=firewall where sourcetype="FIREWALL" and srctype="PUBLIC" and not (dstport="80" or dstport="8080" or dstport="443") |  select srcip, dstport, distinct_count(dstip) as dstipcnt, count_if(action=="PACKET_ALLOWED" or action=="ACCEPT" or action=="ALLOW") as actioncnt |  groupby srcip, dstport | having dstipcnt > 300 and actioncnt > 1`,
    `stream=firewall where sourcetype="FIREWALL" and srctype="PUBLIC" and not (dstport="80" or dstport="8080" or dstport="443" or dstport="8080") |  select srcip, dstip, distinct_count(dstport) as cntdstport, count_if(action=="PACKET_ALLOWED" or action=="ACCEPT" or action=="ALLOW") as actioncnt |  groupby srcip, dstip |  having cntdstport>500 and actioncnt > 0`,
    `stream=system where sourcename='FORTIGATE' and description='Interface status changed' and not message like ('%Erkunt_Turket%') |  groupby devsrcip, system, message, status, cnamtime, logevent`,
    `stream=authentication where sourcename='WINDOWS' and action='LOGIN' | select user,srcip,system as DomainController,devsrcip as DomainControllerIP, targetdomain, count_if(eid='4624' or (eid='4768' and statustaken='0x0')) as LoginSuccessful, count_if((eid='4625') or (eid='4776') or (eid='4771') or (eid='4768') or (eid='4769')) as LoginFailure, count_if(statustaken='0xc000006d') as WrongCredentials, count_if(statustaken='0xc0000234') as AccountLockedForMultipleFailedAttempts, count_if(statustaken='0xc000006a') as WrongPassword, count_if(statustaken='0xc0000064') as UserDoesntExist, count_if(statustaken='0x18') as KerberosAuthFailed | groupby user,srcip,system,devsrcip,targetdomain | duration 1h | having LoginFailure>4 and LoginSuccessful>0 and (WrongCredentials>0 or AccountLockedForMultipleFailedAttempts>0 or UserDoesntExist>0 or KerberosAuthFailed>0)`,
    `stream=OTHER where sourcename='PALOALTO' @event='"high-cpu-utilization"' or @event='"high-memory-utilization"' or @event='"high-session-count"' | groupby devsrcip, @event, @description, cnamtime`,
    `stream=authentication where sourcename='WINDOWS' and action='LOGIN' and ((targetsid like '%-500') or (targetsid like '%-512') or (targetsid like '%-517') or (targetsid like '%-518') or (targetsid like '%-519') or (targetsid like '%-520') or (targetsid like '%-526') or (targetsid like '%-527') or (targetsid like '%-544')) | select user,targetsid,srcip,system as DomainController,devsrcip as DomainControllerIP, count_if((eid='4624') or ((eid='4768') and (statustaken='0x0'))) as LoginSuccessful, count_if((eid='4625') or (eid='4776') or (eid='4771') or (eid='4768') or (eid='4769')) as LoginFailure, count_if(statustaken='0xc000006d') as WrongCredentials, count_if(statustaken='0xc0000234') as AccountLockedForMultipleFailedAttempts, count_if(statustaken='0xc000006a') as WrongPassword, count_if(statustaken='0xc0000064') as UserDoesntExist, count_if(statustaken='0x18') as KerberosAuthFailed | groupby user,targetsid,srcip,system,devsrcip | duration 1h | having LoginFailure>3 and LoginSuccessful>=0 and (WrongCredentials>0 or AccountLockedForMultipleFailedAttempts>0 or UserDoesntExist>0 or KerberosAuthFailed>0)`,
    `stream=iam where eid in ('4722','4725','4726','4738') and targetuser in ('PANCDI-CONT','YADAJE-CONT','JADHSR-CONT','yadaje-conttadm','203951 ','209455','23231418','23141621','205240','207084','200001','202209','208369','23137327','211002','RAMESH','IYER.RAMESH','205133','23151886','25004424','25006041','25008546','25008723','25009163','25009204','25011033','25015400') | groupby action, cnamtime, devsrcip, domain, eid, system, role, targetuser, user, logevent`,
]

module.exports = queries;